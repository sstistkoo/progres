<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#0a0a0a" />
    <title>Soustru≈æn√≠k - Parametrick√© kreslen√≠ + AI</title>

    <!--
    ‚úÖ DEMO API KL√çƒå JE P≈òEDVYPLNƒöN√ù!
    Aplikace funguje okam≈æitƒõ po otev≈ôen√≠.

    Kl√≠ƒç je rozdƒõlen√Ω na 2 ƒç√°sti (v ai.js):
    API_KEY_PART1 + API_KEY_PART2 = kompletn√≠ kl√≠ƒç

    Pro vlastn√≠ kl√≠ƒç:
    - Kliknƒõte na ‚ú® AI ‚Üí ‚öôÔ∏è Settings
    - P≈ôidejte sv≈Øj Gemini API kl√≠ƒç
    - Z√≠skejte na: https://aistudio.google.com/app/apikey
    -->

    <link rel="stylesheet" href="styles.css" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^1.33.0"
        }
      }
    </script>
    <!-- GLOBALS + KEYBOARD MUS√ç B√ùT PRVN√ç! -->
    <script src="src/globals.js"></script>
    <script src="src/keyboard.js"></script>
    <script>console.log("‚úÖ index.html loaded");</script>
    <script src="src/utils.js"></script>
    <script src="src/drawing.js"></script>
    <script src="src/canvas.js?v=4"></script>
    <script src="src/ui.js"></script>
    <script src="src/controller.js"></script>
    <script src="src/ai.js"></script>
    <script src="lib/init.js"></script>
  </head>
  <body>
    <div class="canvas-area">
      <!-- Ovl√°d√°n√≠ pl√°tna vpravo naho≈ôe -->
      <div class="canvas-controls">
        <button
          class="canvas-btn"
          onclick="window.togglePan()"
          id="btnPanCanvas"
          title="Posun (Klikni pro zapnut√≠/vypnut√≠)"
        >
          <span>‚úã</span>
          <div>Posun</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.resetView()"
          title="Zobrazit v≈°echny objekty (Fit All)"
        >
          <span>‚åñ</span>
          <div>Fit All</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.undo()"
          id="btnUndo"
          title="Zpƒõt - vr√°tit posledn√≠ akci (Ctrl+Z)"
        >
          <span>‚Ü∂</span>
          <div>Zpƒõt</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.redo()"
          id="btnRedo"
          title="Vp≈ôed - obnovit vr√°cenou akci (Ctrl+Y)"
        >
          <span>‚Ü∑</span>
          <div>Vp≈ôed</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.toggleAiSelect()"
          id="btnSelectCanvas"
          title="P≈ôepnout re≈æim v√Ωbƒõru"
        >
          <span>üëÜ</span>
          <div>V√Ωbƒõr</div>
        </button>
      </div>

      <!-- AI PANEL -->
      <div
        class="tool-submenu"
        id="toolsAi"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; z-index: 1000;"
      >
        <div
          id="aiPanel"
          style="
            position: absolute; top: 80px; right: 20px; background: rgba(26, 26, 26, 0.95);
            padding: 15px; border-radius: 12px; border: 1px solid #555; width: 95%; max-width: 500px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.6); z-index: 1001; touch-action: none;
          "
        >
          <!-- AI Header s nastaven√≠m -->
          <div
            id="aiHeaderRow"
            style="
              display: flex;
              justify-content: space-between;
              align-items: flex-start;
              margin-bottom: 10px;
              cursor: move;
              -webkit-user-select: none; user-select: none;
            "
          >
            <div style="display: flex; gap: 8px; align-items: center">
              <!-- Model + AI Type (vertik√°lnƒõ) -->
              <div style="display: flex; flex-direction: column; gap: 6px;">
                <select
                  id="aiModelSelect"
                  style="
                    background: #111;
                    color: #888;
                    border: 1px solid #444;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 11px;
                    cursor: pointer;
                    outline: none;
                  "
                >
                  <option value="gemini-2.5-flash-lite" selected>
                    ‚ö° Gemini 2.5 Flash-Lite (Vy≈°≈°√≠ limit)
                  </option>
                  <option value="gemini-2.5-flash">
                    ‚ö° Gemini 2.5 Flash (Rychl√Ω)
                  </option>
                  <option value="gemini-3-pro-preview">
                    üß™ Gemini 3 Pro (Nejchyt≈ôej≈°√≠)
                  </option>
                  <option value="gemini-2.0-flash-exp">
                    ‚ö° Gemini 2.0 Flash (Exp)
                  </option>
                </select>

                <!-- AI Type (2D / CNC / Chat) -->
                <select
                  id="aiTypeSelect"
                  style="
                    background: #111;
                    color: #888;
                    border: 1px solid #444;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 11px;
                    cursor: pointer;
                    outline: none;
                  "
                  title="Vyberte re≈æim AI: 2D = kreslen√≠, CNC = generov√°n√≠ G-k√≥du/tvar≈Ø, Chat = bƒõ≈æn√Ω chat"
                >
                  <option value="2d" selected>‚úèÔ∏è 2D (kreslen√≠)</option>
                  <option value="cnc">üõ†Ô∏è CNC (k√≥dov√°n√≠)</option>
                  <option value="chat">üí¨ Chat (pokec)</option>
                </select>
              </div>

              <!-- AI Memory Button -->
              <button
                onclick="showAIMemory()"
                title="AI Pamƒõ≈• - Co se AI nauƒçila"
                style="
                  background: transparent;
                  border: none;
                  cursor: pointer;
                  color: #888;
                  transition: color 0.2s;
                  padding: 4px;
                "
              >
                <span style="font-size: 16px">üß†</span>
              </button>

              <!-- AI Preferences Button -->
              <button
                onclick="openAIPreferences()"
                title="Nastavit preference AI (uƒç√≠ se)"
                style="
                  background: transparent;
                  border: none;
                  cursor: pointer;
                  color: #888;
                  transition: color 0.2s;
                  padding: 4px;
                "
              >
                <span style="font-size: 16px">üéì</span>
              </button>

              <!-- Debug Metrics Button -->
              <button
                onclick="showAIMetrics()"
                title="Zobrazit AI statistiky"
                style="
                  background: transparent;
                  border: none;
                  cursor: pointer;
                  color: #888;
                  transition: color 0.2s;
                  padding: 4px;
                "
              >
                <span style="font-size: 16px">üìä</span>
              </button>

              <!-- Settings Button -->
              <button
                onclick="openSettings()"
                title="Nastaven√≠ API kl√≠ƒçe"
                style="
                  background: transparent;
                  border: none;
                  cursor: pointer;
                  color: #888;
                  transition: color 0.2s;
                  padding: 4px;
                "
              >
                <span style="font-size: 18px">‚öôÔ∏è</span>
              </button>
            </div>
          </div>

          <!-- Chat hist√≥ria -->
          <div id="aiChatHistory" class="chat-container">
            <div
              style="
                color: #666;
                font-size: 11px;
                text-align: center;
                margin-top: auto;
              "
            >
              Zaƒç√°tek konverzace. Zeptejte se na cokoliv nebo popi≈°te tvar.
            </div>

            <!-- Info o povolen√≠ -->
            <div
              id="permissionInfo"
              style="
                margin: 15px auto;
                padding: 10px;
                background: #1a2332;
                border: 1px solid #2563eb;
                border-radius: 8px;
                max-width: 90%;
                font-size: 10px;
                color: #93c5fd;
              "
            >
              <div
                style="
                  margin-bottom: 6px;
                  font-weight: bold;
                  color: #60a5fa;
                  font-size: 11px;
                "
              >
                ‚ÑπÔ∏è Pro plnou funkƒçnost na mobilu:
              </div>
              <div style="margin-bottom: 4px">
                üì∑ <strong>Kamera</strong> - pro focen√≠ n√°ƒçrt≈Ø
              </div>
              <div>üé§ <strong>Mikrofon</strong> - pro hlasov√© zad√°v√°n√≠</div>
              <div style="margin-top: 6px; font-size: 9px; opacity: 0.7">
                Povolen√≠ se vy≈æ√°daj√≠ p≈ôi prvn√≠m pou≈æit√≠.
              </div>
              <button
                onclick="document.getElementById('permissionInfo').style.display='none'"
                style="
                  margin-top: 8px;
                  padding: 4px 8px;
                  background: #1e40af;
                  border: none;
                  border-radius: 4px;
                  color: white;
                  font-size: 10px;
                  cursor: pointer;
                "
              >
                Rozum√≠m
              </button>
            </div>
          </div>

          <!-- Selection & Tools Toolbar -->
          <div
            style="
              display: flex;
              gap: 6px;
              margin-bottom: 8px;
              align-items: center;
              flex-wrap: wrap;
            "
          >
            <button
              id="btnAiSelect"
              onclick="window.toggleAiSelect(); document.getElementById('toolsAi').style.display='none'; document.getElementById('btnCatAi').classList.remove('active')"
              style="
                flex: 0 0 70px;
                padding: 8px 4px;
                background: #333;
                border: 1px solid #444;
                border-radius: 6px;
                color: #ccc;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 4px;
                font-size: 11px;
                transition: all 0.2s;
              "
              title="P≈ôepnout re≈æim v√Ωbƒõru"
            >
              <span style="font-size: 14px">üëÜ</span> V√Ωbƒõr
            </button>

            <button
              onclick="window.openQuickInput()"
              style="
                flex: 1;
                padding: 8px 4px;
                background: #333;
                border: 1px solid #444;
                border-radius: 6px;
                color: white;
                cursor: pointer;
                font-size: 11px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 4px;
                min-width: 90px;
              "
              title="Rychl√© zad√°n√≠ (Kl√°vesnice)"
            >
              <span style="font-size: 16px">‚å®Ô∏è</span> Kl√°vesnice
            </button>

            <button
              onclick="window.aiUndo()"
              style="
                flex: 0 0 36px;
                padding: 8px 0;
                background: #333;
                border: 1px solid #444;
                border-radius: 6px;
                color: white;
                cursor: pointer;
                font-size: 16px;
              "
              title="Zpƒõt (Undo)"
            >
              ‚Ü∂
            </button>

            <button
              onclick="window.aiRedo()"
              style="
                flex: 0 0 36px;
                padding: 8px 0;
                background: #333;
                border: 1px solid #444;
                border-radius: 6px;
                color: white;
                cursor: pointer;
                font-size: 16px;
              "
              title="Vp≈ôed (Redo)"
            >
              ‚Ü∑
            </button>

            <!-- Camera Button -->
            <button
              onclick="document.getElementById('aiImageInput').click()"
              title="Nahr√°t obr√°zek / Vyfotit"
              style="
                flex: 0 0 36px;
                padding: 8px 0;
                background: #333;
                color: white;
                border: 1px solid #444;
                border-radius: 6px;
                font-size: 16px;
                cursor: pointer;
              "
            >
              üì∑
            </button>
            <input
              type="file"
              id="aiImageInput"
              accept="image/*"
              capture="environment"
              style="display: none"
              onchange="window.handleImageSelect(this)"
            />

            <!-- Voice Button -->
            <button
              onclick="window.toggleVoice()"
              id="btnVoice"
              title="Hlasov√© zad√°n√≠"
              style="
                flex: 0 0 36px;
                padding: 8px 0;
                background: #333;
                color: white;
                border: 1px solid #444;
                border-radius: 6px;
                font-size: 16px;
                cursor: pointer;
                transition: all 0.2s;
              "
            >
              üé§
            </button>

            <button
              onclick="window.clearSelection()"
              id="btnClearSelection"
              style="
                flex: 0 0 36px;
                padding: 8px 0;
                background: #991b1b;
                border: 1px solid #991b1b;
                border-radius: 6px;
                color: white;
                cursor: pointer;
                font-size: 14px;
                display: none;
              "
              title="Zru≈°it v√Ωbƒõr"
            >
              ‚úï
            </button>
          </div>

          <!-- Selection List -->
          <div
            id="aiSelectionList"
            class="selection-list"
            style="display: none"
          ></div>

          <!-- Chat Window -->
          <div
            id="chatWindow"
            style="
              max-height: 200px;
              overflow-y: auto;
              margin-bottom: 10px;
              background: #0a0a0a;
              border: 1px solid #444;
              border-radius: 6px;
              padding: 10px;
              display: none;
            "
          ></div>

          <!-- Input z√≥na -->
          <div id="aiInputZone">
            <!-- Deep Think Checkbox -->
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 6px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  font-size: 11px;
                  color: #a78bfa;
                  cursor: pointer;
                  user-select: none;
                "
              >
                <input
                  type="checkbox"
                  id="useThinking"
                  style="width: 14px; height: 14px; accent-color: #7c3aed"
                />
                <span
                  >üß† Deep Think
                  <span style="opacity: 0.7">(Gemini 3 Pro)</span></span
                >
              </label>
              <span
                id="aiFileName"
                style="
                  font-size: 10px;
                  color: #888;
                  max-width: 120px;
                  overflow: hidden;
                  text-overflow: ellipsis;
                  white-space: nowrap;
                "
              ></span>
            </div>

            <!-- Image Preview -->
            <div
              id="aiImagePreview"
              style="
                display: none;
                margin-bottom: 6px;
                position: relative;
                background: #111;
                padding: 4px;
                border-radius: 4px;
                width: fit-content;
              "
            >
              <img
                id="aiPreviewImg"
                style="
                  max-height: 60px;
                  max-width: 100%;
                  border-radius: 2px;
                  display: block;
                "
              />
              <button
                onclick="window.clearImage()"
                style="
                  position: absolute;
                  top: -5px;
                  right: -5px;
                  background: #ef4444;
                  color: white;
                  border: 1px solid #991b1b;
                  border-radius: 50%;
                  width: 18px;
                  height: 18px;
                  font-size: 10px;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: bold;
                "
              >
                ‚úï
              </button>
            </div>

            <div style="display: flex; gap: 8px; align-items: flex-end">
              <div style="flex: 1; position: relative">
                <textarea
                  id="aiPrompt"
                  rows="1"
                  placeholder="Zpr√°va pro Gemini..."
                  onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); if(window.callGemini) { window.callGemini(); } }"
                  style="
                    resize: none;
                    width: 100%;
                    padding: 10px;
                    background: #0a0a0a;
                    border: 1px solid #444;
                    border-radius: 6px;
                    color: #fff;
                    font-family: inherit;
                    font-size: 16px;
                    max-height: 80px;
                    overflow-y: auto;
                  "
                ></textarea>
                <div id="cncInputError" style="
                  display: none;
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  margin-top: 4px;
                  padding: 8px;
                  background: #3a1a1a;
                  border: 1px solid #ff6b6b;
                  border-radius: 4px;
                  color: #ff6b6b;
                  font-size: 11px;
                  z-index: 100;
                  word-break: break-word;
                "></div>
              </div>

              <button
                onclick="if(!window.processingAI && window.callGemini) { window.callGemini(); } else { alert('AI u≈æ zpracov√°v√° request nebo test bƒõ≈æ√≠!'); }"
                id="btnGenerate"
                style="
                  padding: 10px;
                  background: #7c3aed;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-weight: bold;
                  cursor: pointer;
                "
                title="Odeslat do AI"
              >
                ‚û§
              </button>

              <button
                onclick="if(window.cancelAIRequest) { window.cancelAIRequest(); }"
                id="btnCancel"
                style="
                  padding: 10px;
                  background: #ef4444;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-weight: bold;
                  cursor: pointer;
                  display: none;
                "
                title="Zru≈°it po≈æadavek"
              >
                ‚äó
              </button>

              <!-- Test Button -->
              <button
                onclick="if(window.showAITestPanel) window.showAITestPanel()"
                style="
                  padding: 10px;
                  background: #8b5cf6;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-weight: bold;
                  cursor: pointer;
                  font-size: 12px;
                "
                title="Spustit AI test suite"
              >
                üß™
              </button>
            </div>

            <div
              id="aiStatus"
              style="
                margin-top: 8px;
                font-size: 10px;
                color: #555;
                text-align: center;
                display: flex;
                justify-content: space-between;
                flex-direction: column;
              "
            >
              <span id="keyIndicator" style="display: none;">API Kl√≠ƒç: ≈Ω√°dn√Ω</span>
            </div>

            <!-- API Usage Stats -->
            <div id="apiUsageInfo" style="
              margin-top: 12px;
              color: #888;
              font-size: 10px;
              padding: 10px;
              background: #1a1a1a;
              border-radius: 6px;
              border: 1px solid #333;
              line-height: 1.6;
            "></div>
          </div>
        </div>
      </div>

      <!-- Kreslen√≠ panel -->
      <div class="tool-submenu" id="toolsDrawing" style="display: none">
        <div class="drawing-panel" style="background: rgba(26, 26, 26, 0.95); padding: 12px; border-radius: 8px; border: 1px solid #444; max-width: 500px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); margin: 0 auto;">
        <!-- Header: polar snap + grip -->
        <div class="tool-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;padding:4px 0;background: transparent;border-radius:6px;max-width:100%;box-shadow:none;">
          <div style="display:flex;align-items:center;gap:12px;flex:1;min-width:0;">
            <div style="display:flex;flex-direction:column;min-width:0;">
              <label style="font-size: 12px; color: #ccc; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Pol√°rn√≠ krok (¬∞):
                <input type="number" id="polarSnapStep" min="1" max="90" value="90" style="width: 70px; margin-left: 8px; background: #222; color: #fff; border: 1px solid #444; border-radius: 4px; padding: 4px;">
              </label>
              <div style="font-size: 11px; color: #888; margin-top: 6px;">P≈ôichycen√≠ funguje automaticky pro vodorovn√©/svisl√© (0¬∞, 90¬∞, 180¬∞, 270¬∞) a dal≈°√≠ zvolen√© √∫hly. Tolerance: ¬±3¬∞.</div>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;margin-left:8px;">
            <div class="panel-grip" style="cursor: move; padding:8px 12px; text-align:center; color:#aaa; border:1px solid rgba(255,255,255,0.03); border-radius:6px; background: rgba(0,0,0,0.12);">‚â°</div>
          </div>
        </div>
        <div class="tools-content">
          <div
            style="
              display: flex;
              flex-wrap: wrap;
              gap: 8px;
              justify-content: center;
            "
          >
            <!-- Z√°kladn√≠ n√°stroje -->
            <button
              class="tool-btn"
              onclick="window.setMode('line')"
              id="btnLine"
              title="Nakreslit ƒç√°ru"
              style="margin: 0"
            >
              <span style="font-size: 20px">üìè</span>
              <div style="font-size: 10px; margin-top: 2px">ƒå√°ra</div>
            </button>

            <!-- Kru≈ænice - rozbalovac√≠ menu -->
            <div style="position: relative; display: inline-block">
              <button
                class="tool-btn"
                id="btnCircle"
                onclick="document.getElementById('circleMenu').style.display = document.getElementById('circleMenu').style.display === 'none' ? 'flex' : 'none'"
                title="Nakreslit kru≈ænici"
                style="margin: 0"
              >
                <span style="font-size: 20px">‚≠ï</span>
                <div style="font-size: 10px; margin-top: 2px">Kru≈ænice ‚ñº</div>
              </button>
              <div
                id="circleMenu"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  background: rgba(26, 26, 26, 0.98);
                  border: 1px solid #444;
                  border-radius: 6px;
                  display: none;
                  flex-direction: column;
                  gap: 4px;
                  padding: 6px;
                  min-width: 140px;
                  z-index: 1000;
                "
              >
                <button
                  class="tool-btn"
                  onclick="window.setMode('circle'); document.getElementById('circleMenu').style.display='none'"
                  style="
                    width: 100%;
                    margin: 0;
                    background: #333;
                    border: 1px solid #444;
                    padding: 8px;
                    border-radius: 4px;
                    color: #ccc;
                    font-size: 11px;
                    cursor: pointer;
                    text-align: left;
                  "
                  title="Bƒõ≈æn√° kru≈ænice (st≈ôed ‚Üí obvod)"
                >
                  üìç‚Üí‚≠ï Norm√°ln√≠
                </button>
                <button
                  class="tool-btn"
                  onclick="window.setMode('circumcircle'); document.getElementById('circleMenu').style.display='none'"
                  style="
                    width: 100%;
                    margin: 0;
                    background: #333;
                    border: 1px solid #444;
                    padding: 8px;
                    border-radius: 4px;
                    color: #ccc;
                    font-size: 11px;
                    cursor: pointer;
                    text-align: left;
                  "
                  title="Kru≈ænice proch√°zej√≠c√≠ 3 body"
                >
                  3Ô∏è‚É£ Skrze 3 body
                </button>
              </div>
            </div>

            <button
              class="tool-btn"
              onclick="window.setMode('arc')"
              id="btnArc"
              title="Nakreslit oblouk"
              style="margin: 0"
            >
              <span style="font-size: 20px">üåô</span>
              <div style="font-size: 10px; margin-top: 2px">Oblouk</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('point')"
              id="btnPoint"
              title="Vytvo≈ôit bod"
              style="margin: 0"
            >
              <span style="font-size: 20px">üìç</span>
              <div style="font-size: 10px; margin-top: 2px">Bod</div>
            </button>

            <button
              class="tool-btn"
              onclick="window.setMode('rectangle')"
              id="btnRectangle"
              title="Nakreslit obd√©ln√≠k"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚ñ≠</span>
              <div style="font-size: 10px; margin-top: 2px">Obd√©ln√≠k</div>
            </button>

            <!-- Konstrukce -->
            <button
              class="tool-btn"
              onclick="window.setMode('tangent')"
              id="btnTangent"
              title="Teƒçna ke kru≈ænici"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚üÇ</span>
              <div style="font-size: 10px; margin-top: 2px">Teƒçna</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('perpendicular')"
              id="btnPerpendicular"
              title="Kolmice"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚î¥</span>
              <div style="font-size: 10px; margin-top: 2px">Kolmice</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('parallel')"
              id="btnParallel"
              title="Rovnobƒõ≈æka"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚à•</span>
              <div style="font-size: 10px; margin-top: 2px">Rovnobƒõ≈æka</div>
            </button>
          </div>
          <div
            style="
              margin-top: 12px;
              padding-top: 8px;
              border-top: 1px solid #444;
            "
          >
            <label
              style="
                display: flex;
                align-items: center;
                gap: 8px;
                color: #ccc;
                font-size: 12px;
                cursor: pointer;
              "
            >
              <input
                type="checkbox"
                id="polarSnapCheckboxLegacy"
                onchange="window.togglePolarSnapLegacy()"
              />
              Pol√°rn√≠ p≈ôichycen√≠ (15¬∞, 30¬∞, 45¬∞...)
            </label>
          </div>
        </div>
        </div>
      </div>

      <!-- √öpravy panel -->
      <div class="tool-submenu" id="toolsEdit" style="display: none">
        <div
          style="
            background: rgba(26, 26, 26, 0.95);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
          "
        >
          <div
            style="
              display: flex;
              flex-wrap: wrap;
              gap: 8px;
              justify-content: center;
            "
          >
            <!-- Editace -->
            <button
              class="tool-btn"
              onclick="window.setMode('trim')"
              id="btnTrim"
              title="O≈ôezat ƒç√°ru"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚úÇÔ∏è</span>
              <div style="font-size: 10px; margin-top: 2px">O≈ô√≠znut√≠</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('extend')"
              id="btnExtend"
              title="Prot√°hnout ƒç√°ru"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚ÜîÔ∏è</span>
              <div style="font-size: 10px; margin-top: 2px">Prota≈æen√≠</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('offset')"
              id="btnOffset"
              title="Odsadit objekt"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚áÑ</span>
              <div style="font-size: 10px; margin-top: 2px">Odsazen√≠</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('mirror')"
              id="btnMirror"
              title="Zrcadlit objekt"
              style="margin: 0"
            >
              <span style="font-size: 20px">ü™û</span>
              <div style="font-size: 10px; margin-top: 2px">Zrcadlit</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('erase')"
              id="btnErase"
              title="Smazat objekt"
              style="margin: 0"
            >
              <span style="font-size: 20px">üóëÔ∏è</span>
              <div style="font-size: 10px; margin-top: 2px">Guma</div>
            </button>
            <button
              class="tool-btn"
              onclick="calculateIntersections()"
              id="btnIntersect"
              title="Spoƒç√≠tat pr≈Øseƒç√≠ky"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚äó</span>
              <div style="font-size: 10px; margin-top: 2px">Pr≈Øseƒç√≠ky</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('measure')"
              id="btnMeasure"
              title="Zmƒõ≈ôit rozmƒõry"
              style="margin: 0"
            >
              <span style="font-size: 20px">üìè</span>
              <div style="font-size: 10px; margin-top: 2px">Mƒõ≈ôen√≠</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.showConstraintModal()"
              id="btnConstraint"
              title="Fixace - aretov√°n√≠"
              style="margin: 0"
            >
              <span style="font-size: 20px">üîí</span>
              <div style="font-size: 10px; margin-top: 2px">Fixace</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('dimension')"
              id="btnDimension"
              title="K√≥tovat objekt"
              style="margin: 0"
            >
              <span style="font-size: 20px">üìê</span>
              <div style="font-size: 10px; margin-top: 2px">K√≥ta</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.deleteAllDimensions()"
              id="btnDeleteDimensions"
              title="Smazat v≈°echny k√≥ty"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚ùå</span>
              <div style="font-size: 10px; margin-top: 2px">Smazat k√≥ty</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.dimensionAll()"
              id="btnDimensionAll"
              title="Okotovat v≈°echny ƒç√°ry a kru≈ænice"
              style="margin: 0"
            >
              <span style="font-size: 20px">üìè‚ú®</span>
              <div style="font-size: 10px; margin-top: 2px">Okotovat v≈°e</div>
            </button>

            <!-- Transformace -->
            <button
              class="tool-btn"
              onclick="window.setMode('align')"
              title="Zarovnat a posunout"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚öñÔ∏è</span>
              <div style="font-size: 10px; margin-top: 2px">Zarovn√°n√≠</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.setMode('rotate')"
              title="Otoƒçit objekty"
              style="margin: 0"
            >
              <span style="font-size: 20px">üîÅ</span>
              <div style="font-size: 10px; margin-top: 2px">Rotace</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.showColorPicker()"
              title="Zmƒõnit barvu a typ ƒç√°ry"
              style="margin: 0"
            >
              <span style="font-size: 20px">üé®</span>
              <div style="font-size: 10px; margin-top: 2px">Barva, typ</div>
            </button>

            <!-- Booleovsk√© operace -->
            <button
              class="tool-btn"
              onclick="window.booleanUnion()"
              title="Sjednocen√≠"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚à™</span>
              <div style="font-size: 10px; margin-top: 2px">Sjednocen√≠</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.booleanIntersect()"
              title="Pr≈Ønik"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚à©</span>
              <div style="font-size: 10px; margin-top: 2px">Pr≈Ønik</div>
            </button>
            <button
              class="tool-btn"
              onclick="window.booleanDifference()"
              title="Rozd√≠l"
              style="margin: 0"
            >
              <span style="font-size: 20px">‚àí</span>
              <div style="font-size: 10px; margin-top: 2px">Rozd√≠l</div>
            </button>
          </div>
        </div>
      </div>

      <!-- Sou≈ôadnice panel -->
      <div
        class="tool-submenu coords-panel"
        id="toolsCoords"
        style="display: none"
      >
        <div
          style="
            background: rgba(26, 26, 26, 0.95);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
          "
        >
          <!-- Bod -->
          <div style="margin-bottom: 8px">
            <div
              onclick="window.toggleCoordSection('coordBod')"
              style="
                cursor: pointer;
                padding: 10px;
                background: #2a2a2a;
                border-radius: 6px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <strong style="color: #6ab0ff; font-size: 13px">üìç Bod</strong>
              <span id="coordBodToggle" style="color: #888">‚ñº</span>
            </div>
            <div
              id="coordBod"
              style="
                display: none;
                padding: 10px;
                background: #1a1a1a;
                border-radius: 6px;
                margin-top: 4px;
              "
            >
              <div style="display: flex; gap: 8px; margin-bottom: 8px">
                <input
                  type="number"
                  id="quickPointZ"
                  placeholder="Z"
                  step="0.01"
                  style="
                    flex: 1;
                    padding: 8px;
                    background: #0a0a0a;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                    font-size: 14px;
                  "
                />
                <input
                  type="number"
                  id="quickPointX"
                  placeholder="X"
                  step="0.01"
                  style="
                    flex: 1;
                    padding: 8px;
                    background: #0a0a0a;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                    font-size: 14px;
                  "
                />
              </div>
              <div style="display: flex; gap: 8px">
                <button
                  onclick="window.setPointFromCursor()"
                  style="
                    padding: 10px;
                    background: #4a4a4a;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 13px;
                    flex: 1;
                  "
                >
                  üìç Z kurzoru
                </button>
                <button
                  onclick="window.quickAddPoint()"
                  style="
                    padding: 10px;
                    background: #3a7bc8;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 13px;
                    flex: 1;
                  "
                >
                  + P≈ôidat
                </button>
              </div>
            </div>
          </div>

          <!-- ƒå√°ra -->
          <div style="margin-bottom: 8px">
            <div
              onclick="window.toggleCoordSection('coordLine')"
              style="
                cursor: pointer;
                padding: 10px;
                background: #2a2a2a;
                border-radius: 6px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <strong style="color: #6ab0ff; font-size: 13px">üìè ƒå√°ra</strong>
              <span id="coordLineToggle" style="color: #888">‚ñº</span>
            </div>
            <div
              id="coordLine"
              style="
                display: none;
                padding: 10px;
                background: #1a1a1a;
                border-radius: 6px;
                margin-top: 4px;
              "
            >
              <div style="font-size: 12px; color: #888; margin-bottom: 4px">Bod 1:</div>
              <div style="display: flex; gap: 8px; margin-bottom: 8px">
                <input type="number" id="lineZ1" placeholder="Z1" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px; font-size: 12px" />
                <input type="number" id="lineX1" placeholder="X1" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px; font-size: 12px" />
              </div>
              <div style="font-size: 12px; color: #888; margin-bottom: 4px">Bod 2:</div>
              <div style="display: flex; gap: 8px; margin-bottom: 8px">
                <input type="number" id="lineZ2" placeholder="Z2" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px; font-size: 12px" />
                <input type="number" id="lineX2" placeholder="X2" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px; font-size: 12px" />
              </div>
              <button onclick="window.addLineByCoords()" style="padding: 10px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; width: 100%">+ Nakreslit</button>
            </div>
          </div>

          <!-- Kru≈ænice -->
          <div style="margin-bottom: 8px">
            <div
              onclick="window.toggleCoordSection('coordCircle')"
              style="
                cursor: pointer;
                padding: 10px;
                background: #2a2a2a;
                border-radius: 6px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <strong style="color: #6ab0ff; font-size: 13px">‚≠ï Kru≈ænice</strong>
              <span id="coordCircleToggle" style="color: #888">‚ñº</span>
            </div>
            <div
              id="coordCircle"
              style="
                display: none;
                padding: 10px;
                background: #1a1a1a;
                border-radius: 6px;
                margin-top: 4px;
              "
            >
              <div style="font-size: 12px; color: #888; margin-bottom: 4px">St≈ôed:</div>
              <div style="display: flex; gap: 8px; margin-bottom: 8px">
                <input type="number" id="quickCircleZ" placeholder="Z" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px" />
                <input type="number" id="quickCircleX" placeholder="X" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px" />
              </div>
              <div style="font-size: 12px; color: #888; margin-bottom: 4px">Polomƒõr:</div>
              <input type="number" id="quickCircleR" placeholder="R" step="0.01" style="width: 100%; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px; margin-bottom: 8px" />
              <button onclick="window.quickAddCircle()" style="padding: 10px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; width: 100%">+ Nakreslit</button>
            </div>
          </div>

          <!-- Pol√°rn√≠ sou≈ôadnice -->
          <div style="margin-bottom: 8px">
            <div onclick="window.toggleCoordSection('coordPolar')" style="cursor: pointer; padding: 10px; background: #2a2a2a; border-radius: 6px; display: flex; justify-content: space-between; align-items: center">
              <strong style="color: #6ab0ff; font-size: 13px">üìê Pol√°rn√≠</strong>
              <span id="coordPolarToggle" style="color: #888">‚ñº</span>
            </div>
            <div id="coordPolar" style="display: none; padding: 10px; background: #1a1a1a; border-radius: 6px; margin-top: 4px">
              <div style="font-size: 12px; color: #888; margin-bottom: 4px">Poƒç√°teƒçn√≠ bod:</div>
              <div style="display: flex; gap: 8px; margin-bottom: 8px">
                <input type="number" id="polarStartZ" placeholder="Z" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px" />
                <input type="number" id="polarStartX" placeholder="X" step="0.01" style="flex: 1; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px" />
              </div>
              <div style="display: flex; gap: 8px; margin-bottom: 8px">
                <div style="flex: 1">
                  <div style="font-size: 12px; color: #888; margin-bottom: 2px">Vzd√°lenost:</div>
                  <input type="number" id="polarDist" placeholder="mm" step="0.1" style="width: 100%; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px" />
                </div>
                <div style="flex: 1">
                  <div style="font-size: 12px; color: #888; margin-bottom: 2px">√öhel:</div>
                  <input type="number" id="polarAngle" placeholder="¬∞" step="1" style="width: 100%; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px" />
                </div>
              </div>
              <div style="font-size: 11px; color: #666; margin-bottom: 8px">0¬∞ = vpravo, 90¬∞ = nahoru</div>
              <div style="display: flex; gap: 8px">
                <button onclick="window.addLinePolar()" style="padding: 10px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; flex: 1">+ ƒå√°ra</button>
                <button onclick="window.addPointPolar()" style="padding: 10px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; flex: 1">+ Bod</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ostatn√≠ panel -->
      <div class="tool-submenu" id="toolsOther" style="display: none">
        <div
          style="
            background: rgba(26, 26, 26, 0.95);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            max-height: 70vh;
            overflow-y: auto;
          "
        >
          <!-- Akce -->
          <div style="margin-bottom: 8px">
            <div style="padding: 8px 10px; background: #2a2a2a; border-radius: 6px">
              <strong style="color: #6ab0ff; font-size: 13px">‚ö° Akce</strong>
            </div>
            <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap">
              <button class="tool-btn" onclick="window.undo()" style="margin: 0; flex: 1; min-width: 80px" title="Zpƒõt">
                <span style="font-size: 24px">‚Ü∂</span>
                <div style="font-size: 11px; margin-top: 2px">Zpƒõt</div>
              </button>
              <button class="tool-btn" onclick="window.clearAll()" style="margin: 0; flex: 1; min-width: 80px" title="Vymazat v≈°e">
                <span style="font-size: 24px">üóëÔ∏è</span>
                <div style="font-size: 11px; margin-top: 2px">Vymazat</div>
              </button>
              <button class="tool-btn" onclick="window.exportPNG()" style="margin: 0; flex: 1; min-width: 80px" title="Exportovat PNG">
                <span style="font-size: 24px">üíæ</span>
                <div style="font-size: 11px; margin-top: 2px">Export PNG</div>
              </button>
            </div>
            <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap">
              <button class="tool-btn" onclick="window.saveProject()" style="margin: 0; flex: 1; min-width: 100px" title="Ulo≈æit projekt">
                <span style="font-size: 24px">üíæ</span>
                <div style="font-size: 10px; margin-top: 2px">Ulo≈æit</div>
              </button>
              <button class="tool-btn" onclick="document.getElementById('loadProjectInput').click()" style="margin: 0; flex: 1; min-width: 100px" title="Naƒç√≠st projekt">
                <span style="font-size: 24px">üìÇ</span>
                <div style="font-size: 10px; margin-top: 2px">Naƒç√≠st</div>
              </button>
              <button class="tool-btn" onclick="document.getElementById('importSimDxfInput').click()" style="margin: 0; flex: 1; min-width: 120px" title="Importovat z SimDxf JSON">
                <span style="font-size: 24px">üì•</span>
                <div style="font-size: 10px; margin-top: 2px">Import SimDxf</div>
              </button>
              <input type="file" id="loadProjectInput" accept=".json" style="display: none" onchange="window.loadProject(this)" />
              <input type="file" id="importSimDxfInput" accept=".json" style="display: none" onchange="window.importSimDxfProject(this)" />
            </div>
          </div>

          <!-- P≈ôichycen√≠ -->
          <div style="margin-bottom: 8px">
            <div
              onclick="window.toggleCoordSection('otherHelpers')"
              style="cursor: pointer; padding: 10px; background: #2a2a2a; border-radius: 6px; display: flex; justify-content: space-between; align-items: center"
            >
              <strong style="color: #6ab0ff; font-size: 13px">üìç P≈ôichycen√≠</strong>
              <span id="otherHelpersToggle" style="color: #888">‚ñº</span>
            </div>
            <div id="otherHelpers" style="display: none; padding: 10px; background: #1a1a1a; border-radius: 6px; margin-top: 4px">
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px; margin-bottom: 8px">
                <input type="checkbox" id="snapGrid" onchange="window.updateSnapSettings()" style="width: 16px; height: 16px" />
                <span>P≈ôichycen√≠ k m≈ô√≠≈æce</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px; margin-bottom: 8px">
                <input type="checkbox" id="snapPoints" checked onchange="window.updateSnapSettings()" style="width: 16px; height: 16px" />
                <span>P≈ôichycen√≠ k bod≈Øm</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px">
                <input type="checkbox" id="orthoMode" checked onchange="window.updateSnapSettings()" style="width: 16px; height: 16px" />
                <span>Ortogon√°ln√≠ (‚Üî‚Üï)</span>
              </label>
            </div>
          </div>

          <!-- Zobrazen√≠ -->
          <div style="margin-bottom: 8px">
            <div
              onclick="window.toggleCoordSection('otherDisplay')"
              style="cursor: pointer; padding: 10px; background: #2a2a2a; border-radius: 6px; display: flex; justify-content: space-between; align-items: center"
            >
              <strong style="color: #6ab0ff; font-size: 13px">üé® Zobrazen√≠</strong>
              <span id="otherDisplayToggle" style="color: #888">‚ñº</span>
            </div>
            <div id="otherDisplay" style="display: none; padding: 10px; background: #1a1a1a; border-radius: 6px; margin-top: 4px">
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px; margin-bottom: 8px">
                <input type="checkbox" id="showGrid" checked onchange="window.draw()" style="width: 16px; height: 16px" />
                <span>M≈ô√≠≈æka</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px; margin-bottom: 8px">
                <input type="checkbox" id="showAxes" checked onchange="window.draw()" style="width: 16px; height: 16px" />
                <span>Osy (X, Z)</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px; margin-bottom: 8px">
                <input type="checkbox" id="showPoints" checked onchange="window.draw()" style="width: 16px; height: 16px" />
                <span>Body</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px; margin-bottom: 8px">
                <input type="checkbox" id="enableMeasureInput" onchange="window.toggleMeasureInput()" style="width: 16px; height: 16px" />
                <span>M√≠ra - zad√°n√≠ rozmƒõr≈Ø</span>
              </label>
              <!-- M≈ô√≠≈æka -->
              <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid #333">
                <label style="font-size: 12px; color: #888; display: block; margin-bottom: 6px">Rozestup m≈ô√≠≈æky (mm):</label>
                <input type="number" id="gridSpacing" value="10" min="0.01" max="100" step="0.01" onchange="window.updateGridSpacing()" style="width: 100%; padding: 8px; background: #0a0a0a; border: 1px solid #444; color: white; border-radius: 4px; font-size: 14px; margin-bottom: 6px" />
                <div style="display: flex; gap: 6px">
                  <button onclick="window.setGridSpacing(0.1)" style="flex: 1; padding: 6px; background: #3a3a3a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px">0.1mm</button>
                  <button onclick="window.setGridSpacing(1)" style="flex: 1; padding: 6px; background: #3a3a3a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px">1mm</button>
                  <button onclick="window.setGridSpacing(5)" style="flex: 1; padding: 6px; background: #3a3a3a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px">5mm</button>
                  <button onclick="window.setGridSpacing(10)" style="flex: 1; padding: 6px; background: #3a3a3a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px">10mm</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <canvas id="canvas"></canvas>

      <!-- Touch cursor -->
      <div class="touch-cursor" id="touchCursor">
        <div class="touch-cursor-center"></div>
      </div>

      <div class="coords" id="coords">Z: 0.00 | X: 0.00 mm</div>
      <div class="snap-info" id="snapInfo"></div>
      <div class="mode-info" id="modeInfo"></div>
    </div>

    <!-- Toolbar dole -->
    <div class="toolbar">
      <button
        class="tool-btn"
        onclick="window.showControllerModal()"
        id="btnController"
        title="Ovladaƒç pro kreslen√≠"
      >
        <span style="font-size: 24px">üéÆ</span>
        <div style="font-size: 11px; margin-top: 4px">Ovladaƒç</div>
      </button>
      <button
        class="tool-btn"
        onclick="window.showToolCategory('drawing')"
        id="btnCatDrawing"
        title="Kreslen√≠"
      >
        <span style="font-size: 24px">‚úèÔ∏è</span>
        <div style="font-size: 11px; margin-top: 4px">Kreslen√≠</div>
      </button>
      <button
        class="tool-btn"
        onclick="window.showToolCategory('edit')"
        id="btnCatEdit"
        title="√öpravy"
      >
        <span style="font-size: 24px">üîß</span>
        <div style="font-size: 11px; margin-top: 4px">√öpravy</div>
      </button>
      <button
        class="tool-btn"
        onclick="window.showToolCategory('coords')"
        id="btnCatCoords"
        title="Sou≈ôadnice"
      >
        <span style="font-size: 24px">üìê</span>
        <div style="font-size: 11px; margin-top: 4px">Sou≈ôadnice</div>
      </button>
      <button
        class="tool-btn"
        onclick="window.showToolCategory('other')"
        id="btnCatOther"
        title="Ostatn√≠"
      >
        <span style="font-size: 24px">‚öôÔ∏è</span>
        <div style="font-size: 11px; margin-top: 4px">Ostatn√≠</div>
      </button>

      <div
        style="width: 1px; height: 40px; background: #333; margin: 0 5px"
      ></div>

      <button
        class="tool-btn ai-btn"
        onclick="window.showToolCategory('ai')"
        id="btnCatAi"
        title="AI Asistent"
      >
        <span style="font-size: 24px">‚ú®</span>
        <div style="font-size: 11px; margin-top: 4px">AI</div>
      </button>
    </div>
    <div id="settingsModal" class="modal-overlay">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">
          ‚öôÔ∏è Nastaven√≠ API Kl√≠ƒç≈Ø
        </h2>

        <p style="font-size: 13px; color: #aaa; margin-bottom: 10px">
          Pro pou≈æit√≠ AI funkc√≠ (Gemini) vlo≈æte API kl√≠ƒç. Kl√≠ƒçe jsou ulo≈æeny
          pouze ve va≈°em prohl√≠≈æeƒçi.
          <a
            href="https://aistudio.google.com/app/apikey"
            target="_blank"
            style="color: #6ab0ff"
            >Z√≠skat kl√≠ƒç zde</a
          >.
        </p>

        <div style="font-size: 12px; color: #888">Ulo≈æen√© kl√≠ƒçe:</div>
        <div id="keyList" class="key-list">
          <div
            style="
              padding: 10px;
              color: #555;
              font-style: italic;
              text-align: center;
            "
          >
            ≈Ω√°dn√© kl√≠ƒçe
          </div>
        </div>

        <div
          style="
            background: #222;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
          "
        >
          <div style="margin-bottom: 8px">
            <label style="font-size: 11px; display: block; margin-bottom: 2px"
              >N√°zev:</label
            >
            <input
              type="text"
              id="newKeyName"
              placeholder="M≈Øj kl√≠ƒç"
              style="
                width: 100%;
                background: #111;
                border: 1px solid #444;
                color: white;
                padding: 6px;
                border-radius: 4px;
              "
            />
          </div>
          <div style="margin-bottom: 8px">
            <label style="font-size: 11px; display: block; margin-bottom: 2px"
              >API Key:</label
            >
            <input
              type="password"
              id="newKeyValue"
              placeholder="AIza..."
              style="
                width: 100%;
                background: #111;
                border: 1px solid #444;
                color: white;
                padding: 6px;
                border-radius: 4px;
              "
            />
          </div>
          <button
            onclick="addApiKey()"
            style="
              width: 100%;
              padding: 8px;
              background: #3a7bc8;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 13px;
            "
          >
            + P≈ôidat a pou≈æ√≠t
          </button>
        </div>

        <div style="margin-top: 15px; text-align: right">
          <button
            onclick="closeSettings()"
            style="
              padding: 8px 16px;
              background: #444;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
            "
          >
            Zav≈ô√≠t
          </button>
        </div>
      </div>
    </div>

    <!-- AI PREFERENCES MODAL -->
    <div id="aiPreferencesModal" class="modal-overlay" style="display: none">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">
          üéì AI Preference
        </h2>

        <p style="font-size: 12px; color: #aaa; margin-bottom: 15px">
          Nastavte sv√© preference a AI se nauƒç√≠ je respektovat.
        </p>

        <div
          style="
            background: #222;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
          "
        >
          <h3 style="color: #6ab0ff; font-size: 14px; margin-bottom: 10px">
            üìù Preference:
          </h3>
          <div id="preferencesList" style="font-size: 12px; color: #ccc">
            <div style="padding: 10px; color: #555; text-align: center">
              ≈Ω√°dn√© preference
            </div>
          </div>
        </div>

        <div style="background: #222; padding: 12px; border-radius: 6px">
          <h3 style="color: #6ab0ff; font-size: 14px; margin-bottom: 10px">
            ‚ûï P≈ôidat preferenci:
          </h3>
          <div style="margin-bottom: 8px">
            <label style="font-size: 11px; display: block; margin-bottom: 2px"
              >Kl√≠ƒç:</label
            >
            <input
              type="text"
              id="newPrefKey"
              placeholder="nap≈ô. material"
              style="
                width: 100%;
                background: #111;
                border: 1px solid #444;
                color: white;
                padding: 6px;
                border-radius: 4px;
              "
            />
          </div>
          <div style="margin-bottom: 8px">
            <label style="font-size: 11px; display: block; margin-bottom: 2px"
              >Hodnota:</label
            >
            <input
              type="text"
              id="newPrefValue"
              placeholder="nap≈ô. ocel"
              style="
                width: 100%;
                background: #111;
                border: 1px solid #444;
                color: white;
                padding: 6px;
                border-radius: 4px;
              "
            />
          </div>
          <button
            onclick="addAIPreference()"
            style="
              width: 100%;
              padding: 8px;
              background: #3a7bc8;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 13px;
            "
          >
            + P≈ôidat
          </button>
        </div>

        <div style="margin-top: 15px; text-align: right">
          <button
            onclick="closeAIPreferences()"
            style="
              padding: 8px 16px;
              background: #444;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
            "
          >
            Zav≈ô√≠t
          </button>
        </div>
      </div>
    </div>

    <!-- CIRCLE MODAL -->
    <div id="circleModal" class="modal-overlay">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">‚≠ï Zad√°n√≠ kru≈ænice</h2>
        <div class="circle-input-row">
          <label>Polomƒõr (R):</label>
          <input type="number" id="circleInputR" step="0.01" oninput="window.updateCircleInputs('R')" onkeydown="if(event.key==='Enter') window.confirmCircle()" />
        </div>
        <div class="circle-input-row">
          <label>Pr≈Ømƒõr (D):</label>
          <input type="number" id="circleInputD" step="0.01" oninput="window.updateCircleInputs('D')" onkeydown="if(event.key==='Enter') window.confirmCircle()" />
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end">
          <button onclick="window.closeCircleModal()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer">Zru≈°it</button>
          <button onclick="window.confirmCircle()" style="padding: 8px 16px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold">Vytvo≈ôit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT MODAL -->
    <!-- COLOR & STYLE MODAL -->
    <div id="colorStyleModal" class="modal-overlay" style="display: none">
      <div class="modal-window" style="max-width: 600px">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">üé® Barva a Styl ƒå√°ry</h2>

        <!-- BARVY -->
        <div style="margin-bottom: 20px">
          <h3 style="color: #888; font-size: 12px; margin-bottom: 10px; text-transform: uppercase">üé® Barva</h3>
          <div style="display: flex; flex-wrap: wrap; gap: 10px">
            <button onclick="window.selectColor('#FF0000', this)" id="colorBtn_FF0000" style="width: 40px; height: 40px; background: #FF0000; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="ƒåerven√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#00FF00', this)" id="colorBtn_00FF00" style="width: 40px; height: 40px; background: #00FF00; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="Zelen√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#0000FF', this)" id="colorBtn_0000FF" style="width: 40px; height: 40px; background: #0000FF; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="Modr√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#FFFF00', this)" id="colorBtn_FFFF00" style="width: 40px; height: 40px; background: #FFFF00; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="≈Ωlut√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#FF00FF', this)" id="colorBtn_FF00FF" style="width: 40px; height: 40px; background: #FF00FF; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="Fialov√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#00FFFF', this)" id="colorBtn_00FFFF" style="width: 40px; height: 40px; background: #00FFFF; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="Azurov√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#FFA500', this)" id="colorBtn_FFA500" style="width: 40px; height: 40px; background: #FFA500; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="Oran≈æov√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#800080', this)" id="colorBtn_800080" style="width: 40px; height: 40px; background: #800080; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="Purpura" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#FFFFFF', this)" id="colorBtn_FFFFFF" style="width: 40px; height: 40px; background: #FFFFFF; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="B√≠l√°" onmouseover="this.style.borderColor='#aaa'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#000000', this)" id="colorBtn_000000" style="width: 40px; height: 40px; background: #000000; border: 2px solid #aaa; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="ƒåern√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#aaa'"></button>
            <button onclick="window.selectColor('#808080', this)" id="colorBtn_808080" style="width: 40px; height: 40px; background: #808080; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="≈†ed√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
            <button onclick="window.selectColor('#FF69B4', this)" id="colorBtn_FF69B4" style="width: 40px; height: 40px; background: #FF69B4; border: 2px solid #555; border-radius: 6px; cursor: pointer; transition: all 0.2s" title="R≈Ø≈æov√°" onmouseover="this.style.borderColor='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.borderColor='#555'"></button>
          </div>
        </div>

        <!-- STYL ƒå√ÅRY -->
        <div style="margin-bottom: 20px">
          <h3 style="color: #888; font-size: 12px; margin-bottom: 10px; text-transform: uppercase">üìè Styl ƒå√°ry</h3>
          <div style="display: flex; flex-wrap: wrap; gap: 10px">
            <button onclick="window.selectLineStyle('solid', this)" id="styleBtn_solid" style="padding: 10px 16px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.background='#2a3a4a'; if(!this.classList.contains('selected'))this.style.color='#aaa'">‚îÅ‚îÅ Klasick√°</button>
            <button onclick="window.selectLineStyle('thick', this)" id="styleBtn_thick" style="padding: 10px 16px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.background='#2a3a4a'; if(!this.classList.contains('selected'))this.style.color='#aaa'">‚îÅ‚îÅ‚îÅ Tlust√°</button>
            <button onclick="window.selectLineStyle('thin', this)" id="styleBtn_thin" style="padding: 10px 16px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.background='#2a3a4a'; if(!this.classList.contains('selected'))this.style.color='#aaa'">‚îÄ Tenk√°</button>
            <button onclick="window.selectLineStyle('dashed', this)" id="styleBtn_dashed" style="padding: 10px 16px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.background='#2a3a4a'; if(!this.classList.contains('selected'))this.style.color='#aaa'">‚ïå ‚ïå ƒå√°rkovan√°</button>
            <button onclick="window.selectLineStyle('dotted', this)" id="styleBtn_dotted" style="padding: 10px 16px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="if(!this.classList.contains('selected'))this.style.background='#2a3a4a'; if(!this.classList.contains('selected'))this.style.color='#aaa'">¬∑ ¬∑ Teƒçkovan√°</button>
          </div>
        </div>

        <!-- NASTAVEN√ç V√ùCHOZ√çCH BAREV A STYLU -->
        <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #555; margin-bottom: 20px">
          <h3 style="color: #888; font-size: 12px; margin-bottom: 15px; text-transform: uppercase">‚öôÔ∏è Nastaven√≠ Kreslen√≠ Nov√Ωch Objekt≈Ø</h3>
          <p style="color: #666; font-size: 11px; margin-bottom: 15px">Vyberte v√Ωchoz√≠ barvu a styl pro novƒõ kreslen√© objekty. Nastaven√≠ se ulo≈æ√≠ automaticky.</p>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <!-- V√Ωchoz√≠ barva -->
            <div>
              <label style="display: block; color: #888; font-size: 11px; margin-bottom: 8px">üé® V√Ωchoz√≠ barva:</label>
              <select id="defaultColorSelect" onchange="window.setDefaultColor(this.value)" style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #555; border-radius: 4px; color: #e0e0e0; font-size: 12px">
                <option value="#4a9eff" style="background: #1a1a1a; color: #e0e0e0">üîµ Modr√° (v√Ωchoz√≠)</option>
                <option value="#FF0000" style="background: #1a1a1a; color: #e0e0e0">üî¥ ƒåerven√°</option>
                <option value="#00FF00" style="background: #1a1a1a; color: #e0e0e0">üü¢ Zelen√°</option>
                <option value="#FFFF00" style="background: #1a1a1a; color: #e0e0e0">üü° ≈Ωlut√°</option>
                <option value="#FF00FF" style="background: #1a1a1a; color: #e0e0e0">üü£ Fialov√°</option>
                <option value="#00FFFF" style="background: #1a1a1a; color: #e0e0e0">‚ö™ Azurov√°</option>
                <option value="#FFA500" style="background: #1a1a1a; color: #e0e0e0">üü† Oran≈æov√°</option>
                <option value="#800080" style="background: #1a1a1a; color: #e0e0e0">‚¨õ Purpura</option>
                <option value="#FFFFFF" style="background: #1a1a1a; color: #e0e0e0">‚ö´ B√≠l√°</option>
                <option value="#000000" style="background: #1a1a1a; color: #e0e0e0">‚¨ú ƒåern√°</option>
                <option value="#808080" style="background: #1a1a1a; color: #e0e0e0">‚óºÔ∏è ≈†ed√°</option>
                <option value="#FF69B4" style="background: #1a1a1a; color: #e0e0e0">ü©∑ R≈Ø≈æov√°</option>
              </select>
            </div>

            <!-- V√Ωchoz√≠ styl ƒç√°ry -->
            <div>
              <label style="display: block; color: #888; font-size: 11px; margin-bottom: 8px">üìè V√Ωchoz√≠ styl ƒç√°ry:</label>
              <select id="defaultLineStyleSelect" onchange="window.setDefaultLineStyle(this.value)" style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #555; border-radius: 4px; color: #e0e0e0; font-size: 12px">
                <option value="solid" style="background: #1a1a1a; color: #e0e0e0">‚îÅ‚îÅ Klasick√°</option>
                <option value="thick" style="background: #1a1a1a; color: #e0e0e0">‚îÅ‚îÅ‚îÅ Tlust√°</option>
                <option value="thin" style="background: #1a1a1a; color: #e0e0e0">‚îÄ Tenk√°</option>
                <option value="dashed" style="background: #1a1a1a; color: #e0e0e0">‚ïå ‚ïå ƒå√°rkovan√°</option>
                <option value="dotted" style="background: #1a1a1a; color: #e0e0e0">¬∑ ¬∑ Teƒçkovan√°</option>
              </select>
            </div>
          </div>
        </div>

        <!-- NASTAVEN√ç BAREV K√ìT -->
        <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #555; margin-bottom: 20px">
          <h3 style="color: #888; font-size: 12px; margin-bottom: 15px; text-transform: uppercase">üìè Nastaven√≠ Barev K√≥t</h3>
          <p style="color: #666; font-size: 11px; margin-bottom: 15px">Vyberte barvy pro k√≥ty a jejich hodnoty. Nastaven√≠ se ulo≈æ√≠ automaticky.</p>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <!-- Barva ƒçar k√≥t -->
            <div>
              <label style="display: block; color: #888; font-size: 11px; margin-bottom: 8px">üìê Barva ƒçar k√≥t:</label>
              <select id="dimensionLineColorSelect" onchange="window.setDimensionLineColor(this.value)" style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #555; border-radius: 4px; color: #e0e0e0; font-size: 12px">
                <option value="#ffa500" style="background: #1a1a1a; color: #e0e0e0">üü† Oran≈æov√° (v√Ωchoz√≠)</option>
                <option value="#FF0000" style="background: #1a1a1a; color: #e0e0e0">üî¥ ƒåerven√°</option>
                <option value="#00FF00" style="background: #1a1a1a; color: #e0e0e0">üü¢ Zelen√°</option>
                <option value="#4a9eff" style="background: #1a1a1a; color: #e0e0e0">üîµ Modr√°</option>
                <option value="#FFFF00" style="background: #1a1a1a; color: #e0e0e0">üü° ≈Ωlut√°</option>
                <option value="#FF00FF" style="background: #1a1a1a; color: #e0e0e0">üü£ Fialov√°</option>
                <option value="#00FFFF" style="background: #1a1a1a; color: #e0e0e0">‚ö™ Azurov√°</option>
                <option value="#FFFFFF" style="background: #1a1a1a; color: #e0e0e0">‚ö´ B√≠l√°</option>
                <option value="#000000" style="background: #1a1a1a; color: #e0e0e0">‚¨ú ƒåern√°</option>
                <option value="#808080" style="background: #1a1a1a; color: #e0e0e0">‚óºÔ∏è ≈†ed√°</option>
              </select>
            </div>

            <!-- Barva hodnot k√≥t -->
            <div>
              <label style="display: block; color: #888; font-size: 11px; margin-bottom: 8px">üî§ Barva hodnot k√≥t:</label>
              <select id="dimensionTextColorSelect" onchange="window.setDimensionTextColor(this.value)" style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #555; border-radius: 4px; color: #e0e0e0; font-size: 12px">
                <option value="#ffff99" style="background: #1a1a1a; color: #e0e0e0">üü° Svƒõtle ≈ælut√° (v√Ωchoz√≠)</option>
                <option value="#FFFFFF" style="background: #1a1a1a; color: #e0e0e0">‚ö´ B√≠l√°</option>
                <option value="#000000" style="background: #1a1a1a; color: #e0e0e0">‚¨ú ƒåern√°</option>
                <option value="#FF0000" style="background: #1a1a1a; color: #e0e0e0">üî¥ ƒåerven√°</option>
                <option value="#00FF00" style="background: #1a1a1a; color: #e0e0e0">üü¢ Zelen√°</option>
                <option value="#4a9eff" style="background: #1a1a1a; color: #e0e0e0">üîµ Modr√°</option>
                <option value="#FFA500" style="background: #1a1a1a; color: #e0e0e0">üü† Oran≈æov√°</option>
              </select>
            </div>
          </div>
        </div>
          <button onclick="window.closeColorStyleModal()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer">Zru≈°it</button>
          <button onclick="window.confirmColorStyle()" style="padding: 8px 16px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold">Potvrdit</button>
        </div>
      </div>
    </div>

    <div id="constraintModal" class="modal-overlay">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">üîí Fixace - Aretov√°n√≠ objekt≈Ø</h2>
        <p style="color: #aaa; font-size: 12px; margin-bottom: 15px; text-align: center">Vyberte typ fixace pro aretov√°n√≠ vybran√Ωch objekt≈Ø</p>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 15px">
          <button onclick="window.applyConstraint('point')" style="padding: 10px 12px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 11px; min-width: 70px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="this.style.background='#2a3a4a'; this.style.color='#aaa'">üìç Bod</button>
          <button onclick="window.applyConstraint('distance')" style="padding: 10px 12px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 11px; min-width: 70px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="this.style.background='#2a3a4a'; this.style.color='#aaa'">üìè Vzd√°lenost</button>
          <button onclick="window.applyConstraint('radius')" style="padding: 10px 12px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 11px; min-width: 70px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="this.style.background='#2a3a4a'; this.style.color='#aaa'">‚≠ï Radius</button>
          <button onclick="window.applyConstraint('polarAngle')" style="padding: 10px 12px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 11px; min-width: 70px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="this.style.background='#2a3a4a'; this.style.color='#aaa'">‚ü≤ Pol. √öhel</button>
          <button onclick="window.applyConstraint('horizontal')" style="padding: 10px 12px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 11px; min-width: 70px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="this.style.background='#2a3a4a'; this.style.color='#aaa'">‚û°Ô∏è Vodorovnƒõ</button>
          <button onclick="window.applyConstraint('vertical')" style="padding: 10px 12px; background: #2a3a4a; color: #aaa; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 11px; min-width: 70px; transition: all 0.2s" onmouseover="this.style.background='#3a5a7a'; this.style.color='#fff'" onmouseout="this.style.background='#2a3a4a'; this.style.color='#aaa'">‚¨ÜÔ∏è Svisle</button>
          <button onclick="window.removeConstraint('all')" style="padding: 10px 12px; background: #3a2a2a; color: #ff6b6b; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 11px; min-width: 70px; transition: all 0.2s" onmouseover="this.style.background='#5a3a3a'; this.style.color='#ff8888'" onmouseout="this.style.background='#3a2a2a'; this.style.color='#ff6b6b'">‚ùå Smazat</button>
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end">
          <button onclick="window.closeConstraintModal()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT POINT MODAL -->
    <div id="constraintPointModal" class="modal-overlay">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">üìç Fixace Bodu - Zad√°n√≠ Sou≈ôadnic</h2>
        <div class="circle-input-row">
          <label>Z (Horizont√°lnƒõ):</label>
          <input type="number" id="constraintPointZ" step="0.01" value="0" />
        </div>
        <div class="circle-input-row">
          <label>X (Vertik√°lnƒõ):</label>
          <input type="number" id="constraintPointX" step="0.01" value="0" />
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end">
          <button onclick="window.cancelConstraintValue()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer">Zru≈°it</button>
          <button onclick="window.confirmConstraintPoint()" style="padding: 8px 16px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT DISTANCE MODAL -->
    <div id="constraintDistanceModal" class="modal-overlay">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">üìè Fixace Vzd√°lenosti</h2>
        <div class="circle-input-row">
          <label>Vzd√°lenost:</label>
          <input type="number" id="constraintDistanceValue" step="0.01" value="10" />
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end">
          <button onclick="window.cancelConstraintValue()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer">Zru≈°it</button>
          <button onclick="window.confirmConstraintDistance()" style="padding: 8px 16px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT RADIUS MODAL -->
    <div id="constraintRadiusModal" class="modal-overlay">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">‚≠ï Fixace Radiusu</h2>
        <div class="circle-input-row">
          <label>Radius:</label>
          <input type="number" id="constraintRadiusValue" step="0.01" value="5" />
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end">
          <button onclick="window.cancelConstraintValue()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer">Zru≈°it</button>
          <button onclick="window.confirmConstraintRadius()" style="padding: 8px 16px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT POLAR ANGLE MODAL -->
    <div id="constraintPolarAngleModal" class="modal-overlay">
      <div class="modal-window">
        <h2 style="margin-bottom: 15px; color: #6ab0ff; font-size: 18px">‚ü≤ Fixace Pol√°rn√≠ho √öhlu</h2>
        <div class="circle-input-row">
          <label>Pol√°rn√≠ √öhel (¬∞):</label>
          <input type="number" id="constraintPolarAngleValue" step="0.1" value="0" min="0" max="360" />
        </div>
        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end">
          <button onclick="window.cancelConstraintValue()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer">Zru≈°it</button>
          <button onclick="window.confirmConstraintPolarAngle()" style="padding: 8px 16px; background: #3a7bc8; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- MODALS PLACEHOLDER - Ostatn√≠ mod√°ly se naƒç√≠taj√≠ z external soubor≈Ø -->
    <div id="quickInputHelpModal" class="modal-overlay"></div>
    <div id="controllerModal" class="modal-overlay" style="display: none; bottom: 0; top: auto; align-items: flex-end; justify-content: center; background: transparent">
      <div class="modal-window" style="max-width: 700px; border-radius: 10px 10px 0 0; margin: 0">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px">
          <h2 style="color: #6ab0ff; font-size: 18px; margin: 0">üéÆ Ovladaƒç - Rychl√© kreslen√≠ √∫seƒçek</h2>
          <button onclick="window.closeControllerModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>

        <!-- Input Display & Mode Selector -->
        <div style="margin-bottom: 12px">
          <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px">
            <button id="btnG90" onclick="window.setControllerMode('G90')" style="padding: 8px 12px; background: #3a7bc8; border: 1px solid #5a9be8; border-radius: 6px; color: white; cursor: pointer; font-size: 12px; font-weight: bold">
              G90<br /><span style="font-size: 9px">Absolutn√≠</span>
            </button>
            <button id="btnG91" onclick="window.setControllerMode('G91')" style="padding: 8px 12px; background: #2a2a2a; border: 1px solid #444; border-radius: 6px; color: #888; cursor: pointer; font-size: 12px">
              G91<br /><span style="font-size: 9px">P≈ô√≠r≈Østkov√©</span>
            </button>
            <input type="text" id="controllerInput" readonly placeholder="Zad√°n√≠..." style="flex: 1; padding: 10px; background: #000; border: 1px solid #444; border-radius: 6px; color: #0f0; font-family: 'Courier New', monospace; font-size: 16px; font-weight: bold" />
          </div>
          <div style="display: flex; gap: 10px; font-size: 11px; color: #888">
            <div><strong style="color: #6ab0ff">Re≈æim:</strong> <span id="controllerModeDisplay">G90 (Absolutn√≠)</span></div>
            <div><strong style="color: #6ab0ff">Posledn√≠ bod:</strong> <span id="controllerLastPointInline">‚Äî</span></div>
          </div>
        </div>

        <!-- Controller Layout - KL√ÅVESNICE -->
        <div style="background: #1a1a1a; padding: 12px; border-radius: 10px; border: 1px solid #444">
          <h4 style="color: #90cdf4; margin: 0 0 8px 0; text-align: center; font-size: 12px">‚å®Ô∏è CNC Zad√°n√≠</h4>

          <!-- G-Codes Row -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('G90 ')" style="padding: 4px; background: #1e3a5f; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">G90<span style="font-size: 7px; display: block">Abs</span></button>
            <button onclick="window.insertControllerToken('G91 ')" style="padding: 4px; background: #1e3a5f; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">G91<span style="font-size: 7px; display: block">P≈ô√≠r</span></button>
            <button onclick="window.insertControllerToken('G0 ')" style="padding: 4px; background: #1e3a5f; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">G0<span style="font-size: 7px; display: block">Bod</span></button>
            <button onclick="window.insertControllerToken('G1 ')" style="padding: 4px; background: #1e3a5f; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">G1<span style="font-size: 7px; display: block">ƒå√°ra</span></button>
            <button onclick="window.insertControllerToken('G2 ')" style="padding: 4px; background: #1e3a5f; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">G2<span style="font-size: 7px; display: block">CW</span></button>
            <button onclick="window.insertControllerToken('G3 ')" style="padding: 4px; background: #1e3a5f; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">G3<span style="font-size: 7px; display: block">CCW</span></button>
          </div>

          <!-- Row 1: X, Z, 7, 8, 9, ; -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('X')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">X<span style="font-size: 7px; display: block">Osa</span></button>
            <button onclick="window.insertControllerToken('Z')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">Z<span style="font-size: 7px; display: block">Osa</span></button>
            <button onclick="window.insertControllerToken('7')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">7</button>
            <button onclick="window.insertControllerToken('8')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">8</button>
            <button onclick="window.insertControllerToken('9')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">9</button>
            <button onclick="window.insertControllerToken(';')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">;<span style="font-size: 7px; display: block">Odd</span></button>
          </div>

          <!-- Row 2: R, CR, 4, 5, 6, Space -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('R')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">R<span style="font-size: 7px; display: block">Rad</span></button>
            <button onclick="window.insertControllerToken('CR')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">CR<span style="font-size: 7px; display: block">Min</span></button>
            <button onclick="window.insertControllerToken('4')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">4</button>
            <button onclick="window.insertControllerToken('5')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">5</button>
            <button onclick="window.insertControllerToken('6')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">6</button>
            <button onclick="window.insertControllerToken(' ')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">‚ê£<span style="font-size: 7px; display: block">Mezera</span></button>
          </div>

          <!-- Row 3: L, A, 1, 2, 3, Backspace -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('L')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">L<span style="font-size: 7px; display: block">D√©l</span></button>
            <button onclick="window.insertControllerToken('A')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">A<span style="font-size: 7px; display: block">√öhel</span></button>
            <button onclick="window.insertControllerToken('1')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">1</button>
            <button onclick="window.insertControllerToken('2')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">2</button>
            <button onclick="window.insertControllerToken('3')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">3</button>
            <button onclick="window.backspaceControllerToken()" style="padding: 4px; background: #8b2a2a; border: 1px solid #5a4444; border-radius: 4px; color: #ff6b6b; cursor: pointer; font-size: 11px">‚å´</button>
          </div>

          <!-- Row 4: RP, AP, -, 0, . -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 6px">
            <button onclick="window.insertControllerToken('RP')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">RP<span style="font-size: 7px; display: block">Pol</span></button>
            <button onclick="window.insertControllerToken('AP')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">AP<span style="font-size: 7px; display: block">√öhel</span></button>
            <button onclick="window.insertControllerToken('-')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">-</button>
            <button onclick="window.insertControllerToken('0')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">0</button>
            <button onclick="window.insertControllerToken('.')" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 11px">.</button>
            <button onclick="window.clearControllerInput()" style="padding: 4px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">C<span style="font-size: 7px; display: block">Clear</span></button>
          </div>

          <!-- Row 5: Smƒõry, Sra≈æen√≠, Zaoblen√≠ -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 3px; margin-bottom: 6px">
            <button onclick="window.showControllerDirectionModal()" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px; font-weight: bold">üß≠<span style="font-size: 7px; display: block">Smƒõry</span></button>
            <button onclick="window.showControllerLengthModal()" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px; font-weight: bold">üìè<span style="font-size: 7px; display: block">D√©lka</span></button>
            <button onclick="window.insertControllerToken('Zaob ')" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px; font-weight: bold">‚óØ<span style="font-size: 7px; display: block">Zaob</span></button>
          </div>

          <!-- Action Buttons -->
          <div style="margin-top: 6px">
            <button onclick="window.confirmControllerInput()" style="width: 100%; padding: 10px; background: #22c55e; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 14px; font-weight: bold">‚úì Potvrdit</button>
          </div>
        </div>

        <!-- Help Text -->
        <div style="margin-top: 12px; padding: 10px; background: #1a1a1a; border-radius: 6px; border-left: 3px solid #6ab0ff; font-size: 11px; color: #aaa">
          <strong style="color: #6ab0ff">üí° Tip:</strong> Pou≈æij <strong>G-k√≥dy</strong>: <code style="color: #90ee90">G0 X50 Z100</code> (bod), <code style="color: #90ee90">G1 X100</code> (ƒç√°ra), <code style="color: #90ee90">G2 R20</code> (oblouk)
        </div>
      </div>
    </div>
    <div id="directionModal" class="modal-overlay" style="display: none">
      <div class="modal-window" style="max-width: 350px">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 18px; margin: 0">üß≠ Smƒõrov√© kreslen√≠</h2>
          <button onclick="window.closeDirectionModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>

        <p style="color: #aaa; font-size: 12px; margin-bottom: 15px">Klikni na ≈°ipku, automaticky se vlo≈æ√≠ p≈ô√≠kaz do zad√°n√≠:</p>

        <!-- Direction Pad (8-way) -->
        <div style="display: grid; grid-template-columns: repeat(3, 80px); grid-template-rows: repeat(3, 80px); gap: 5px; justify-content: center">
          <!-- Row 1: ‚Üñ ‚Üë ‚Üó -->
          <button onclick="window.insertDirectionCommand('NW')" title="≈†ikmo vlevo nahoru (‚Üñ)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üñ</button>
          <button onclick="window.insertDirectionCommand('N')" title="Nahoru (‚Üë)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üë</button>
          <button onclick="window.insertDirectionCommand('NE')" title="≈†ikmo vpravo nahoru (‚Üó)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üó</button>

          <!-- Row 2: ‚Üê ¬∑ ‚Üí -->
          <button onclick="window.insertDirectionCommand('W')" title="Doleva (‚Üê)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üê</button>
          <div style="display: flex; align-items: center; justify-content: center; background: #1a1a1a; border-radius: 8px; color: #666; font-size: 36px">‚óè</div>
          <button onclick="window.insertDirectionCommand('E')" title="Doprava (‚Üí)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üí</button>

          <!-- Row 3: ‚Üô ‚Üì ‚Üò -->
          <button onclick="window.insertDirectionCommand('SW')" title="≈†ikmo vlevo dol≈Ø (‚Üô)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üô</button>
          <button onclick="window.insertDirectionCommand('S')" title="Dol≈Ø (‚Üì)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üì</button>
          <button onclick="window.insertDirectionCommand('SE')" title="≈†ikmo vpravo dol≈Ø (‚Üò)" style="padding: 0; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 8px; color: #90cdf4; cursor: pointer; font-size: 32px">‚Üò</button>
        </div>

        <div style="margin-top: 15px; text-align: center">
          <button onclick="window.closeDirectionModal()" style="padding: 8px 16px; background: #3a7bc8; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>
    <div id="controllerHelpModal" class="modal-overlay" style="display: none">
      <div class="modal-window" style="max-width: 650px; max-height: 80vh; overflow-y: auto">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 18px; margin: 0">‚ùì N√°povƒõda - Ovladaƒç</h2>
          <button onclick="window.closeControllerHelp()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>

        <div style="background: #1a1a1a; padding: 15px; border-radius: 8px; font-size: 12px; color: #ccc">
          <h3 style="color: #90cdf4; margin-top: 0">üìê Z√°kladn√≠ p≈ô√≠kazy</h3>
          <div style="background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px">
            <div style="margin-bottom: 8px"><code style="color: #22c55e">X80 Z120</code> - Bod na sou≈ôadnic√≠ch X=80, Z=120</div>
            <div style="margin-bottom: 8px"><code style="color: #22c55e">G1 X100 Z200</code> - ƒå√°ra do bodu X=100, Z=200</div>
            <div style="margin-bottom: 8px"><code style="color: #22c55e">G0 X50</code> - Skok (bez ƒç√°ry) na X=50</div>
          </div>

          <h3 style="color: #90cdf4">‚≠ï Kru≈ænice a oblouky</h3>
          <div style="background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px">
            <div style="margin-bottom: 8px"><code style="color: #22c55e">R50</code> - Kru≈ænice s polomƒõrem 50mm</div>
            <div style="margin-bottom: 8px"><code style="color: #22c55e">CR30</code> - Kru≈ænice s minim√°ln√≠m polomƒõrem</div>
            <div style="margin-bottom: 8px"><code style="color: #22c55e">G2 X100 Z150 R25</code> - Oblouk CW</div>
          </div>

          <h3 style="color: #90cdf4">üìè Pol√°rn√≠ sou≈ôadnice</h3>
          <div style="background: #222; padding: 10px; border-radius: 4px">
            <div style="margin-bottom: 8px"><code style="color: #22c55e">AP0 RP120</code> - ƒå√°ra √∫hel 0¬∞, d√©lka 120mm</div>
            <div style="margin-bottom: 8px"><code style="color: #22c55e">L50 A90</code> - D√©lka 50, √∫hel 90¬∞</div>
          </div>
        </div>
      </div>
    </div>

    <!-- QUICK INPUT MODAL - Kl√°vesnice pro CNC p≈ô√≠kazy -->
    <div id="quickInputModal" class="modal-overlay" style="display: none">
      <div class="modal-window" style="max-width: 550px">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 18px; margin: 0">‚å®Ô∏è Rychl√© zad√°n√≠ (CNC)</h2>
          <button onclick="window.closeQuickInput()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>

        <!-- TEXT DISPLAY -->
        <textarea id="quickInputDisplay" style="width: 100%; height: 60px; background: #111; color: #90ee90; border: 1px solid #444; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 13px; margin-bottom: 12px; resize: none" placeholder="Zde se zobrazuje zad√°n√≠..." readonly></textarea>

        <!-- ERROR DISPLAY -->
        <div id="quickInputError" style="
          display: none;
          padding: 8px;
          background: #3a1a1a;
          border: 1px solid #ff6b6b;
          border-radius: 4px;
          color: #ff6b6b;
          font-size: 11px;
          margin-bottom: 12px;
          word-break: break-word;
        "></div>

        <!-- KEYPAD GRID -->
        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; margin-bottom: 12px">
          <!-- G-Codes -->
          <button onclick="window.insertToken('G90 ')" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">G90<span style="font-size: 7px; display: block">Abs</span></button>
          <button onclick="window.insertToken('G91 ')" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">G91<span style="font-size: 7px; display: block">P≈ô√≠r</span></button>
          <button onclick="window.insertToken('G0 ')" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">G0<span style="font-size: 7px; display: block">Bod</span></button>
          <button onclick="window.insertToken('G1 ')" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">G1<span style="font-size: 7px; display: block">P≈ô√≠mka</span></button>
          <button onclick="window.insertToken('G2 ')" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">G2<span style="font-size: 7px; display: block">CW</span></button>
          <button onclick="window.insertToken('G3 ')" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">G3<span style="font-size: 7px; display: block">CCW</span></button>

          <!-- Row 1: X, Z, 7, 8, 9, ; -->
          <button onclick="window.insertToken('X')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">X<span style="font-size: 7px; display: block">Osa</span></button>
          <button onclick="window.insertToken('Z')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">Z<span style="font-size: 7px; display: block">Osa</span></button>
          <button onclick="window.insertToken('7')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">7</button>
          <button onclick="window.insertToken('8')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">8</button>
          <button onclick="window.insertToken('9')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">9</button>
          <button onclick="window.insertToken(';')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">;</button>

          <!-- Row 2: R, D, 4, 5, 6, Space -->
          <button onclick="window.insertToken('R')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">R<span style="font-size: 7px; display: block">Polomƒõr</span></button>
          <button onclick="window.insertToken('D')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">D<span style="font-size: 7px; display: block">Pr≈Ømƒõr</span></button>
          <button onclick="window.insertToken('4')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">4</button>
          <button onclick="window.insertToken('5')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">5</button>
          <button onclick="window.insertToken('6')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">6</button>
          <button onclick="window.insertToken(' ')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">Mezera</button>

          <!-- Row 3: L, A, 1, 2, 3, ? -->
          <button onclick="window.insertToken('L')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">L<span style="font-size: 7px; display: block">D√©lka</span></button>
          <button onclick="window.insertToken('A')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">A<span style="font-size: 7px; display: block">√öhel</span></button>
          <button onclick="window.insertToken('1')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">1</button>
          <button onclick="window.insertToken('2')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">2</button>
          <button onclick="window.insertToken('3')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">3</button>
          <button onclick="window.showQuickInputHelp()" style="padding: 6px; background: #444; border: 1px solid #666; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">?<span style="font-size: 7px; display: block">N√°povƒõda</span></button>

          <!-- Row 4: RP, AP, -, 0, ., ‚å´ -->
          <button onclick="window.insertToken('RP ')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">RP<span style="font-size: 7px; display: block">Pol. polomƒõr</span></button>
          <button onclick="window.insertToken('AP ')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">AP<span style="font-size: 7px; display: block">Pol. √∫hel</span></button>
          <button onclick="window.insertToken('-')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">-</button>
          <button onclick="window.insertToken('0')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">0</button>
          <button onclick="window.insertToken('.')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">.</button>
          <button onclick="window.backspaceToken()" style="padding: 6px; background: #c53030; border: 1px solid #e53e3e; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">‚å´</button>

          <!-- Row 5: Smƒõry, Sra≈æen√≠, Zaoblen√≠, V√Ωbƒõr, Vlo≈æit -->
          <button onclick="window.showDirectionModal()" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">üß≠<span style="font-size: 7px; display: block">Smƒõry</span></button>
          <button onclick="window.openLengthModal()" style="padding: 6px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 9px">üìè<span style="font-size: 7px; display: block">D√©lka</span></button>
          <button onclick="window.insertToken('Sra≈æ ')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">Sra≈æ<span style="font-size: 7px; display: block">Sra≈æen√≠</span></button>
          <button onclick="window.insertToken('Zaob ')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">Zaob<span style="font-size: 7px; display: block">Zaoblen√≠</span></button>
          <button onclick="window.insertToken('V√Ωbƒõr ')" style="padding: 6px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">V√Ωbƒõr<span style="font-size: 7px; display: block">Vybran√©</span></button>
          <button onclick="window.confirmQuickInput()" style="padding: 6px; background: #22c55e; border: 1px solid #4ade80; border-radius: 4px; color: white; cursor: pointer; font-size: 9px; grid-column: span 2">‚úì Vlo≈æit<span style="font-size: 7px; display: block">do chatu</span></button>
        </div>
      </div>
    </div>

    <!-- DIRECTION MODAL - V√Ωbƒõr smƒõru pro useƒçky -->
    <div id="directionModal" class="modal-overlay" style="display: none">
      <div class="modal-window" style="max-width: 280px">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 16px; margin: 0">üß≠ Smƒõr useƒçky</h2>
          <button onclick="window.closeDirectionModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px">
          <button onclick="window.insertDirection(45)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üñ</button>
          <button onclick="window.insertDirection(90)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üë</button>
          <button onclick="window.insertDirection(135)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üó</button>

          <button onclick="window.insertDirection(180)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üê</button>
          <button onclick="window.closeDirectionModal()" style="padding: 8px; background: #333; border: 1px solid #444; border-radius: 4px; color: #888; cursor: pointer; font-size: 14px">‚óè</button>
          <button onclick="window.insertDirection(0)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üí</button>

          <button onclick="window.insertDirection(225)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üô</button>
          <button onclick="window.insertDirection(270)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üì</button>
          <button onclick="window.insertDirection(315)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üò</button>
        </div>
      </div>
    </div>

    <!-- LENGTH MODAL - Zad√°n√≠ d√©lky useƒçky -->
    <div id="lengthModal" class="modal-overlay" style="display: none">
      <div class="modal-window" style="max-width: 300px">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 16px; margin: 0">üìè D√©lka useƒçky</h2>
          <button onclick="window.closeLengthModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>
        <input id="lengthInput" type="number" placeholder="Zadej d√©lku..." style="width: 100%; padding: 10px; background: #111; border: 1px solid #444; color: #90ee90; border-radius: 4px; font-family: monospace; margin-bottom: 10px"/>
        <div style="display: flex; gap: 8px">
          <button onclick="window.insertLengthToken('L')" style="flex: 1; padding: 8px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer">L (D√©lka)</button>
          <button onclick="window.insertLengthToken('RP')" style="flex: 1; padding: 8px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer">RP (Pol. polomƒõr)</button>
        </div>
        <button onclick="window.confirmLength()" style="width: 100%; padding: 8px; margin-top: 8px; background: #22c55e; border: 1px solid #4ade80; border-radius: 4px; color: white; cursor: pointer; font-weight: bold">‚úì Vlo≈æit</button>
      </div>
    </div>

    <!-- AI TEST SUITE MODAL -->
    <div id="aiTestModal" class="modal-overlay" style="display: none">
      <div class="modal-window" style="max-width: 700px; max-height: 85vh; overflow-y: auto">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #3a7bc8; padding-bottom: 10px">
          <h2 style="color: #6ab0ff; font-size: 18px; margin: 0">üß™ AI TEST SUITE</h2>
          <button onclick="window.closeAITestModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>

        <div id="aiTestContent" style="margin-bottom: 20px">
          <!-- Obsah se vypln√≠ dynamicky z JavaScriptu -->
        </div>

        <div style="display: flex; gap: 10px; justify-content: center; border-top: 1px solid #333; padding-top: 15px">
          <button onclick="window.closeAITestModal()" style="padding: 10px 20px; background: #444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px">‚ùå Zru≈°it</button>
        </div>
      </div>
    </div>

  </body>
</html>
```