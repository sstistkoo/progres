<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0b">
    <meta name="description" content="Mobilní HTML editor s GitHub integrací">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSFRNTCBTdHVkaW8iLCJzaG9ydF9uYW1lIjoiSFRNTCBTdHVkaW8iLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzBhMGEwYiIsInRoZW1lX2NvbG9yIjoiIzAwZDRhYSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIyYVdWM1FtOTRQU0l3SURBZ01qUWdNalFpSUdacGJHdzlJaU13TUdRMFlXRWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQSEJoZEdnZ1pEMGlUVEV5SURKak5TNDFNalFnTUNBeE1DQTBMalEzTmlBeE1DQXhNSFl4TWlJdlBqeHdZWFJvSUdROUlrMHhNaUE0YkMwMElEUWdOQ0EwSURRZ05FZ3hNbFkzTGpVaUx6NDhMM04yWno0PSIsInNpemVzIjoiMTkyeDE5MiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <title>HTML Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0b;
            --bg-secondary: #111113;
            --bg-tertiary: #1a1a1d;
            --bg-elevated: #222225;
            --accent: #00d4aa;
            --accent-dim: #00a88a;
            --accent-glow: rgba(0, 212, 170, 0.15);
            --text-primary: #e8e8ea;
            --text-secondary: #8a8a8f;
            --text-muted: #5a5a5f;
            --border: #2a2a2d;
            --border-light: #3a3a3d;
            --error: #ff6b6b;
            --warning: #ffa94d;
            --success: #51cf66;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --safe-top: env(safe-area-inset-top, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            touch-action: manipulation;
        }

        /* App Container */
        .app {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }

        /* Header */
        .header {
            height: 56px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            flex-shrink: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .nav-btn:active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-btn svg {
            width: 22px;
            height: 22px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dim) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 12px;
            color: var(--bg-primary);
        }

        .logo-text {
            font-weight: 600;
            font-size: 16px;
        }

        .logo-text span {
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 4px;
        }

        /* Skrýt některá tlačítka na mobilu */
        .hide-mobile {
            display: flex;
        }

        @media (max-width: 500px) {
            .hide-mobile {
                display: none !important;
            }
            
            .nav-btn {
                width: 36px;
                height: 36px;
            }
            
            .nav-btn svg {
                width: 20px;
                height: 20px;
            }
            
            .logo-text {
                display: none;
            }
            
            .header {
                padding: 0 8px;
            }
            
            .header-actions {
                gap: 2px;
            }
        }

        /* Více menu */
        .more-menu {
            position: fixed;
            top: 56px;
            right: 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            z-index: 200;
            display: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            min-width: 180px;
        }

        .more-menu.active {
            display: block;
        }

        .more-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }

        .more-menu-item:active {
            background: var(--bg-tertiary);
        }

        .more-menu-item svg {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            position: relative;
        }

        /* View Panels */
        .view-panel {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .view-panel.active {
            display: flex;
        }

        /* Tools Panel - Sidebar */
        .tools-panel {
            display: none;
            flex-direction: row;
            width: 33.333%;
            min-width: 120px;
            max-width: 70%;
            background: var(--bg-secondary);
            overflow: hidden;
        }

        .tools-panel.active {
            display: flex;
        }

        .tools-resize {
            width: 6px;
            background: var(--border);
            cursor: col-resize;
            flex-shrink: 0;
            touch-action: none;
        }

        .tools-resize:active,
        .tools-resize.active {
            background: var(--accent);
        }

        .tools-inner {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-left: 1px solid var(--border);
        }

        .tools-header {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .tools-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .tools-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: var(--text-secondary);
        }

        .tools-close:active {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .tools-close svg {
            width: 18px;
            height: 18px;
        }

        .tools-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            -webkit-overflow-scrolling: touch;
        }

        /* Collapsible Section */
        .collapse-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .collapse-header:active {
            background: var(--bg-elevated);
        }

        .collapse-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .collapse-title svg {
            width: 16px;
            height: 16px;
            color: var(--accent);
        }

        .collapse-arrow {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
            transition: transform 0.2s ease;
        }

        .collapse-header.open .collapse-arrow {
            transform: rotate(180deg);
        }

        .collapse-body {
            display: none;
            padding: 0 0 12px 0;
        }

        .collapse-header.open + .collapse-body,
        .collapse-body.open {
            display: block;
        }

        .files-count {
            font-size: 10px;
            font-weight: 500;
            background: var(--accent);
            color: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 4px;
        }

        /* Files List */
        .files-section {
            margin-top: 12px;
        }

        .files-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* File Tabs */
        .file-tabs {
            height: 44px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 4px;
            gap: 4px;
            flex-shrink: 0;
            position: relative;
        }

        .file-tabs-scroll {
            display: flex;
            align-items: center;
            gap: 4px;
            overflow-x: auto;
            flex: 1;
            padding: 0 4px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        .file-tabs-scroll::-webkit-scrollbar {
            height: 3px;
        }

        .file-tabs-scroll::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        .file-tabs-scroll::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .tabs-nav-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            flex-shrink: 0;
        }

        .tabs-nav-btn:active {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .tabs-nav-btn svg {
            width: 14px;
            height: 14px;
        }

        .file-tab {
            padding: 8px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .file-tab.active {
            background: var(--accent-glow);
            border-color: var(--accent);
            color: var(--accent);
        }

        .file-tab .close-tab {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 14px;
        }

        .file-tab .close-tab:active {
            background: var(--error);
            color: white;
        }

        .file-tab .unsaved {
            width: 8px;
            height: 8px;
            background: var(--warning);
            border-radius: 50%;
        }

        .add-tab-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 20px;
            flex-shrink: 0;
        }

        .add-tab-btn:active {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Code Editor */
        .code-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Search Bar */
        .search-bar {
            display: none;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            flex-direction: column;
            gap: 8px;
        }

        .search-bar.active {
            display: flex;
        }

        .search-row {
            display: flex;
            gap: 8px;
        }

        .search-input {
            flex: 1;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            color: var(--text-primary);
            outline: none;
        }

        .search-input:focus {
            border-color: var(--accent);
        }

        .search-actions {
            display: flex;
            gap: 6px;
        }

        .search-btn {
            padding: 10px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
        }

        .search-btn:active {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .search-btn.primary {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }

        .search-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-results {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Code Area */
        .code-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .code-input {
            width: 100%;
            height: 100%;
            padding: 16px;
            background: var(--bg-primary);
            border: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
            resize: none;
            outline: none;
            tab-size: 2;
            -webkit-overflow-scrolling: touch;
        }

        .code-input::placeholder {
            color: var(--text-muted);
        }

        /* Preview Panel */
        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-header {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .preview-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .preview-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .preview-actions {
            display: flex;
            gap: 4px;
        }

        .preview-frame {
            flex: 1;
            border: none;
            background: white;
        }

        /* Console Panel */
        .console-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .console-header {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .console-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .console-badge {
            padding: 2px 8px;
            background: var(--error);
            color: white;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .console-badge.warn {
            background: var(--warning);
            color: var(--bg-primary);
        }

        .console-badge.hidden {
            display: none;
        }

        .console-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            -webkit-overflow-scrolling: touch;
        }

        .console-entry {
            padding: 8px 12px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            border-bottom: 1px solid var(--border);
        }

        .console-entry.log { color: var(--text-primary); }
        .console-entry.info { color: var(--attr); }
        .console-entry.warn { color: var(--warning); background: rgba(255, 169, 77, 0.1); }
        .console-entry.error { color: var(--error); background: rgba(255, 107, 107, 0.1); }
        .console-entry.command { color: var(--accent); }
        .console-entry.result { color: var(--text-secondary); padding-left: 24px; }

        .console-message {
            flex: 1;
            word-break: break-all;
            white-space: pre-wrap;
        }

        .console-time {
            color: var(--text-muted);
            font-size: 10px;
            flex-shrink: 0;
        }

        .console-input-wrapper {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            gap: 8px;
        }

        .console-prompt {
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
        }

        .console-input {
            flex: 1;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            color: var(--text-primary);
            outline: none;
        }

        .console-input:focus {
            border-color: var(--accent);
        }

        .console-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            font-size: 13px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            height: 64px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 8px;
            flex-shrink: 0;
        }

        .bottom-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--text-muted);
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .bottom-nav-item svg {
            width: 24px;
            height: 24px;
        }

        .bottom-nav-item.active {
            color: var(--accent);
        }

        .bottom-nav-item:active {
            background: var(--bg-tertiary);
        }

        /* Bottom Sheet */
        .bottom-sheet-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .bottom-sheet-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .bottom-sheet {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-secondary);
            border-radius: 20px 20px 0 0;
            max-height: 80vh;
            z-index: 201;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            padding-bottom: var(--safe-bottom);
        }

        .bottom-sheet-overlay.active .bottom-sheet {
            transform: translateY(0);
        }

        .bottom-sheet-handle {
            width: 40px;
            height: 4px;
            background: var(--border-light);
            border-radius: 2px;
            margin: 12px auto;
        }

        .bottom-sheet-header {
            padding: 0 20px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .bottom-sheet-title {
            font-size: 18px;
            font-weight: 600;
        }

        .bottom-sheet-close {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 50%;
            color: var(--text-secondary);
        }

        .bottom-sheet-close svg {
            width: 20px;
            height: 20px;
        }

        .bottom-sheet-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
            -webkit-overflow-scrolling: touch;
        }

        /* Section Title */
        .section-title {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: 10px;
            margin-top: 16px;
        }

        .section-title:first-child {
            margin-top: 0;
        }

        /* Template List */
        .template-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .template-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
        }

        .template-item:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
        }

        .template-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .template-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Snippet Grid */
        .snippet-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .snippet-btn {
            padding: 14px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        .snippet-btn:active {
            background: var(--bg-elevated);
            color: var(--accent);
            border-color: var(--accent);
        }

        /* Compact versions for sidebar */
        .tools-panel .template-item {
            padding: 10px;
        }

        .tools-panel .template-name {
            font-size: 13px;
        }

        .tools-panel .template-desc {
            font-size: 11px;
        }

        .tools-panel .snippet-btn {
            padding: 10px 6px;
            font-size: 11px;
        }

        .tools-panel .collapse-header {
            padding: 10px;
        }

        .tools-panel .collapse-title {
            font-size: 12px;
        }

        .tools-panel .file-item {
            padding: 8px 10px;
        }

        .tools-panel .file-name {
            font-size: 11px;
        }

        /* Prompts */
        .prompts-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 10px;
        }

        .prompt-item {
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
        }

        .prompt-item:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
        }

        .prompt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .prompt-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .prompt-actions {
            display: flex;
            gap: 4px;
        }

        .prompt-action-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: var(--text-muted);
        }

        .prompt-action-btn:active {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .prompt-action-btn.delete:active {
            background: var(--error);
            color: white;
        }

        .prompt-action-btn svg {
            width: 14px;
            height: 14px;
        }

        .prompt-text {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .add-prompt-btn {
            width: 100%;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px dashed var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
        }

        .add-prompt-btn:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
            color: var(--accent);
        }

        .add-prompt-btn svg {
            width: 16px;
            height: 16px;
        }

        .prompts-empty {
            text-align: center;
            padding: 16px;
            color: var(--text-muted);
            font-size: 11px;
        }

        /* Action List */
        .action-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .action-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .action-item:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
        }

        .action-item svg {
            width: 18px;
            height: 18px;
            color: var(--accent);
            flex-shrink: 0;
        }

        .tools-panel .action-item {
            padding: 10px;
            font-size: 12px;
        }

        .tools-panel .action-item svg {
            width: 16px;
            height: 16px;
        }

        /* Settings */
        .settings-section {
            margin-bottom: 20px;
        }

        .settings-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .settings-label {
            font-size: 14px;
        }

        .settings-select {
            padding: 8px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .settings-toggle {
            position: relative;
            width: 50px;
            height: 28px;
        }

        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 28px;
            transition: 0.3s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 2px;
            bottom: 2px;
            background: var(--text-muted);
            border-radius: 50%;
            transition: 0.3s;
        }

        .settings-toggle input:checked + .toggle-slider {
            background: var(--accent);
            border-color: var(--accent);
        }

        .settings-toggle input:checked + .toggle-slider:before {
            background: white;
            transform: translateX(22px);
        }

        /* GitHub */
        .github-user {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .github-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .github-username {
            font-size: 13px;
            font-weight: 500;
        }

        .github-browser {
            max-height: 50vh;
            overflow-y: auto;
        }

        .github-path {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 10px 0;
            font-size: 12px;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .github-path-item {
            color: var(--accent);
            cursor: pointer;
        }

        .github-path-item:hover {
            text-decoration: underline;
        }

        .github-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .github-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
        }

        .github-item:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
        }

        .github-item svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .github-item.folder svg {
            color: var(--warning);
        }

        .github-item.file svg {
            color: var(--accent);
        }

        .github-item-name {
            flex: 1;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .github-item-size {
            font-size: 11px;
            color: var(--text-muted);
        }

        .github-item-actions {
            display: flex;
            gap: 4px;
        }

        .github-folder-btn {
            padding: 4px 8px;
            background: var(--accent);
            border: none;
            border-radius: 6px;
            color: var(--bg-primary);
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }

        .github-folder-btn:active {
            opacity: 0.8;
        }

        /* Loading Progress */
        .loading-progress {
            padding: 20px 0;
        }

        .loading-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .loading-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #764ba2);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
            animation: loadingPulse 1.5s ease-in-out infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .loading-status {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .loading-details {
            font-size: 12px;
            color: var(--text-muted);
            min-height: 18px;
        }

        /* Vylepšený file list */

        .files-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 12px;
        }

        .files-summary {
            font-size: 11px;
            color: var(--text-muted);
            padding: 8px 0;
            border-top: 1px solid var(--border);
            margin-top: 8px;
            display: flex;
            justify-content: space-between;
        }

        /* Stromová struktura složek */
        .folder-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .folder-item:active {
            background: var(--bg-elevated);
        }

        .folder-arrow {
            width: 14px;
            height: 14px;
            color: var(--text-muted);
            flex-shrink: 0;
            transition: transform 0.15s ease;
        }

        .folder-arrow.expanded {
            transform: rotate(90deg);
        }

        .folder-icon {
            width: 16px;
            height: 16px;
            color: var(--warning);
            flex-shrink: 0;
        }

        .folder-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
        }

        .folder-count {
            font-size: 10px;
            color: var(--text-muted);
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 10px;
        }

        .folder-content {
            margin-left: 8px;
            border-left: 1px solid var(--border);
            padding-left: 4px;
        }

        /* File item ve stromu */
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .file-item.active {
            background: var(--accent-glow);
            border-color: var(--accent);
        }

        .file-item:active {
            background: var(--bg-elevated);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }

        .file-icon {
            width: 16px;
            height: 16px;
            color: var(--accent);
            flex-shrink: 0;
        }

        .file-name {
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-unsaved {
            width: 6px;
            height: 6px;
            background: var(--warning);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .file-size {
            font-size: 10px;
            color: var(--text-muted);
            margin-left: auto;
            white-space: nowrap;
        }

        .file-close {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            flex-shrink: 0;
            margin-left: 4px;
        }

        .file-close:active {
            background: var(--error);
            color: white;
        }

        .github-loading {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
        }

        .github-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 12px;
        }

        /* GitHub Help */
        .github-help {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .github-help-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .github-help-title:active {
            background: var(--bg-tertiary);
        }

        .github-help-title svg {
            transition: transform 0.2s ease;
        }

        .github-help.open .github-help-title svg {
            transform: rotate(180deg);
        }

        .github-help-content {
            display: none;
            padding: 0 12px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .github-help.open .github-help-content {
            display: block;
        }

        .github-help-content ol {
            margin: 0;
            padding-left: 20px;
        }

        .github-help-content li {
            margin-bottom: 8px;
        }

        .github-help-content a {
            color: var(--accent);
        }

        .github-help-content strong {
            color: var(--text-primary);
        }

        .github-help-content code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        .github-help-note {
            margin-top: 10px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 11px;
        }

        /* Repo Manager */
        .repo-stats {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .repo-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .repo-stat-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent);
        }

        .repo-stat-label {
            color: var(--text-muted);
            font-size: 10px;
            text-transform: uppercase;
        }

        .repo-manager-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 50vh;
            -webkit-overflow-scrolling: touch;
        }

        .repo-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
        }

        .repo-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
        }

        .repo-card-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--accent);
            word-break: break-all;
        }

        .repo-card-badges {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .repo-badge {
            padding: 2px 6px;
            background: var(--bg-elevated);
            border-radius: 4px;
            font-size: 10px;
            color: var(--text-muted);
        }

        .repo-badge.private {
            background: var(--warning);
            color: var(--bg-primary);
        }

        .repo-card-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .repo-card-meta {
            display: flex;
            gap: 12px;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .repo-card-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .repo-card-actions {
            display: flex;
            gap: 6px;
        }

        .repo-action-btn {
            flex: 1;
            padding: 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
        }

        .repo-action-btn:active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .repo-action-btn.danger {
            color: var(--error);
        }

        .repo-action-btn.danger:active {
            background: var(--error);
            color: white;
        }

        .repo-action-btn svg {
            width: 14px;
            height: 14px;
        }

        /* Commit List */
        .commit-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .commit-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
        }

        .commit-item:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
        }

        .commit-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .commit-sha {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--accent);
            background: var(--bg-elevated);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .commit-date {
            font-size: 11px;
            color: var(--text-muted);
        }

        .commit-message {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .commit-author {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .commit-author img {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .commit-files {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .commit-file-btn {
            padding: 6px 10px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .commit-file-btn:active {
            background: var(--accent);
            color: var(--bg-primary);
        }

        /* Diff View */
        .diff-container {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            line-height: 1.5;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .diff-stats {
            display: flex;
            gap: 16px;
            padding: 12px;
            background: var(--bg-elevated);
            border-bottom: 1px solid var(--border);
            font-size: 12px;
        }

        .diff-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .diff-stat.added { color: var(--success); }
        .diff-stat.removed { color: var(--error); }
        .diff-stat.size { color: var(--text-secondary); }

        .diff-content {
            max-height: 400px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .diff-line {
            padding: 2px 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .diff-line.added {
            background: rgba(81, 207, 102, 0.15);
            color: var(--success);
        }

        .diff-line.removed {
            background: rgba(255, 107, 107, 0.15);
            color: var(--error);
        }

        .diff-line.context {
            color: var(--text-muted);
        }

        .diff-line-number {
            display: inline-block;
            width: 30px;
            color: var(--text-muted);
            user-select: none;
        }

        /* Pages Status */
        .pages-status {
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .pages-status-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .pages-status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .pages-status-icon.active {
            background: rgba(81, 207, 102, 0.2);
        }

        .pages-status-icon.inactive {
            background: rgba(255, 107, 107, 0.2);
        }

        .pages-status-title {
            font-size: 14px;
            font-weight: 500;
        }

        .pages-status-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .pages-url {
            display: block;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 8px;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            text-decoration: none;
            margin-bottom: 12px;
            word-break: break-all;
        }

        .pages-url:active {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .pages-actions {
            display: flex;
            gap: 8px;
        }

        .pages-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .pages-btn:active {
            background: var(--bg-tertiary);
        }

        .pages-btn.primary {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }

        .pages-btn.danger {
            background: var(--error);
            border-color: var(--error);
            color: white;
        }

        /* Gist List */
        .gist-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .gist-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .gist-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .gist-filename {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: var(--accent);
        }

        .gist-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--bg-elevated);
            color: var(--text-muted);
        }

        .gist-badge.public {
            background: rgba(81, 207, 102, 0.2);
            color: var(--success);
        }

        .gist-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .gist-meta {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .gist-actions {
            display: flex;
            gap: 6px;
        }

        .gist-action-btn {
            flex: 1;
            padding: 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
        }

        .gist-action-btn:active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .gist-action-btn.danger:active {
            background: var(--error);
            color: white;
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 6px;
            z-index: 500;
            min-width: 160px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: none;
        }

        .context-menu.active {
            display: block;
        }

        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .context-menu-item:active {
            background: var(--bg-tertiary);
        }

        .context-menu-item svg {
            width: 16px;
            height: 16px;
            color: var(--accent);
        }

        .context-menu-divider {
            height: 1px;
            background: var(--border);
            margin: 6px 0;
        }

        /* Responsive Preview */
        .responsive-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .responsive-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .responsive-btn svg {
            width: 18px;
            height: 18px;
        }

        .responsive-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .responsive-btn:not(.active):active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .preview-size-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-left: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .preview-source {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: var(--accent-glow);
            border: 1px solid var(--accent);
            border-radius: 6px;
            font-size: 11px;
            color: var(--accent);
            cursor: pointer;
            max-width: 150px;
            overflow: hidden;
        }

        .preview-source:active {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .preview-source svg {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
        }

        .preview-source span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (max-width: 500px) {
            .preview-source {
                display: none;
            }
        }

        .preview-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-tertiary);
            overflow: hidden;
            padding: 0;
        }

        .preview-wrapper .preview-frame {
            flex: 1;
            width: 100%;
            height: 100%;
        }

        .preview-wrapper.tablet {
            align-items: center;
            overflow: auto;
        }

        .preview-wrapper.tablet .preview-frame {
            flex: none;
            width: 768px;
            max-width: 768px;
            height: 100%;
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
        }

        .preview-wrapper.mobile {
            align-items: center;
            overflow: auto;
        }

        .preview-wrapper.mobile .preview-frame {
            flex: none;
            width: 375px;
            max-width: 375px;
            height: 100%;
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
        }

        /* Validation Modal */
        .validation-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .validation-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
        }

        .validation-item.error {
            border-left: 3px solid var(--error);
        }

        .validation-item.warning {
            border-left: 3px solid var(--warning);
        }

        .validation-item.success {
            border-left: 3px solid var(--success);
        }

        .validation-line {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-muted);
            font-size: 10px;
            margin-bottom: 4px;
        }

        .validation-message {
            color: var(--text-primary);
        }

        /* Keyboard Shortcuts */
        .shortcuts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
        }

        .shortcut-item.clickable {
            cursor: pointer;
        }

        .shortcut-item.clickable:active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .shortcut-item.clickable:active .shortcut-key {
            background: rgba(0,0,0,0.2);
            color: white;
        }

        .shortcut-key {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-elevated);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Live Server */
        .server-status {
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            text-align: center;
        }

        .server-status-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 28px;
        }

        .server-status-icon.online {
            background: rgba(81, 207, 102, 0.2);
        }

        .server-status-icon.offline {
            background: rgba(255, 107, 107, 0.2);
        }

        .server-url {
            display: block;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 8px;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            text-decoration: none;
            margin: 12px 0;
            word-break: break-all;
        }

        .server-qr {
            margin: 12px 0;
            padding: 12px;
            background: white;
            border-radius: 8px;
            display: inline-block;
        }

        .server-qr canvas {
            display: block;
        }

        /* AI Button */
        .ai-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border: none !important;
        }

        .ai-btn svg {
            color: white;
        }

        /* AI Chat Panel */
        .ai-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100%;
            background: var(--bg-secondary);
            z-index: 400;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }

        .ai-panel.active {
            right: 0;
        }

        .ai-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .ai-panel-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
        }

        .ai-panel-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .ai-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ai-message {
            padding: 12px;
            border-radius: 12px;
            font-size: 13px;
            line-height: 1.5;
            max-width: 90%;
        }

        .ai-message.user {
            background: var(--accent);
            color: var(--bg-primary);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .ai-message.assistant {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .ai-message.system {
            background: var(--bg-elevated);
            color: var(--text-muted);
            align-self: center;
            font-size: 12px;
            text-align: center;
        }

        .ai-message pre {
            background: var(--bg-primary);
            padding: 8px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 8px 0;
            font-size: 11px;
        }

        .ai-quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .ai-quick-btn {
            padding: 8px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
        }

        .ai-quick-btn:active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }

        .ai-input-area {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .ai-input {
            flex: 1;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .ai-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .ai-send-btn:disabled {
            opacity: 0.5;
        }

        .ai-send-btn svg {
            width: 20px;
            height: 20px;
        }

        .ai-typing {
            display: flex;
            gap: 4px;
            padding: 12px;
        }

        .ai-typing span {
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: aiTyping 1.4s infinite ease-in-out;
        }

        .ai-typing span:nth-child(1) { animation-delay: 0s; }
        .ai-typing span:nth-child(2) { animation-delay: 0.2s; }
        .ai-typing span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes aiTyping {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Components Panel */
        .components-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .component-card {
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
        }

        .component-card:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
        }

        .component-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .component-name {
            font-size: 12px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .component-desc {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* AI Overlay */
        .ai-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 399;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .ai-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Templates Grid */
        .templates-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .template-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
        }

        .template-card:active {
            border-color: var(--accent);
        }

        .template-preview {
            height: 100px;
            background: linear-gradient(135deg, var(--bg-elevated) 0%, var(--bg-tertiary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }

        .template-info {
            padding: 10px;
        }

        .template-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .template-desc {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Unsplash Search */
        .unsplash-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .unsplash-img {
            width: 100%;
            aspect-ratio: 4/3;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .unsplash-img:active {
            border-color: var(--accent);
        }

        /* Color Schemes */
        .color-schemes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .color-scheme {
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            border: 2px solid transparent;
        }

        .color-scheme:active {
            border-color: white;
        }

        .color-scheme-preview {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-bottom: 8px;
        }

        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .color-scheme-name {
            font-size: 11px;
            color: white;
            font-weight: 500;
        }

        /* Visual Editor Panel */
        .visual-editor {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            z-index: 350;
            transition: bottom 0.3s ease;
            max-height: 70vh;
        }

        .visual-editor.active {
            bottom: 0;
        }

        .visual-editor-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        .visual-editor-title {
            font-size: 14px;
            font-weight: 600;
        }

        .visual-editor-content {
            padding: 16px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .visual-field {
            margin-bottom: 16px;
        }

        .visual-field-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 6px;
            display: block;
        }

        .visual-field-row {
            display: flex;
            gap: 8px;
        }

        .visual-input {
            flex: 1;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
        }

        .visual-color-input {
            width: 44px;
            height: 44px;
            padding: 4px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
        }

        .visual-btn-row {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .visual-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .visual-btn.primary {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }

        .visual-btn.danger {
            background: var(--error);
            border-color: var(--error);
            color: white;
        }

        /* SEO Panel */
        .seo-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .seo-icon {
            font-size: 18px;
        }

        .seo-info {
            flex: 1;
        }

        .seo-label {
            font-size: 13px;
            color: var(--text-primary);
        }

        .seo-value {
            font-size: 11px;
            color: var(--text-muted);
        }

        .seo-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .seo-status.good { background: rgba(81, 207, 102, 0.2); }
        .seo-status.warn { background: rgba(255, 169, 77, 0.2); }
        .seo-status.bad { background: rgba(255, 107, 107, 0.2); }

        /* Device Preview */
        .device-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .device-btn {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .device-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }

        .device-frame {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 10px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .device-frame iframe {
            border-radius: 12px;
            background: white;
        }

        /* Publish Panel */
        .publish-status {
            text-align: center;
            padding: 20px;
        }

        .publish-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .publish-url {
            display: block;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            text-decoration: none;
            margin: 12px 0;
            word-break: break-all;
        }

        /* Image Upload */
        .image-upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .image-upload-area:active {
            border-color: var(--accent);
            background: var(--accent-glow);
        }

        .image-upload-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .image-upload-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .ai-error-notification {
            background: rgba(255, 107, 107, 0.1) !important;
            border: 1px solid var(--error);
        }

        /* History List */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .history-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .history-item:active {
            background: var(--bg-elevated);
            border-color: var(--accent);
        }

        .history-item.current {
            border-color: var(--accent);
            background: var(--accent-glow);
        }

        .history-label {
            font-size: 13px;
        }

        .history-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            width: 100%;
            max-width: 360px;
            transform: scale(0.95);
            transition: transform 0.2s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .modal-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            padding: 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 20px;
            outline: none;
        }

        .modal-input:focus {
            border-color: var(--accent);
        }

        textarea.modal-input {
            min-height: 100px;
            resize: vertical;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-btn:active {
            background: var(--bg-elevated);
        }

        .modal-btn.primary {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }

        .modal-btn.primary:active {
            background: var(--accent-dim);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            padding: 14px 24px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            z-index: 400;
            opacity: 0;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .toast.active {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--error); }

        /* Quick Actions FAB */
        .fab {
            position: fixed;
            right: 16px;
            bottom: 80px;
            width: 56px;
            height: 56px;
            background: var(--accent);
            border: none;
            border-radius: 16px;
            color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0, 212, 170, 0.3);
            z-index: 50;
        }

        .fab:active {
            transform: scale(0.95);
        }

        .fab svg {
            width: 28px;
            height: 28px;
        }

        .fab.hidden {
            display: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="nav-btn" onclick="history.back()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                </button>
                <div class="logo">
                    <div class="logo-icon">&lt;/&gt;</div>
                    <div class="logo-text">HTML <span>Studio</span></div>
                </div>
            </div>
            <div class="header-actions">
                <button class="nav-btn ai-btn" onclick="openAIChat()" title="AI Asistent">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A1.5 1.5 0 0 0 6 14.5 1.5 1.5 0 0 0 7.5 16 1.5 1.5 0 0 0 9 14.5 1.5 1.5 0 0 0 7.5 13m9 0a1.5 1.5 0 0 0-1.5 1.5 1.5 1.5 0 0 0 1.5 1.5 1.5 1.5 0 0 0 1.5-1.5 1.5 1.5 0 0 0-1.5-1.5"/></svg>
                </button>
                <button class="nav-btn hide-mobile" onclick="openComponentsPanel()" title="Komponenty">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                </button>
                <button class="nav-btn hide-mobile" onclick="openTemplates()" title="Šablony">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                </button>
                <button class="nav-btn hide-mobile" onclick="openUnsplash()" title="Obrázky">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                </button>
                <button class="nav-btn" onclick="openShortcuts()" title="Rychlé akce">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h.01M12 12h.01M16 12h.01M6 16h8"/></svg>
                </button>
                <button class="nav-btn hide-mobile" onclick="openLiveServer()" title="Živý server">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"/></svg>
                </button>
                <button class="nav-btn hide-mobile" onclick="formatCode()" title="Formátovat kód">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="21" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="7" y2="6"/><line x1="21" y1="14" x2="7" y2="14"/><line x1="21" y1="18" x2="3" y2="18"/></svg>
                </button>
                <button class="nav-btn hide-mobile" onclick="toggleSearch()" id="searchToggle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                </button>
                <button class="nav-btn" onclick="toggleMoreMenu()" id="moreBtn" title="Více">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                </button>
                <button class="nav-btn hide-mobile" onclick="openSettings()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                </button>
            </div>
        </header>

        <!-- Více menu (dropdown) -->
        <div class="more-menu" id="moreMenu">
            <button class="more-menu-item" onclick="openComponentsPanel();closeMoreMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                Komponenty
            </button>
            <button class="more-menu-item" onclick="openTemplates();closeMoreMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                Šablony
            </button>
            <button class="more-menu-item" onclick="openUnsplash();closeMoreMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                Obrázky
            </button>
            <button class="more-menu-item" onclick="openLiveServer();closeMoreMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49"/></svg>
                Živý server
            </button>
            <button class="more-menu-item" onclick="formatCode();closeMoreMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="21" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="7" y2="6"/><line x1="21" y1="14" x2="7" y2="14"/><line x1="21" y1="18" x2="3" y2="18"/></svg>
                Formátovat kód
            </button>
            <button class="more-menu-item" onclick="toggleSearch();closeMoreMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                Hledat
            </button>
            <button class="more-menu-item" onclick="openSettings();closeMoreMenu();">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33"/></svg>
                Nastavení
            </button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Code View -->
            <div class="view-panel active" id="codeView">
                <div class="file-tabs" id="fileTabs"></div>
                <div class="code-editor">
                    <div class="search-bar" id="searchBar">
                        <div class="search-row">
                            <input type="text" class="search-input" id="searchInput" placeholder="Hledat...">
                        </div>
                        <div class="search-row">
                            <input type="text" class="search-input" id="replaceInput" placeholder="Nahradit...">
                        </div>
                        <div class="search-info">
                            <span class="search-results" id="searchResults"></span>
                            <div class="search-actions">
                                <button class="search-btn" onclick="findPrev()">◀</button>
                                <button class="search-btn" onclick="findNext()">▶</button>
                                <button class="search-btn" onclick="replaceOne()">Nahradit</button>
                                <button class="search-btn primary" onclick="replaceAll()">Vše</button>
                            </div>
                        </div>
                    </div>
                    <div class="code-area">
                        <textarea class="code-input" id="codeInput" spellcheck="false" placeholder="Začněte psát HTML kód..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Preview View -->
            <div class="view-panel" id="previewView">
                <div class="preview-container">
                    <div class="preview-header">
                        <div class="responsive-buttons">
                            <button class="responsive-btn active" onclick="setPreviewSize('full')" data-size="full" title="100%">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                            </button>
                            <button class="responsive-btn" onclick="setPreviewSize('tablet')" data-size="tablet" title="768px">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
                            </button>
                            <button class="responsive-btn" onclick="setPreviewSize('mobile')" data-size="mobile" title="375px">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="2" width="12" height="20" rx="2"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
                            </button>
                            <span class="preview-size-label" id="previewSizeLabel">100%</span>
                        </div>
                        <div class="preview-source" id="previewSource" onclick="switchToPreviewSource()" title="Klikni pro přepnutí na tento soubor">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            <span id="previewSourceName">index.html</span>
                        </div>
                        <div class="preview-actions">
                            <button class="nav-btn" onclick="validateHTML()" title="Validovat">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            </button>
                            <button class="nav-btn" onclick="minifyCode()" title="Minifikovat">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" y1="10" x2="21" y2="3"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
                            </button>
                            <button class="nav-btn" onclick="refreshPreview()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                            </button>
                            <button class="nav-btn" onclick="openInNewTab()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="preview-wrapper" id="previewWrapper">
                        <iframe class="preview-frame" id="previewFrame"></iframe>
                    </div>
                </div>
            </div>

            <!-- Console View -->
            <div class="view-panel" id="consoleView">
                <div class="console-container">
                    <div class="console-header">
                        <div class="console-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
                            Konzole
                            <span class="console-badge hidden" id="errorBadge">0</span>
                            <span class="console-badge warn hidden" id="warnBadge">0</span>
                        </div>
                        <button class="nav-btn" onclick="clearConsole()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>
                        </button>
                    </div>
                    <div class="console-content" id="consoleContent">
                        <div class="console-empty">Konzole je prázdná</div>
                    </div>
                    <div class="console-input-wrapper">
                        <span class="console-prompt">&gt;</span>
                        <input type="text" class="console-input" id="consoleInput" placeholder="JavaScript..." onkeydown="handleConsoleInput(event)">
                    </div>
                </div>
            </div>

            <!-- Tools View -->
            <div class="view-panel" id="toolsView">
                <div class="bottom-sheet-content" style="height:100%; overflow:auto; padding:16px;">
                    <!-- Šablony & Snippety - rozbalovací -->
                    <div class="collapse-header" onclick="toggleCollapse(this)">
                        <div class="collapse-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                            Šablony & Snippety
                        </div>
                        <svg class="collapse-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </div>
                    <div class="collapse-body">
                        <div class="section-title" style="margin-top:0;">Šablony</div>
                        <div class="template-list">
                            <div class="template-item" onclick="loadTemplate('blank')">
                                <div class="template-name">Prázdná stránka</div>
                                <div class="template-desc">Základní HTML5 struktura</div>
                            </div>
                            <div class="template-item" onclick="loadTemplate('landing')">
                                <div class="template-name">Landing Page</div>
                                <div class="template-desc">Hero sekce + CTA</div>
                            </div>
                            <div class="template-item" onclick="loadTemplate('form')">
                                <div class="template-name">Formulář</div>
                                <div class="template-desc">Kontaktní formulář</div>
                            </div>
                            <div class="template-item" onclick="loadTemplate('grid')">
                                <div class="template-name">Grid Layout</div>
                                <div class="template-desc">CSS Grid galerie</div>
                            </div>
                            <div class="template-item" onclick="loadTemplate('dashboard')">
                                <div class="template-name">Dashboard</div>
                                <div class="template-desc">Admin rozhraní</div>
                            </div>
                        </div>

                        <div class="section-title">Snippety</div>
                        <div class="snippet-grid">
                            <button class="snippet-btn" onclick="insertSnippet('div')">&lt;div&gt;</button>
                            <button class="snippet-btn" onclick="insertSnippet('flex')">flexbox</button>
                            <button class="snippet-btn" onclick="insertSnippet('grid')">grid</button>
                            <button class="snippet-btn" onclick="insertSnippet('btn')">button</button>
                            <button class="snippet-btn" onclick="insertSnippet('input')">input</button>
                            <button class="snippet-btn" onclick="insertSnippet('img')">img</button>
                            <button class="snippet-btn" onclick="insertSnippet('link')">link</button>
                            <button class="snippet-btn" onclick="insertSnippet('table')">table</button>
                        </div>
                    </div>

                    <!-- Otevřené soubory - sbalitelné -->
                    <div class="files-section">
                        <div class="collapse-header open" onclick="toggleCollapse(this)">
                            <div class="collapse-title">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                                Otevřené soubory
                                <span class="files-count" id="filesCountMain"></span>
                            </div>
                            <svg class="collapse-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="collapse-body open">
                            <div class="files-list" id="filesListMain"></div>
                        </div>
                    </div>

                    <!-- Historie -->
                    <div class="section-title">Historie změn</div>
                    <div class="history-list" id="historyList"></div>
                </div>
            </div>

            <!-- Tools Sidebar Panel -->
            <aside class="tools-panel" id="toolsPanel">
                <div class="tools-resize" id="toolsResize"></div>
                <div class="tools-inner">
                    <div class="tools-header">
                        <span class="tools-title">Panel</span>
                        <button class="tools-close" onclick="toggleTools()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                    <div class="tools-content">
                        <!-- Soubory - sbalitelné -->
                        <div class="collapse-header open" onclick="toggleCollapse(this)" style="margin-top:0;">
                            <div class="collapse-title">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                                Otevřené soubory
                                <span class="files-count" id="filesCount"></span>
                            </div>
                            <svg class="collapse-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="collapse-body open">
                            <div class="files-list" id="filesList"></div>
                        </div>

                        <!-- Akce - rozbalovací -->
                        <div class="collapse-header" onclick="toggleCollapse(this)" style="margin-top:12px;">
                            <div class="collapse-title">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>
                                Akce
                            </div>
                            <svg class="collapse-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="collapse-body">
                            <div class="action-list">
                                <div class="action-item" onclick="addNewTab()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
                                    Nový soubor
                                </div>
                                <div class="action-item" onclick="saveToLocal()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                                    Uložit
                                </div>
                                <div class="action-item" onclick="downloadFile()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                    Stáhnout
                                </div>
                                <div class="action-item" onclick="openImportModal()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c-1.66 0-3-4.03-3-9s1.34-9 3-9m0 18c1.66 0 3-4.03 3-9s-1.34-9-3-9"/></svg>
                                    Import z URL
                                </div>
                            </div>
                        </div>

                        <!-- Prompty - rozbalovací -->
                        <div class="collapse-header" onclick="toggleCollapse(this)" style="margin-top:8px;">
                            <div class="collapse-title">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                Prompty
                            </div>
                            <svg class="collapse-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="collapse-body">
                            <div class="prompts-list" id="promptsList"></div>
                            <button class="add-prompt-btn" onclick="openAddPromptModal()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                Přidat prompt
                            </button>
                        </div>

                        <!-- GitHub - rozbalovací -->
                        <div class="collapse-header" onclick="toggleCollapse(this)" style="margin-top:8px;">
                            <div class="collapse-title">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
                                GitHub
                            </div>
                            <svg class="collapse-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="collapse-body">
                            <div id="githubContent">
                                <div class="github-not-connected" id="githubNotConnected">
                                    <p style="font-size:11px;color:var(--text-muted);margin-bottom:10px;">Připoj GitHub token v nastavení</p>
                                    <button class="add-prompt-btn" onclick="openSettings()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                        Nastavení
                                    </button>
                                </div>
                                <div class="github-connected" id="githubConnected" style="display:none;">
                                    <div class="github-user" id="githubUser"></div>
                                    <div class="action-list" style="margin-top:8px;">
                                        <div class="action-item" onclick="openGithubBrowser()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                                            Procházet soubory
                                        </div>
                                        <div class="action-item" onclick="openRepoManager()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                                            Správa repozitářů
                                        </div>
                                        <div class="action-item" onclick="openGithubPages()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a9.96 9.96 0 0 1 4 8 9.96 9.96 0 0 1-4 8 9.96 9.96 0 0 1-4-8 9.96 9.96 0 0 1 4-8z"/></svg>
                                            GitHub Pages
                                        </div>
                                        <div class="action-item" onclick="openCommitHistory()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><line x1="12" y1="3" x2="12" y2="9"/><line x1="12" y1="15" x2="12" y2="21"/></svg>
                                            Historie commitů
                                        </div>
                                        <div class="action-item" onclick="openDiffView()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><polyline points="6 6 6 18 18 18"/></svg>
                                            Porovnat změny
                                        </div>
                                        <div class="action-item" onclick="openGistManager()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                                            Gists
                                        </div>
                                        <div class="action-item" onclick="openForkModal()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><path d="M18 9v1a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V9"/><line x1="12" y1="12" x2="12" y2="15"/></svg>
                                            Fork cizího repo
                                        </div>
                                        <div class="action-item" onclick="saveToGithub()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                                            Uložit na GitHub
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="bottom-nav-item active" onclick="switchView('code')" data-view="code">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                Kód
            </button>
            <button class="bottom-nav-item" onclick="switchView('preview')" data-view="preview">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                Náhled
            </button>
            <button class="bottom-nav-item" onclick="switchView('console')" data-view="console">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
                Konzole
            </button>
            <button class="bottom-nav-item" onclick="switchView('tools')" data-view="tools">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                Nástroje
            </button>
        </nav>
    </div>

    <!-- Settings Bottom Sheet -->
    <div class="bottom-sheet-overlay" id="settingsSheet" onclick="closeSettings()">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <div class="bottom-sheet-handle"></div>
            <div class="bottom-sheet-header">
                <div class="bottom-sheet-title">Nastavení</div>
                <button class="bottom-sheet-close" onclick="closeSettings()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="bottom-sheet-content">
                <div class="settings-section">
                    <div class="settings-title">🤖 AI Asistent</div>
                    <div class="settings-item" style="flex-direction:column;align-items:stretch;gap:10px;">
                        <span class="settings-label">Provider</span>
                        <select class="settings-select" id="aiProvider" onchange="onProviderChange()" style="width:100%;">
                            <option value="gemini">⚡ Google Gemini</option>
                            <option value="groq">🚀 Groq (nejrychlejší)</option>
                            <option value="openrouter">🌐 OpenRouter</option>
                            <option value="mistral">🔥 Mistral AI</option>
                            <option value="cohere">🧠 Cohere</option>
                            <option value="huggingface">🤗 Hugging Face</option>
                        </select>
                    </div>
                    <div class="settings-item" style="flex-direction:column;align-items:stretch;gap:10px;">
                        <span class="settings-label">Model</span>
                        <select class="settings-select" id="aiModel" onchange="saveAISettings()" style="width:100%;">
                        </select>
                    </div>
                    <div class="settings-item" style="flex-direction:column;align-items:stretch;gap:10px;">
                        <span class="settings-label">Vlastní API Klíč (volitelné)</span>
                        <input type="password" class="modal-input" id="aiApiKey" placeholder="Použít demo klíč" style="margin:0;" onchange="saveAISettings()">
                        <div style="font-size:11px;color:var(--success);">
                            ✓ Demo klíče jsou zabudované - funguje hned!
                        </div>
                    </div>
                    <div id="demoKeyWarning" style="display:none;font-size:11px;color:var(--warning);padding:8px;background:rgba(255,169,77,0.1);border-radius:8px;margin-top:8px;">
                        ⚠️ Používáš demo klíč - má omezení. Pro plné využití si vytvoř vlastní.
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">Editor</div>
                    <div class="settings-item">
                        <span class="settings-label">Velikost písma</span>
                        <select class="settings-select" id="fontSizeSelect" onchange="changeFontSize(this.value)">
                            <option value="12">12px</option>
                            <option value="14" selected>14px</option>
                            <option value="16">16px</option>
                            <option value="18">18px</option>
                            <option value="20">20px</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <span class="settings-label">Zalamování řádků</span>
                        <label class="settings-toggle">
                            <input type="checkbox" id="wordWrapToggle" onchange="toggleWordWrap(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <span class="settings-label">Automatické zavírání tagů</span>
                        <label class="settings-toggle">
                            <input type="checkbox" id="autoCloseToggle" onchange="toggleAutoClose(this.checked)" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">GitHub</div>
                    <div class="settings-item" style="flex-direction:column;align-items:stretch;gap:10px;">
                        <span class="settings-label">Personal Access Token</span>
                        <input type="password" class="modal-input" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" style="margin:0;">
                        <button class="modal-btn primary" onclick="saveGithubToken()">Uložit token</button>
                        
                        <div class="github-help">
                            <div class="github-help-title" onclick="this.parentElement.classList.toggle('open')">
                                <span>📖 Jak získat token?</span>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="github-help-content">
                                <ol>
                                    <li>Otevři <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a></li>
                                    <li>Klikni na <strong>"Generate new token"</strong> → <strong>"Classic"</strong></li>
                                    <li>Zadej název (např. "HTML Studio")</li>
                                    <li>Vyber expiraci (doporučeno 90 dní nebo "No expiration")</li>
                                    <li>Zaškrtni oprávnění <strong>"repo"</strong> (celá sekce)</li>
                                    <li>Klikni <strong>"Generate token"</strong></li>
                                    <li>Zkopíruj token (začíná <code>ghp_</code>)</li>
                                    <li>Vlož ho sem a ulož</li>
                                </ol>
                                <div class="github-help-note">
                                    ⚠️ Token se zobrazí jen jednou! Ulož si ho bezpečně.
                                </div>
                                <div class="github-help-note">
                                    🔒 Token je uložen pouze v tomto prohlížeči (localStorage).
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-item" id="githubDisconnectItem" style="display:none;">
                        <span class="settings-label">Odpojit GitHub</span>
                        <button class="modal-btn" onclick="disconnectGithub()" style="background:var(--error);border-color:var(--error);color:white;">Odpojit</button>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">Data</div>
                    <div class="action-item" onclick="exportAllData()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Exportovat vše
                    </div>
                    <div class="action-item" onclick="clearAllData()" style="color:var(--error);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:var(--error);"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Smazat všechna data
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="newTabModal">
        <div class="modal">
            <div class="modal-title">Nový soubor</div>
            <input type="text" class="modal-input" id="newTabName" placeholder="nazev.html">
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeNewTabModal()">Zrušit</button>
                <button class="modal-btn primary" onclick="confirmNewTab()">Vytvořit</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="saveModal">
        <div class="modal">
            <div class="modal-title">Stáhnout soubor</div>
            <input type="text" class="modal-input" id="fileName" placeholder="index.html">
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeSaveModal()">Zrušit</button>
                <button class="modal-btn primary" onclick="confirmDownload()">Stáhnout</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-title">Import z URL</div>
            <div class="modal-desc">Zadejte URL webové stránky</div>
            <input type="text" class="modal-input" id="importUrl" placeholder="https://example.com">
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeImportModal()">Zrušit</button>
                <button class="modal-btn primary" onclick="importFromUrl()">Importovat</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- AI Overlay -->
    <div class="ai-overlay" id="aiOverlay" onclick="closeAIChat()"></div>

    <!-- AI Chat Panel -->
    <div class="ai-panel" id="aiPanel">
        <div class="ai-panel-header">
            <div class="ai-panel-title">🤖 AI Asistent</div>
            <button class="ai-panel-close" onclick="closeAIChat()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div class="ai-messages" id="aiMessages">
            <div class="ai-message system">
                Napiš co chceš vytvořit nebo upravit. AI vygeneruje HTML kód.
            </div>
        </div>
        <div class="ai-quick-actions">
            <button class="ai-quick-btn" onclick="aiQuickAction('Vytvoř landing page')">🏠 Landing page</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Přidej navigaci')">📍 Navigace</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Přidej footer')">📋 Footer</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Vylepši design')">✨ Vylepši</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Oprav chyby')">🔧 Oprav</button>
            <button class="ai-quick-btn" onclick="aiQuickAction('Přidej animace')">🎬 Animace</button>
        </div>
        <div class="ai-input-area">
            <textarea class="ai-input" id="aiInput" placeholder="Napiš co chceš..." rows="1" onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault();sendAIMessage();}"></textarea>
            <button class="ai-send-btn" onclick="sendAIMessage()" id="aiSendBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            </button>
        </div>
    </div>

    <!-- Components Modal -->
    <div class="modal-overlay" id="componentsModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-title">🧱 Komponenty</div>
            <div class="modal-desc">Klikni pro vložení. AI přizpůsobí komponentu tvé stránce.</div>
            <div class="components-grid">
                <div class="component-card" onclick="insertComponent('header')">
                    <div class="component-icon">📍</div>
                    <div class="component-name">Header</div>
                    <div class="component-desc">Navigace s logem</div>
                </div>
                <div class="component-card" onclick="insertComponent('hero')">
                    <div class="component-icon">🦸</div>
                    <div class="component-name">Hero sekce</div>
                    <div class="component-desc">Hlavní banner</div>
                </div>
                <div class="component-card" onclick="insertComponent('features')">
                    <div class="component-icon">⭐</div>
                    <div class="component-name">Features</div>
                    <div class="component-desc">3 sloupce výhod</div>
                </div>
                <div class="component-card" onclick="insertComponent('cards')">
                    <div class="component-icon">🃏</div>
                    <div class="component-name">Karty</div>
                    <div class="component-desc">Grid produktů</div>
                </div>
                <div class="component-card" onclick="insertComponent('gallery')">
                    <div class="component-icon">🖼️</div>
                    <div class="component-name">Galerie</div>
                    <div class="component-desc">Mřížka obrázků</div>
                </div>
                <div class="component-card" onclick="insertComponent('testimonials')">
                    <div class="component-icon">💬</div>
                    <div class="component-name">Reference</div>
                    <div class="component-desc">Recenze zákazníků</div>
                </div>
                <div class="component-card" onclick="insertComponent('pricing')">
                    <div class="component-icon">💰</div>
                    <div class="component-name">Ceník</div>
                    <div class="component-desc">Tabulka cen</div>
                </div>
                <div class="component-card" onclick="insertComponent('contact')">
                    <div class="component-icon">📧</div>
                    <div class="component-name">Kontakt</div>
                    <div class="component-desc">Formulář</div>
                </div>
                <div class="component-card" onclick="insertComponent('cta')">
                    <div class="component-icon">🎯</div>
                    <div class="component-name">CTA</div>
                    <div class="component-desc">Výzva k akci</div>
                </div>
                <div class="component-card" onclick="insertComponent('footer')">
                    <div class="component-icon">📋</div>
                    <div class="component-name">Footer</div>
                    <div class="component-desc">Patička stránky</div>
                </div>
                <div class="component-card" onclick="insertComponent('faq')">
                    <div class="component-icon">❓</div>
                    <div class="component-name">FAQ</div>
                    <div class="component-desc">Časté otázky</div>
                </div>
                <div class="component-card" onclick="insertComponent('stats')">
                    <div class="component-icon">📊</div>
                    <div class="component-name">Statistiky</div>
                    <div class="component-desc">Čísla a fakta</div>
                </div>
            </div>
            <div class="modal-actions" style="margin-top:16px;">
                <button class="modal-btn" onclick="closeComponentsPanel()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Templates Modal -->
    <div class="modal-overlay" id="templatesModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-title">📄 Hotové šablony</div>
            <div class="modal-desc">Kompletní stránky připravené k úpravě</div>
            <div class="templates-grid">
                <div class="template-card" onclick="loadTemplate('landing')">
                    <div class="template-preview">🏠</div>
                    <div class="template-info">
                        <div class="template-name">Landing Page</div>
                        <div class="template-desc">Produkt / Služba</div>
                    </div>
                </div>
                <div class="template-card" onclick="loadTemplate('portfolio')">
                    <div class="template-preview">👤</div>
                    <div class="template-info">
                        <div class="template-name">Portfolio</div>
                        <div class="template-desc">Osobní prezentace</div>
                    </div>
                </div>
                <div class="template-card" onclick="loadTemplate('restaurant')">
                    <div class="template-preview">🍽️</div>
                    <div class="template-info">
                        <div class="template-name">Restaurace</div>
                        <div class="template-desc">Jídelní lístek</div>
                    </div>
                </div>
                <div class="template-card" onclick="loadTemplate('business')">
                    <div class="template-preview">🏢</div>
                    <div class="template-info">
                        <div class="template-name">Firma</div>
                        <div class="template-desc">Firemní web</div>
                    </div>
                </div>
                <div class="template-card" onclick="loadTemplate('blog')">
                    <div class="template-preview">📝</div>
                    <div class="template-info">
                        <div class="template-name">Blog</div>
                        <div class="template-desc">Články a novinky</div>
                    </div>
                </div>
                <div class="template-card" onclick="loadTemplate('eshop')">
                    <div class="template-preview">🛒</div>
                    <div class="template-info">
                        <div class="template-name">E-shop</div>
                        <div class="template-desc">Produkty</div>
                    </div>
                </div>
                <div class="template-card" onclick="loadTemplate('event')">
                    <div class="template-preview">🎉</div>
                    <div class="template-info">
                        <div class="template-name">Událost</div>
                        <div class="template-desc">Svatba / Akce</div>
                    </div>
                </div>
                <div class="template-card" onclick="loadTemplate('app')">
                    <div class="template-preview">📱</div>
                    <div class="template-info">
                        <div class="template-name">Aplikace</div>
                        <div class="template-desc">Prezentace appky</div>
                    </div>
                </div>
            </div>
            <div class="modal-actions" style="margin-top:16px;">
                <button class="modal-btn" onclick="closeTemplates()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Unsplash Modal -->
    <div class="modal-overlay" id="unsplashModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-title">🖼️ Obrázky z Unsplash</div>
            <div style="display:flex;gap:8px;margin-bottom:12px;">
                <input type="text" class="modal-input" id="unsplashQuery" placeholder="Hledat obrázky..." style="margin:0;flex:1;">
                <button class="modal-btn primary" onclick="searchUnsplash()">Hledat</button>
            </div>
            <div class="unsplash-grid" id="unsplashGrid">
                <div style="grid-column:1/-1;text-align:center;color:var(--text-muted);padding:20px;">
                    Zadej hledaný výraz (anglicky funguje lépe)
                </div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeUnsplash()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Color Schemes Modal -->
    <div class="modal-overlay" id="colorSchemesModal">
        <div class="modal" style="max-width:400px;">
            <div class="modal-title">🎨 Barevné schéma</div>
            <div class="modal-desc">Změní barvy celé stránky</div>
            <div class="color-schemes">
                <div class="color-scheme" style="background:linear-gradient(135deg,#1a1a2e,#16213e);" onclick="applyColorScheme('dark')">
                    <div class="color-scheme-preview">
                        <div class="color-dot" style="background:#0f0f23;"></div>
                        <div class="color-dot" style="background:#00d4aa;"></div>
                        <div class="color-dot" style="background:#ffffff;"></div>
                    </div>
                    <div class="color-scheme-name">Tmavé</div>
                </div>
                <div class="color-scheme" style="background:linear-gradient(135deg,#f5f5f5,#e0e0e0);" onclick="applyColorScheme('light')">
                    <div class="color-scheme-preview">
                        <div class="color-dot" style="background:#ffffff;"></div>
                        <div class="color-dot" style="background:#2196f3;"></div>
                        <div class="color-dot" style="background:#333333;"></div>
                    </div>
                    <div class="color-scheme-name" style="color:#333;">Světlé</div>
                </div>
                <div class="color-scheme" style="background:linear-gradient(135deg,#667eea,#764ba2);" onclick="applyColorScheme('purple')">
                    <div class="color-scheme-preview">
                        <div class="color-dot" style="background:#667eea;"></div>
                        <div class="color-dot" style="background:#764ba2;"></div>
                        <div class="color-dot" style="background:#ffffff;"></div>
                    </div>
                    <div class="color-scheme-name">Fialové</div>
                </div>
                <div class="color-scheme" style="background:linear-gradient(135deg,#11998e,#38ef7d);" onclick="applyColorScheme('green')">
                    <div class="color-scheme-preview">
                        <div class="color-dot" style="background:#11998e;"></div>
                        <div class="color-dot" style="background:#38ef7d;"></div>
                        <div class="color-dot" style="background:#ffffff;"></div>
                    </div>
                    <div class="color-scheme-name">Zelené</div>
                </div>
                <div class="color-scheme" style="background:linear-gradient(135deg,#ee0979,#ff6a00);" onclick="applyColorScheme('orange')">
                    <div class="color-scheme-preview">
                        <div class="color-dot" style="background:#ee0979;"></div>
                        <div class="color-dot" style="background:#ff6a00;"></div>
                        <div class="color-dot" style="background:#ffffff;"></div>
                    </div>
                    <div class="color-scheme-name">Oranžové</div>
                </div>
                <div class="color-scheme" style="background:linear-gradient(135deg,#2193b0,#6dd5ed);" onclick="applyColorScheme('blue')">
                    <div class="color-scheme-preview">
                        <div class="color-dot" style="background:#2193b0;"></div>
                        <div class="color-dot" style="background:#6dd5ed;"></div>
                        <div class="color-dot" style="background:#ffffff;"></div>
                    </div>
                    <div class="color-scheme-name">Modré</div>
                </div>
            </div>
            <div class="modal-actions" style="margin-top:16px;">
                <button class="modal-btn" onclick="closeColorSchemes()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- SEO Modal -->
    <div class="modal-overlay" id="seoModal">
        <div class="modal" style="max-width:450px;">
            <div class="modal-title">🔍 SEO Kontrola</div>
            <div id="seoResults" style="max-height:50vh;overflow-y:auto;">
                <div class="github-loading">Analyzuji...</div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeSEO()">Zavřít</button>
                <button class="modal-btn primary" onclick="fixSEOWithAI()">🤖 Opravit pomocí AI</button>
            </div>
        </div>
    </div>

    <!-- Device Preview Modal -->
    <div class="modal-overlay" id="devicesModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-title">📱 Test na zařízeních</div>
            <div class="device-selector">
                <button class="device-btn active" onclick="setDevice('iphone14', 390, 844)">📱 iPhone 14</button>
                <button class="device-btn" onclick="setDevice('iphone-se', 375, 667)">📱 iPhone SE</button>
                <button class="device-btn" onclick="setDevice('pixel', 412, 915)">📱 Pixel 7</button>
                <button class="device-btn" onclick="setDevice('samsung', 360, 800)">📱 Samsung</button>
                <button class="device-btn" onclick="setDevice('ipad', 768, 1024)">📱 iPad</button>
            </div>
            <div style="text-align:center;overflow:auto;max-height:50vh;">
                <div class="device-frame" id="deviceFrame" style="width:390px;">
                    <iframe id="devicePreview" style="width:100%;height:500px;border:none;"></iframe>
                </div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeDevices()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Publish Modal -->
    <div class="modal-overlay" id="publishModal">
        <div class="modal" style="max-width:400px;">
            <div class="modal-title">🚀 Publikovat stránku</div>
            <div class="publish-status" id="publishStatus">
                <div class="publish-icon">🌐</div>
                <div style="font-size:14px;margin-bottom:8px;">Publikuj na GitHub Pages</div>
                <div style="font-size:12px;color:var(--text-muted);margin-bottom:16px;">
                    Stránka bude dostupná na internetu zdarma
                </div>
            </div>
            <div style="margin-bottom:12px;">
                <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Název repozitáře</label>
                <input type="text" class="modal-input" id="publishRepoName" placeholder="moje-stranka" style="margin:0;">
            </div>
            <div id="publishResult" style="display:none;"></div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closePublish()">Zavřít</button>
                <button class="modal-btn primary" onclick="publishToGitHub()">🚀 Publikovat</button>
            </div>
        </div>
    </div>

    <!-- Screenshot to HTML Modal -->
    <div class="modal-overlay" id="screenshotModal">
        <div class="modal" style="max-width:450px;">
            <div class="modal-title">📷 AI z obrázku</div>
            <div class="modal-desc">Nahraj screenshot stránky a AI vytvoří podobnou</div>
            <div class="image-upload-area" onclick="document.getElementById('screenshotInput').click()">
                <div class="image-upload-icon">📤</div>
                <div class="image-upload-text">Klikni pro nahrání obrázku</div>
                <input type="file" id="screenshotInput" accept="image/*" style="display:none;" onchange="handleScreenshot(this)">
            </div>
            <img id="screenshotPreview" class="image-preview" style="display:none;">
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeScreenshot()">Zrušit</button>
                <button class="modal-btn primary" id="generateFromScreenshot" onclick="generateFromScreenshot()" style="display:none;">🤖 Vygenerovat</button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="wrapWithTag('div')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>
            Obalit &lt;div&gt;
        </div>
        <div class="context-menu-item" onclick="wrapWithTag('span')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Obalit &lt;span&gt;
        </div>
        <div class="context-menu-item" onclick="wrapWithTag('p')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/></svg>
            Obalit &lt;p&gt;
        </div>
        <div class="context-menu-item" onclick="wrapWithCustomTag()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
            Vlastní tag...
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="commentSelection()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            Zakomentovat
        </div>
        <div class="context-menu-item" onclick="duplicateSelection()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            Duplikovat
        </div>
        <div class="context-menu-item" onclick="deleteSelection()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:var(--error);"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            Smazat
        </div>
    </div>

    <!-- Add Prompt Modal -->
    <div class="modal-overlay" id="promptModal">
        <div class="modal">
            <div class="modal-title" id="promptModalTitle">Přidat prompt</div>
            <input type="text" class="modal-input" id="promptName" placeholder="Název promptu">
            <textarea class="modal-input" id="promptText" placeholder="Text promptu..." style="min-height:120px;resize:vertical;font-family:'JetBrains Mono',monospace;font-size:13px;"></textarea>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closePromptModal()">Zrušit</button>
                <button class="modal-btn primary" onclick="savePrompt()">Uložit</button>
            </div>
        </div>
    </div>

    <!-- GitHub Browser Modal -->
    <div class="modal-overlay" id="githubBrowserModal">
        <div class="modal" style="max-width:500px;max-height:80vh;display:flex;flex-direction:column;">
            <div class="modal-title">GitHub</div>
            <div class="github-path" id="githubPath"></div>
            <div class="github-browser" id="githubBrowser">
                <div class="github-loading">Načítám...</div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeGithubBrowser()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- GitHub Commit Modal -->
    <div class="modal-overlay" id="githubCommitModal">
        <div class="modal">
            <div class="modal-title">Uložit na GitHub</div>
            <div class="modal-desc" id="githubCommitInfo"></div>
            <input type="text" class="modal-input" id="githubCommitRepo" placeholder="Repozitář (user/repo)">
            <input type="text" class="modal-input" id="githubCommitPath" placeholder="Cesta k souboru (např. index.html)">
            <input type="text" class="modal-input" id="githubCommitMessage" placeholder="Commit message">
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeGithubCommit()">Zrušit</button>
                <button class="modal-btn primary" onclick="commitToGithub()">Uložit</button>
            </div>
        </div>
    </div>

    <!-- Repo Manager Modal -->
    <div class="modal-overlay" id="repoManagerModal">
        <div class="modal" style="max-width:500px;max-height:85vh;display:flex;flex-direction:column;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
                <div class="modal-title" style="margin:0;">Správa repozitářů</div>
                <button class="modal-btn primary" onclick="openCreateRepoModal()" style="padding:8px 12px;font-size:12px;">
                    + Nový repo
                </button>
            </div>
            <div class="repo-stats" id="repoStats"></div>
            <div class="repo-manager-list" id="repoManagerList">
                <div class="github-loading">Načítám...</div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeRepoManager()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Create Repo Modal -->
    <div class="modal-overlay" id="createRepoModal">
        <div class="modal">
            <div class="modal-title">Vytvořit repozitář</div>
            <input type="text" class="modal-input" id="newRepoName" placeholder="Název repozitáře">
            <textarea class="modal-input" id="newRepoDesc" placeholder="Popis (volitelné)" style="min-height:60px;resize:vertical;"></textarea>
            <div class="settings-item" style="margin-bottom:12px;padding:12px;">
                <span class="settings-label">Soukromý repozitář</span>
                <label class="settings-toggle">
                    <input type="checkbox" id="newRepoPrivate">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="settings-item" style="margin-bottom:12px;padding:12px;">
                <span class="settings-label">Inicializovat s README</span>
                <label class="settings-toggle">
                    <input type="checkbox" id="newRepoReadme" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeCreateRepoModal()">Zrušit</button>
                <button class="modal-btn primary" onclick="createNewRepo()">Vytvořit</button>
            </div>
        </div>
    </div>

    <!-- Delete Repo Modal -->
    <div class="modal-overlay" id="deleteRepoModal">
        <div class="modal">
            <div class="modal-title" style="color:var(--error);">⚠️ Smazat repozitář</div>
            <div class="modal-desc">
                Tato akce je <strong>nevratná</strong>! Budou smazány všechny soubory, issues, wiki a nastavení.
            </div>
            <div style="padding:12px;background:var(--bg-tertiary);border-radius:8px;margin-bottom:12px;">
                <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">Repozitář ke smazání:</div>
                <div style="font-family:'JetBrains Mono',monospace;color:var(--error);" id="deleteRepoName"></div>
            </div>
            <div style="font-size:13px;margin-bottom:8px;">Doplň poslední <strong>2 písmena</strong> názvu repozitáře:</div>
            <input type="text" class="modal-input" id="deleteRepoConfirm" placeholder="">
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeDeleteRepoModal()">Zrušit</button>
                <button class="modal-btn" onclick="confirmDeleteRepo()" style="background:var(--error);border-color:var(--error);color:white;">Smazat</button>
            </div>
        </div>
    </div>

    <!-- GitHub Pages Modal -->
    <div class="modal-overlay" id="githubPagesModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-title">🌐 GitHub Pages</div>
            <div style="margin-bottom:12px;">
                <label style="font-size:13px;display:block;margin-bottom:6px;">Repozitář:</label>
                <input type="text" class="modal-input" id="pagesRepo" placeholder="user/repo" style="margin:0;">
            </div>
            <div id="pagesStatus" style="margin-bottom:12px;">
                <div class="github-loading">Vyber repozitář</div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeGithubPages()">Zavřít</button>
                <button class="modal-btn" onclick="checkPagesStatus()">Zkontrolovat</button>
            </div>
        </div>
    </div>

    <!-- Commit History Modal -->
    <div class="modal-overlay" id="commitHistoryModal">
        <div class="modal" style="max-width:500px;max-height:85vh;display:flex;flex-direction:column;">
            <div class="modal-title">📜 Historie commitů</div>
            <div style="margin-bottom:12px;">
                <input type="text" class="modal-input" id="historyRepo" placeholder="user/repo" style="margin:0;">
            </div>
            <div class="commit-list" id="commitList" style="flex:1;overflow-y:auto;max-height:50vh;">
                <div class="github-loading">Zadej repozitář a stiskni Načíst</div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeCommitHistory()">Zavřít</button>
                <button class="modal-btn primary" onclick="loadCommitHistory()">Načíst</button>
            </div>
        </div>
    </div>

    <!-- Diff View Modal -->
    <div class="modal-overlay" id="diffViewModal">
        <div class="modal" style="max-width:600px;max-height:90vh;display:flex;flex-direction:column;">
            <div class="modal-title">📊 Porovnat změny</div>
            <div id="diffInfo" style="margin-bottom:12px;"></div>
            <div class="diff-container" id="diffContainer" style="flex:1;overflow-y:auto;max-height:60vh;">
                <div class="github-empty">Není co porovnat. Otevři soubor z GitHubu.</div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeDiffView()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Gist Manager Modal -->
    <div class="modal-overlay" id="gistManagerModal">
        <div class="modal" style="max-width:500px;max-height:85vh;display:flex;flex-direction:column;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
                <div class="modal-title" style="margin:0;">📝 Gists</div>
                <button class="modal-btn primary" onclick="openCreateGistModal()" style="padding:8px 12px;font-size:12px;">
                    + Nový Gist
                </button>
            </div>
            <div class="gist-list" id="gistList" style="flex:1;overflow-y:auto;max-height:50vh;">
                <div class="github-loading">Načítám...</div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeGistManager()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Create Gist Modal -->
    <div class="modal-overlay" id="createGistModal">
        <div class="modal">
            <div class="modal-title">Vytvořit Gist</div>
            <input type="text" class="modal-input" id="gistFilename" placeholder="Název souboru (např. index.html)">
            <input type="text" class="modal-input" id="gistDescription" placeholder="Popis (volitelné)">
            <div class="settings-item" style="margin-bottom:12px;padding:12px;">
                <span class="settings-label">Veřejný Gist</span>
                <label class="settings-toggle">
                    <input type="checkbox" id="gistPublic" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div style="font-size:11px;color:var(--text-muted);margin-bottom:12px;">
                Aktuální soubor bude nahrán jako Gist.
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeCreateGistModal()">Zrušit</button>
                <button class="modal-btn primary" onclick="createGist()">Vytvořit</button>
            </div>
        </div>
    </div>

    <!-- Repo Settings Modal -->
    <div class="modal-overlay" id="repoSettingsModal">
        <div class="modal">
            <div class="modal-title">⚙️ Nastavení repozitáře</div>
            <input type="hidden" id="repoSettingsFullName">
            <div style="margin-bottom:12px;">
                <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Název</label>
                <input type="text" class="modal-input" id="repoSettingsName" placeholder="Název repozitáře" style="margin:0;">
            </div>
            <div style="margin-bottom:12px;">
                <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Popis</label>
                <textarea class="modal-input" id="repoSettingsDesc" placeholder="Popis (volitelné)" style="min-height:60px;resize:vertical;margin:0;"></textarea>
            </div>
            <div class="settings-item" style="margin-bottom:12px;padding:12px;">
                <span class="settings-label">Soukromý repozitář</span>
                <label class="settings-toggle">
                    <input type="checkbox" id="repoSettingsPrivate">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div style="margin-bottom:12px;">
                <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Topics (oddělené čárkou)</label>
                <input type="text" class="modal-input" id="repoSettingsTopics" placeholder="html, css, javascript" style="margin:0;">
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeRepoSettings()">Zrušit</button>
                <button class="modal-btn primary" onclick="saveRepoSettings()">Uložit</button>
            </div>
        </div>
    </div>

    <!-- Fork Modal -->
    <div class="modal-overlay" id="forkModal">
        <div class="modal">
            <div class="modal-title">🍴 Fork repozitáře</div>
            <div style="margin-bottom:12px;">
                <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:4px;">Repozitář (owner/repo)</label>
                <input type="text" class="modal-input" id="forkRepoName" placeholder="např. facebook/react" style="margin:0;">
            </div>
            <div style="font-size:12px;color:var(--text-secondary);margin-bottom:12px;padding:12px;background:var(--bg-tertiary);border-radius:8px;">
                Fork vytvoří kopii cizího repozitáře do tvého účtu. Můžeš pak upravovat kód a případně vytvořit Pull Request.
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeForkModal()">Zrušit</button>
                <button class="modal-btn primary" onclick="forkRepo()">Forknout</button>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal-overlay" id="loadingModal" style="z-index:1001;">
        <div class="modal" style="max-width:400px;text-align:center;">
            <div class="modal-title" id="loadingTitle">📥 Načítám...</div>
            <div class="loading-progress">
                <div class="loading-bar">
                    <div class="loading-bar-fill" id="loadingBarFill"></div>
                </div>
                <div class="loading-status" id="loadingStatus">Připravuji...</div>
                <div class="loading-details" id="loadingDetails"></div>
            </div>
            <div class="modal-actions" style="margin-top:16px;">
                <button class="modal-btn" onclick="cancelLoading()" style="background:var(--error);">✕ Zrušit</button>
            </div>
        </div>
    </div>

    <!-- Validation Modal -->
    <div class="modal-overlay" id="validationModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-title">✓ Validace HTML</div>
            <div class="validation-list" id="validationList">
                <div class="github-loading">Validuji...</div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeValidation()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Shortcuts Modal -->
    <div class="modal-overlay" id="shortcutsModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-title">⚡ Rychlé akce</div>
            <div class="shortcuts-grid" id="shortcutsList">
                <div class="shortcut-item clickable" onclick="runShortcut('save')">
                    <span>💾 Uložit</span>
                    <span class="shortcut-key">Ctrl+S</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('download')">
                    <span>⬇️ Stáhnout</span>
                    <span class="shortcut-key">Ctrl+⇧+S</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('newFile')">
                    <span>📄 Nový soubor</span>
                    <span class="shortcut-key">Ctrl+N</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('search')">
                    <span>🔍 Hledat</span>
                    <span class="shortcut-key">Ctrl+F</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('format')">
                    <span>📝 Formátovat</span>
                    <span class="shortcut-key">Ctrl+⇧+F</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('validate')">
                    <span>✓ Validovat</span>
                    <span class="shortcut-key">Ctrl+⇧+V</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('minify')">
                    <span>📦 Minifikovat</span>
                    <span class="shortcut-key">Ctrl+⇧+M</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('preview')">
                    <span>👁️ Náhled</span>
                    <span class="shortcut-key">Ctrl+P</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('console')">
                    <span>🖥️ Konzole</span>
                    <span class="shortcut-key">Ctrl+`</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('undo')">
                    <span>↩️ Zpět</span>
                    <span class="shortcut-key">Ctrl+Z</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('redo')">
                    <span>↪️ Vpřed</span>
                    <span class="shortcut-key">Ctrl+Y</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('closeTab')">
                    <span>✖️ Zavřít tab</span>
                    <span class="shortcut-key">Ctrl+W</span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('colorScheme')">
                    <span>🎨 Barevné schéma</span>
                    <span class="shortcut-key"></span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('publish')">
                    <span>🚀 Publikovat</span>
                    <span class="shortcut-key"></span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('seo')">
                    <span>🔍 SEO kontrola</span>
                    <span class="shortcut-key"></span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('devices')">
                    <span>📱 Test zařízení</span>
                    <span class="shortcut-key"></span>
                </div>
                <div class="shortcut-item clickable" onclick="runShortcut('screenshot')">
                    <span>📷 AI ze screenu</span>
                    <span class="shortcut-key"></span>
                </div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeShortcuts()">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Live Server Modal -->
    <div class="modal-overlay" id="liveServerModal">
        <div class="modal" style="max-width:400px;">
            <div class="modal-title">🌐 Živý server</div>
            <div class="server-status" id="serverStatus">
                <div class="server-status-icon offline">📡</div>
                <div style="font-size:14px;font-weight:500;margin-bottom:4px;">Server vypnutý</div>
                <div style="font-size:12px;color:var(--text-muted);">Spusť server pro sdílení náhledu</div>
            </div>
            <div id="serverInfo" style="display:none;">
                <div class="server-url" id="serverUrl"></div>
                <div style="text-align:center;">
                    <div class="server-qr" id="serverQR"></div>
                </div>
                <div style="font-size:11px;color:var(--text-muted);text-align:center;">
                    Naskenuj QR kód nebo otevři URL na jiném zařízení
                </div>
            </div>
            <div class="modal-actions" style="margin-top:12px;">
                <button class="modal-btn" onclick="closeLiveServer()">Zavřít</button>
                <button class="modal-btn primary" id="serverToggleBtn" onclick="toggleLiveServer()">Spustit server</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // AI MODULE (embedded)
        // ============================================
        const AI = {
            DEMO_KEYS: {
                gemini: "AIzaSyCXuMvhO_senLS" + "oA_idEuBk_EwnMmIPIhg",
                groq: "gsk_0uZbn9KqiBa3Zsl11ACX" + "WGdyb3FYZddvc6oPIn9HTvJpGgoBbYrJ",
                openrouter: "sk-or-v1-bff66ee4a0845f88" + "428b75d91a35aea63e355a52dc31e6427fcc1f9536c2a8a3",
                mistral: "Tvwm0qcQk71vsUDw" + "VfAAAY5GPKdbvlHj",
                cohere: "PeJo8cQwftoZI1Dob0qK" + "1lN445FlOjrfFA3piEuh",
                huggingface: "hf_UhezIpnumnYWSacKLtja" + "VPfXMxbFemUyMv"
            },
            config: {
                keys: { gemini: '', groq: '', openrouter: '', mistral: '', cohere: '', huggingface: '' },
                models: {
                    gemini: 'gemini-2.5-flash-lite',
                    groq: 'llama-3.3-70b-versatile',
                    openrouter: 'mistralai/mistral-small-3.1-24b-instruct:free',
                    mistral: 'mistral-small-latest',
                    cohere: 'command-a-03-2025',
                    huggingface: 'mistralai/Mistral-7B-Instruct-v0.3'
                },
                defaultProvider: 'gemini',
                timeout: 90000,
                maxRetries: 3
            },
            ALL_MODELS: {
                gemini: [
                    { value: "gemini-2.5-flash-lite", name: "⚡ Gemini 2.5 Flash-Lite", rpm: 15 },
                    { value: "gemini-2.5-flash", name: "⚡ Gemini 2.5 Flash", rpm: 10 }
                ],
                groq: [
                    { value: "llama-3.3-70b-versatile", name: "💬 Llama 3.3 70B", rpm: 30 },
                    { value: "llama-3.1-8b-instant", name: "⚡ Llama 3.1 8B (rychlý)", rpm: 30 },
                    { value: "meta-llama/llama-4-scout-17b-16e-instruct", name: "👁️ Llama 4 Scout (Vision)", rpm: 30 }
                ],
                openrouter: [
                    { value: "mistralai/mistral-small-3.1-24b-instruct:free", name: "🔥 Mistral Small 3.1 :free", rpm: 20 }
                ],
                mistral: [
                    { value: "codestral-latest", name: "💻 Codestral (kód)", rpm: 30 },
                    { value: "mistral-small-latest", name: "⚡ Mistral Small", rpm: 30 }
                ],
                cohere: [
                    { value: "command-a-03-2025", name: "🧠 Command A", rpm: 20 },
                    { value: "command-r-plus-08-2024", name: "💬 Command R+", rpm: 20 }
                ],
                huggingface: [
                    { value: "mistralai/Mistral-7B-Instruct-v0.3", name: "🔥 Mistral 7B", rpm: 10 },
                    { value: "microsoft/Phi-3-mini-4k-instruct", name: "🔬 Phi-3 Mini", rpm: 10 }
                ]
            },
            VISION_MODELS: ['meta-llama/llama-4-maverick-17b-128e-instruct', 'meta-llama/llama-4-scout-17b-16e-instruct'],
            
            async fetchWithTimeout(url, options, timeoutMs) {
                const timeout = timeoutMs || this.config.timeout || 30000;
                const fetchPromise = fetch(url, options);
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Timeout')), timeout);
                });
                return Promise.race([fetchPromise, timeoutPromise]);
            },
            
            getKey(provider) {
                const customKey = this.config.keys[provider];
                if (customKey && customKey.length > 10) return customKey;
                const demoKey = this.DEMO_KEYS[provider];
                if (demoKey && demoKey.length > 10) return demoKey;
                return null;
            },
            
            isUsingDemoKey(provider) {
                const customKey = this.config.keys[provider];
                return !(customKey && customKey.length > 10);
            },
            
            setKey(provider, key) {
                if (this.config.keys.hasOwnProperty(provider)) {
                    this.config.keys[provider] = key;
                    return true;
                }
                return false;
            },
            
            setModel(provider, model) {
                if (this.config.models.hasOwnProperty(provider)) {
                    this.config.models[provider] = model;
                    return true;
                }
                return false;
            },
            
            setDefaultProvider(provider) {
                if (this.config.keys.hasOwnProperty(provider)) {
                    this.config.defaultProvider = provider;
                    return true;
                }
                return false;
            },
            
            getModels(provider) {
                return this.ALL_MODELS[provider] || [];
            },
            
            async askGemini(prompt, options = {}) {
                const key = options.key || this.getKey('gemini');
                if (!key) throw new Error('Gemini API klíč není k dispozici');
                const model = options.model || this.config.models.gemini;
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`;
                const body = { contents: [{ parts: [{ text: prompt }] }], generationConfig: { temperature: options.temperature ?? 0.7, maxOutputTokens: options.maxTokens ?? 4096 } };
                if (options.system) body.systemInstruction = { parts: [{ text: options.system }] };
                const resp = await this.fetchWithTimeout(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                if (!resp.ok) { const e = await resp.json().catch(() => ({})); throw new Error(e.error?.message || `HTTP ${resp.status}`); }
                const data = await resp.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || '';
            },
            
            async askGroq(prompt, options = {}) {
                const key = options.key || this.getKey('groq');
                if (!key) throw new Error('Groq API klíč není k dispozici');
                const model = options.model || this.config.models.groq;
                const messages = [];
                if (options.system) messages.push({ role: 'system', content: options.system });
                messages.push({ role: 'user', content: prompt });
                const resp = await this.fetchWithTimeout('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${key}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model, messages, temperature: options.temperature ?? 0.7, max_tokens: options.maxTokens ?? 4096 })
                });
                if (!resp.ok) { const e = await resp.json().catch(() => ({})); throw new Error(e.error?.message || `HTTP ${resp.status}`); }
                const data = await resp.json();
                return data.choices?.[0]?.message?.content || '';
            },
            
            async askOpenRouter(prompt, options = {}) {
                const key = options.key || this.getKey('openrouter');
                if (!key) throw new Error('OpenRouter API klíč není k dispozici');
                const model = options.model || this.config.models.openrouter;
                const messages = [];
                if (options.system) messages.push({ role: 'system', content: options.system });
                messages.push({ role: 'user', content: prompt });
                const resp = await this.fetchWithTimeout('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${key}`, 'Content-Type': 'application/json', 'HTTP-Referer': window.location.href },
                    body: JSON.stringify({ model, messages, temperature: options.temperature ?? 0.7, max_tokens: options.maxTokens ?? 4096 })
                });
                if (!resp.ok) { const e = await resp.json().catch(() => ({})); throw new Error(e.error?.message || `HTTP ${resp.status}`); }
                const data = await resp.json();
                return data.choices?.[0]?.message?.content || '';
            },
            
            async askMistral(prompt, options = {}) {
                const key = options.key || this.getKey('mistral');
                if (!key) throw new Error('Mistral API klíč není k dispozici');
                const model = options.model || this.config.models.mistral;
                const messages = [];
                if (options.system) messages.push({ role: 'system', content: options.system });
                messages.push({ role: 'user', content: prompt });
                const resp = await this.fetchWithTimeout('https://api.mistral.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${key}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model, messages, temperature: options.temperature ?? 0.7, max_tokens: options.maxTokens ?? 4096 })
                });
                if (!resp.ok) { const e = await resp.json().catch(() => ({})); throw new Error(e.error?.message || `HTTP ${resp.status}`); }
                const data = await resp.json();
                return data.choices?.[0]?.message?.content || '';
            },
            
            async askCohere(prompt, options = {}) {
                const key = options.key || this.getKey('cohere');
                if (!key) throw new Error('Cohere API klíč není k dispozici');
                const model = options.model || this.config.models.cohere;
                const messages = [];
                if (options.system) messages.push({ role: 'system', content: options.system });
                messages.push({ role: 'user', content: prompt });
                const resp = await this.fetchWithTimeout('https://api.cohere.com/v2/chat', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${key}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model, messages, temperature: options.temperature ?? 0.7, max_tokens: options.maxTokens ?? 4096 })
                });
                if (!resp.ok) { const e = await resp.json().catch(() => ({})); throw new Error(e.message || `HTTP ${resp.status}`); }
                const data = await resp.json();
                return data.message?.content?.[0]?.text || '';
            },
            
            async askHuggingFace(prompt, options = {}) {
                const key = options.key || this.getKey('huggingface');
                if (!key) throw new Error('HuggingFace API klíč není k dispozici');
                const model = options.model || this.config.models.huggingface;
                const messages = [];
                if (options.system) messages.push({ role: 'system', content: options.system });
                messages.push({ role: 'user', content: prompt });
                const resp = await this.fetchWithTimeout(`https://api-inference.huggingface.co/models/${model}/v1/chat/completions`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${key}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model, messages, temperature: options.temperature ?? 0.7, max_tokens: options.maxTokens ?? 1024, stream: false })
                });
                if (!resp.ok) { const e = await resp.json().catch(() => ({})); throw new Error(e.error || `HTTP ${resp.status}`); }
                const data = await resp.json();
                return data.choices?.[0]?.message?.content || '';
            },
            
            async ask(prompt, options = {}) {
                const provider = options.provider || this.config.defaultProvider;
                switch (provider) {
                    case 'gemini': return this.askGemini(prompt, options);
                    case 'groq': return this.askGroq(prompt, options);
                    case 'openrouter': return this.askOpenRouter(prompt, options);
                    case 'mistral': return this.askMistral(prompt, options);
                    case 'cohere': return this.askCohere(prompt, options);
                    case 'huggingface': return this.askHuggingFace(prompt, options);
                    default: throw new Error(`Neznámý provider: ${provider}`);
                }
            }
        };
        
        // ============================================
        // STATE
        // ============================================
        let files = [];
        let activeFileId = null;
        let fileIdCounter = 0;
        let consoleErrors = 0;
        let consoleWarns = 0;
        let searchMatches = [];
        let currentMatchIndex = -1;
        let commandHistory = [];
        let commandHistoryIndex = -1;

        const codeInput = document.getElementById('codeInput');
        const previewFrame = document.getElementById('previewFrame');
        const fileTabs = document.getElementById('fileTabs');
        const searchBar = document.getElementById('searchBar');
        const searchInput = document.getElementById('searchInput');
        const replaceInput = document.getElementById('replaceInput');
        const searchResults = document.getElementById('searchResults');
        const consoleContent = document.getElementById('consoleContent');
        const consoleInputEl = document.getElementById('consoleInput');
        const historyList = document.getElementById('historyList');
        const errorBadge = document.getElementById('errorBadge');
        const warnBadge = document.getElementById('warnBadge');

        // Templates
        const templates = {
            blank: `<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moje stránka</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; padding: 1rem; }
  </style>
</head>
<body>
  <h1>Ahoj světe!</h1>
</body>
</html>`,
            landing: `<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Landing</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    .hero { text-align: center; color: white; padding: 2rem; }
    h1 { font-size: 2rem; margin-bottom: 1rem; }
    .btn { display: inline-block; padding: 1rem 2rem; background: white; color: #764ba2; text-decoration: none; border-radius: 50px; font-weight: 600; }
  </style>
</head>
<body>
  <div class="hero">
    <h1>Vítejte</h1>
    <a href="#" class="btn">Začít</a>
  </div>
</body>
</html>`,
            form: `<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulář</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; background: #f5f5f5; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem; }
    .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
    h2 { margin-bottom: 1.5rem; }
    input, textarea { width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 1rem; font-size: 1rem; }
    button { width: 100%; padding: 1rem; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 1rem; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Kontakt</h2>
    <form>
      <input type="text" placeholder="Jméno">
      <input type="email" placeholder="Email">
      <textarea placeholder="Zpráva"></textarea>
      <button type="submit">Odeslat</button>
    </form>
  </div>
</body>
</html>`,
            grid: `<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grid</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; background: #1a1a2e; color: white; padding: 1rem; }
    h1 { text-align: center; margin-bottom: 1rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; }
    .card { background: #16213e; border-radius: 12px; overflow: hidden; }
    .card-img { height: 100px; background: linear-gradient(45deg, #e94560, #0f3460); }
    .card-body { padding: 1rem; }
  </style>
</head>
<body>
  <h1>Galerie</h1>
  <div class="grid">
    <div class="card"><div class="card-img"></div><div class="card-body"><h3>Karta 1</h3></div></div>
    <div class="card"><div class="card-img"></div><div class="card-body"><h3>Karta 2</h3></div></div>
    <div class="card"><div class="card-img"></div><div class="card-body"><h3>Karta 3</h3></div></div>
  </div>
</body>
</html>`,
            dashboard: `<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; background: #0f172a; color: #e2e8f0; padding: 1rem; }
    h1 { margin-bottom: 1rem; font-size: 1.5rem; }
    .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    .stat { background: #1e293b; padding: 1rem; border-radius: 12px; }
    .stat-label { font-size: 0.75rem; color: #94a3b8; }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: #38bdf8; }
  </style>
</head>
<body>
  <h1>Dashboard</h1>
  <div class="stats">
    <div class="stat"><div class="stat-label">Uživatelé</div><div class="stat-value">1,234</div></div>
    <div class="stat"><div class="stat-label">Aktivní</div><div class="stat-value">456</div></div>
    <div class="stat"><div class="stat-label">Tržby</div><div class="stat-value">89k</div></div>
    <div class="stat"><div class="stat-label">Konverze</div><div class="stat-value">12%</div></div>
  </div>
</body>
</html>`
        };

        const snippets = {
            div: '<div class="">\n  \n</div>',
            flex: '<div style="display:flex;gap:1rem;align-items:center;">\n  \n</div>',
            grid: '<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;">\n  \n</div>',
            btn: '<button style="padding:0.75rem 1.5rem;background:#3b82f6;color:white;border:none;border-radius:6px;">Tlačítko</button>',
            input: '<input type="text" placeholder="Text..." style="padding:0.75rem;border:1px solid #ccc;border-radius:6px;">',
            img: '<img src="https://via.placeholder.com/300x200" alt="" style="max-width:100%;border-radius:8px;">',
            link: '<a href="#" style="color:#3b82f6;">Odkaz</a>',
            table: '<table style="width:100%;border-collapse:collapse;">\n  <tr><th style="border:1px solid #ddd;padding:8px;">A</th><th style="border:1px solid #ddd;padding:8px;">B</th></tr>\n  <tr><td style="border:1px solid #ddd;padding:8px;">1</td><td style="border:1px solid #ddd;padding:8px;">2</td></tr>\n</table>'
        };

        // ============================================
        // VIEW SWITCHING
        // ============================================
        let currentView = 'code';
        let toolsOpen = false;

        function switchView(view) {
            // Pokud klikneme na tools, toggleujeme sidebar
            if (view === 'tools') {
                toggleTools();
                return;
            }

            // Přepnout hlavní pohled
            currentView = view;
            document.querySelectorAll('.view-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.bottom-nav-item').forEach(b => {
                if (b.dataset.view !== 'tools') b.classList.remove('active');
            });
            
            document.getElementById(view + 'View').classList.add('active');
            document.querySelector(`[data-view="${view}"]`).classList.add('active');

            if (view === 'preview') {
                updatePreview();
            }
            
            // Aktualizuj files list pokud je potřeba
            renderFilesList();
        }

        function toggleTools() {
            toolsOpen = !toolsOpen;
            const toolsPanel = document.getElementById('toolsPanel');
            const toolsBtn = document.querySelector('[data-view="tools"]');
            
            if (toolsOpen) {
                toolsPanel.classList.add('active');
                toolsBtn.classList.add('active');
                renderFilesList();
                renderPrompts();
                checkGithubConnection();
            } else {
                toolsPanel.classList.remove('active');
                toolsBtn.classList.remove('active');
            }
        }

        function toggleCollapse(header) {
            header.classList.toggle('open');
        }

        // Stav rozbalených složek
        let expandedFolders = new Set();

        function toggleFolder(path) {
            if (expandedFolders.has(path)) {
                expandedFolders.delete(path);
            } else {
                expandedFolders.add(path);
            }
            renderFilesList();
        }

        function buildFileTree(files) {
            const tree = { files: [], folders: {} };
            
            for (const file of files) {
                const folderPath = file.folderPath || '';
                
                if (!folderPath) {
                    // Soubor v kořenu
                    tree.files.push(file);
                } else {
                    // Soubor ve složce
                    const parts = folderPath.split('/');
                    let current = tree;
                    let currentPath = '';
                    
                    for (const part of parts) {
                        currentPath = currentPath ? currentPath + '/' + part : part;
                        if (!current.folders[part]) {
                            current.folders[part] = { 
                                files: [], 
                                folders: {},
                                path: currentPath,
                                name: part
                            };
                        }
                        current = current.folders[part];
                    }
                    current.files.push(file);
                }
            }
            
            return tree;
        }

        function renderTreeFolder(folder, depth = 0) {
            const isExpanded = expandedFolders.has(folder.path);
            const indent = depth * 16;
            const fileCount = countFilesInFolder(folder);
            
            let html = `
                <div class="folder-item" style="padding-left:${indent}px;" onclick="toggleFolder('${folder.path}')">
                    <svg class="folder-arrow ${isExpanded ? 'expanded' : ''}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"/>
                    </svg>
                    <svg class="folder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span class="folder-name">${folder.name}</span>
                    <span class="folder-count">${fileCount}</span>
                </div>
            `;
            
            if (isExpanded) {
                html += '<div class="folder-content">';
                
                // Podsložky
                for (const subName of Object.keys(folder.folders).sort()) {
                    html += renderTreeFolder(folder.folders[subName], depth + 1);
                }
                
                // Soubory ve složce
                for (const file of folder.files.sort((a, b) => a.name.localeCompare(b.name))) {
                    html += renderTreeFile(file, depth + 1);
                }
                
                html += '</div>';
            }
            
            return html;
        }

        function renderTreeFile(file, depth = 0) {
            const indent = depth * 16;
            const size = file.content ? formatFileSize(file.content.length) : '';
            const isActive = file.id === activeFileId;
            const githubIcon = file.githubRepo ? '⬇' : '';
            
            return `
                <div class="file-item ${isActive ? 'active' : ''}" style="padding-left:${indent}px;" onclick="switchFile(${file.id})">
                    <div class="file-info">
                        <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <span class="file-name">${file.name}</span>
                        ${file.unsaved ? '<span class="file-unsaved"></span>' : ''}
                        <span class="file-size">${size} ${githubIcon}</span>
                    </div>
                    <button class="file-close" onclick="event.stopPropagation(); closeFile(${file.id})">×</button>
                </div>
            `;
        }

        function countFilesInFolder(folder) {
            let count = folder.files.length;
            for (const sub of Object.values(folder.folders)) {
                count += countFilesInFolder(sub);
            }
            return count;
        }

        function renderFilesList() {
            let html = '';
            
            if (files.length === 0) {
                html = '<div class="files-empty">Žádné otevřené soubory</div>';
            } else {
                const tree = buildFileTree(files);
                
                // Složky první
                for (const folderName of Object.keys(tree.folders).sort()) {
                    html += renderTreeFolder(tree.folders[folderName], 0);
                }
                
                // Soubory v kořenu
                for (const file of tree.files.sort((a, b) => a.name.localeCompare(b.name))) {
                    html += renderTreeFile(file, 0);
                }
                
                // Souhrn
                const totalSize = files.reduce((sum, f) => sum + (f.content?.length || 0), 0);
                const unsavedCount = files.filter(f => f.unsaved).length;
                html += `
                    <div class="files-summary">
                        <span>${files.length} souborů (${formatFileSize(totalSize)})</span>
                        ${unsavedCount > 0 ? `<span style="color:var(--warning);">${unsavedCount} neuložené</span>` : ''}
                    </div>
                `;
            }
            
            // Aktualizuj sidebar
            const filesList = document.getElementById('filesList');
            if (filesList) filesList.innerHTML = html;
            
            // Aktualizuj main tools view
            const filesListMain = document.getElementById('filesListMain');
            if (filesListMain) filesListMain.innerHTML = html;
            
            // Aktualizuj počty souborů v záhlaví
            const count = files.length;
            const filesCount = document.getElementById('filesCount');
            if (filesCount) filesCount.textContent = count > 0 ? count : '';
            
            const filesCountMain = document.getElementById('filesCountMain');
            if (filesCountMain) filesCountMain.textContent = count > 0 ? count : '';
        }

        // Tools panel resize
        const toolsResize = document.getElementById('toolsResize');
        const toolsPanel = document.getElementById('toolsPanel');
        let isResizingTools = false;

        toolsResize.addEventListener('mousedown', startToolsResize);
        toolsResize.addEventListener('touchstart', startToolsResize, { passive: false });

        function startToolsResize(e) {
            isResizingTools = true;
            toolsResize.classList.add('active');
            e.preventDefault();
        }

        document.addEventListener('mousemove', handleToolsResize);
        document.addEventListener('touchmove', handleToolsResize, { passive: false });

        function handleToolsResize(e) {
            if (!isResizingTools) return;
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const containerWidth = document.querySelector('.main-content').offsetWidth;
            const newWidth = containerWidth - clientX;
            const minWidth = 120;
            const maxWidth = containerWidth * 0.7;
            
            if (newWidth >= minWidth && newWidth <= maxWidth) {
                toolsPanel.style.width = newWidth + 'px';
            }
        }

        document.addEventListener('mouseup', stopToolsResize);
        document.addEventListener('touchend', stopToolsResize);

        function stopToolsResize() {
            isResizingTools = false;
            toolsResize.classList.remove('active');
        }

        // ============================================
        // FILES
        // ============================================
        function createFile(name = 'index.html', content = '') {
            const id = ++fileIdCounter;
            const file = { id, name, content: content || templates.blank, unsaved: false, history: [], historyIndex: -1 };
            files.push(file);
            return file;
        }

        function renderTabs() {
            const tabsHtml = files.map(file => `
                <button class="file-tab ${file.id === activeFileId ? 'active' : ''}" onclick="switchFile(${file.id})">
                    ${file.unsaved ? '<span class="unsaved"></span>' : ''}
                    ${file.name}
                    <span class="close-tab" onclick="event.stopPropagation();closeFile(${file.id})">×</span>
                </button>
            `).join('') + '<button class="add-tab-btn" onclick="addNewTab()">+</button>';
            
            fileTabs.innerHTML = `
                <button class="tabs-nav-btn" onclick="scrollTabs(-1)" title="Doleva">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                </button>
                <div class="file-tabs-scroll" id="fileTabsScroll">${tabsHtml}</div>
                <button class="tabs-nav-btn" onclick="scrollTabs(1)" title="Doprava">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                </button>
            `;
            
            // Aktualizuj i seznam souborů v tools panelu
            renderFilesList();
        }

        function scrollTabs(direction) {
            const scroll = document.getElementById('fileTabsScroll');
            if (scroll) {
                scroll.scrollBy({ left: direction * 150, behavior: 'smooth' });
            }
        }

        function switchFile(id) {
            if (activeFileId) {
                const curr = files.find(f => f.id === activeFileId);
                if (curr) curr.content = codeInput.value;
            }
            activeFileId = id;
            const file = files.find(f => f.id === id);
            if (file) {
                codeInput.value = file.content;
                updatePreview();
                renderTabs();
                renderHistory();
            }
        }

        function addNewTab() {
            document.getElementById('newTabModal').classList.add('active');
            document.getElementById('newTabName').value = `soubor${files.length + 1}.html`;
        }

        function closeNewTabModal() {
            document.getElementById('newTabModal').classList.remove('active');
        }

        function confirmNewTab() {
            const name = document.getElementById('newTabName').value || 'novy.html';
            const file = createFile(name);
            activeFileId = file.id;
            codeInput.value = file.content;
            renderTabs();
            updatePreview();
            addToHistory('Nový soubor');
            closeNewTabModal();
            switchView('code');
        }

        function closeFile(id) {
            const idx = files.findIndex(f => f.id === id);
            if (idx === -1) return;
            if (files[idx].unsaved && !confirm('Neuložené změny. Zavřít?')) return;
            files.splice(idx, 1);
            if (files.length === 0) {
                const f = createFile();
                activeFileId = f.id;
            } else if (activeFileId === id) {
                activeFileId = files[Math.min(idx, files.length - 1)].id;
            }
            codeInput.value = files.find(f => f.id === activeFileId).content;
            renderTabs();
            updatePreview();
        }

        // ============================================
        // EDITOR
        // ============================================
        function updatePreview() {
            // Získej aktuální soubor
            const currentFile = files.find(f => f.id === activeFileId);
            if (!currentFile) {
                const doc = previewFrame.contentDocument;
                doc.open();
                doc.write('');
                doc.close();
                return;
            }

            // Zjisti jestli je to HTML soubor
            const isHtml = currentFile.name.match(/\.(html?|htm)$/i);
            
            let htmlContent = '';
            
            if (isHtml) {
                // Použij aktuální HTML soubor
                htmlContent = codeInput.value;
            } else {
                // Není HTML - najdi hlavní HTML soubor pro preview
                const mainHtml = findMainHtmlFile();
                if (mainHtml) {
                    htmlContent = mainHtml.content;
                } else {
                    // Žádný HTML soubor - zobraz pouze aktuální kód
                    const doc = previewFrame.contentDocument;
                    doc.open();
                    doc.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><style>body{font-family:monospace;padding:20px;background:#1a1a2e;color:#eee;white-space:pre-wrap;}</style></head><body>${escapeHtml(codeInput.value)}</body></html>`);
                    doc.close();
                    return;
                }
            }

            // Zpracuj HTML - nahraď externí CSS a JS za obsah souborů
            htmlContent = processHtmlWithFiles(htmlContent);

            const doc = previewFrame.contentDocument;
            doc.open();
            doc.write(htmlContent);
            doc.close();
            setupConsoleCapture();
            updatePreviewSourceLabel();
        }

        function findMainHtmlFile() {
            // Priorita: index.html > index.htm > první .html soubor
            let indexHtml = files.find(f => f.name.toLowerCase() === 'index.html');
            if (indexHtml) return indexHtml;
            
            indexHtml = files.find(f => f.name.toLowerCase() === 'index.htm');
            if (indexHtml) return indexHtml;
            
            // Hledej jakýkoliv HTML soubor
            return files.find(f => f.name.match(/\.(html?|htm)$/i));
        }

        function processHtmlWithFiles(html) {
            // Nahraď <link href="..."> za inline CSS
            html = html.replace(/<link[^>]+href=["']([^"']+\.css)["'][^>]*>/gi, (match, href) => {
                const cssFile = findFileByPath(href);
                if (cssFile) {
                    return '<style>/* ' + href + ' */\n' + cssFile.content + '<' + '/style>';
                }
                return match; // Ponechej původní pokud soubor nenalezen
            });

            // Nahraď <script src="..."> za inline JS
            html = html.replace(/<script[^>]+src=["']([^"']+\.js)["'][^>]*><\/script>/gi, (match, src) => {
                const jsFile = findFileByPath(src);
                if (jsFile) {
                    return '<script>/* ' + src + ' */\n' + jsFile.content + '<' + '/script>';
                }
                return match; // Ponechej původní pokud soubor nenalezen
            });

            return html;
        }

        function findFileByPath(path) {
            // Odstraň ./ na začátku
            path = path.replace(/^\.\//, '');
            
            // Hledej podle názvu souboru (bez cesty)
            const fileName = path.split('/').pop();
            
            // Nejdřív zkus přesnou shodu s cestou
            let file = files.find(f => {
                const fullPath = f.folderPath ? f.folderPath + '/' + f.name : f.name;
                return fullPath === path || f.name === path;
            });
            
            if (file) return file;
            
            // Zkus jen název souboru
            file = files.find(f => f.name === fileName);
            
            return file;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getPreviewHtmlFile() {
            // Vrátí HTML soubor pro preview - index.html nebo aktuální pokud je HTML
            const currentFile = files.find(f => f.id === activeFileId);
            
            if (currentFile && currentFile.name.match(/\.(html?|htm)$/i)) {
                return currentFile;
            }
            
            return findMainHtmlFile();
        }

        function refreshPreview() {
            updatePreview();
            showToast('Náhled aktualizován', 'success');
        }

        function updatePreviewSourceLabel() {
            const htmlFile = getPreviewHtmlFile();
            const sourceEl = document.getElementById('previewSourceName');
            if (sourceEl && htmlFile) {
                sourceEl.textContent = htmlFile.name;
            } else if (sourceEl) {
                sourceEl.textContent = 'Žádný HTML';
            }
        }

        function switchToPreviewSource() {
            const htmlFile = getPreviewHtmlFile();
            if (htmlFile && htmlFile.id !== activeFileId) {
                switchFile(htmlFile.id);
                showToast('Přepnuto na ' + htmlFile.name, 'success');
            }
        }

        function markUnsaved() {
            const file = files.find(f => f.id === activeFileId);
            if (file) {
                file.unsaved = true;
                file.content = codeInput.value;
                renderTabs();
            }
        }

        function loadTemplate(name) {
            codeInput.value = templates[name] || templates.blank;
            updatePreview();
            markUnsaved();
            addToHistory('Šablona: ' + name);
            // Přepnout na kód pokud nejsme v code view
            if (currentView !== 'code') {
                switchView('code');
            }
            showToast('Šablona načtena', 'success');
        }

        function insertSnippet(name) {
            const snippet = snippets[name];
            const start = codeInput.selectionStart;
            codeInput.value = codeInput.value.substring(0, start) + snippet + codeInput.value.substring(codeInput.selectionEnd);
            codeInput.selectionStart = codeInput.selectionEnd = start + snippet.length;
            updatePreview();
            markUnsaved();
            addToHistory('Snippet: ' + name);
            // Přepnout na kód pokud nejsme v code view
            if (currentView !== 'code') {
                switchView('code');
            }
            codeInput.focus();
        }

        // ============================================
        // SEARCH
        // ============================================
        function toggleSearch() {
            searchBar.classList.toggle('active');
            if (searchBar.classList.contains('active')) {
                searchInput.focus();
            }
        }

        function performSearch() {
            const query = searchInput.value;
            searchMatches = [];
            currentMatchIndex = -1;
            if (!query) { searchResults.textContent = ''; return; }
            const content = codeInput.value;
            let idx = 0;
            while ((idx = content.indexOf(query, idx)) !== -1) {
                searchMatches.push(idx);
                idx += query.length;
            }
            if (searchMatches.length > 0) { currentMatchIndex = 0; highlightMatch(); }
            searchResults.textContent = searchMatches.length > 0 ? `${currentMatchIndex + 1}/${searchMatches.length}` : 'Nenalezeno';
        }

        function highlightMatch() {
            if (currentMatchIndex >= 0 && searchMatches.length > 0) {
                const pos = searchMatches[currentMatchIndex];
                codeInput.focus();
                codeInput.setSelectionRange(pos, pos + searchInput.value.length);
                searchResults.textContent = `${currentMatchIndex + 1}/${searchMatches.length}`;
            }
        }

        function findNext() {
            if (searchMatches.length === 0) { performSearch(); return; }
            currentMatchIndex = (currentMatchIndex + 1) % searchMatches.length;
            highlightMatch();
        }

        function findPrev() {
            if (searchMatches.length === 0) { performSearch(); return; }
            currentMatchIndex = (currentMatchIndex - 1 + searchMatches.length) % searchMatches.length;
            highlightMatch();
        }

        function replaceOne() {
            if (currentMatchIndex < 0) return;
            const pos = searchMatches[currentMatchIndex];
            codeInput.value = codeInput.value.substring(0, pos) + replaceInput.value + codeInput.value.substring(pos + searchInput.value.length);
            updatePreview();
            markUnsaved();
            performSearch();
        }

        function replaceAll() {
            const count = searchMatches.length;
            codeInput.value = codeInput.value.split(searchInput.value).join(replaceInput.value);
            updatePreview();
            markUnsaved();
            performSearch();
            showToast(`Nahrazeno ${count}x`, 'success');
        }

        searchInput.addEventListener('input', performSearch);

        // ============================================
        // HISTORY
        // ============================================
        function addToHistory(label) {
            const file = files.find(f => f.id === activeFileId);
            if (!file) return;
            const time = new Date().toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' });
            if (file.historyIndex < file.history.length - 1) file.history = file.history.slice(0, file.historyIndex + 1);
            file.history.push({ content: codeInput.value, label, time });
            if (file.history.length > 30) file.history.shift();
            file.historyIndex = file.history.length - 1;
            renderHistory();
        }

        function renderHistory() {
            const file = files.find(f => f.id === activeFileId);
            if (!file) return;
            const html = file.history.slice().reverse().map((item, i) => {
                const idx = file.history.length - 1 - i;
                return `<div class="history-item ${idx === file.historyIndex ? 'current' : ''}" onclick="restoreHistory(${idx})">
                    <span class="history-label">${item.label}</span>
                    <span class="history-time">${item.time}</span>
                </div>`;
            }).join('');
            historyList.innerHTML = html;
        }

        function restoreHistory(idx) {
            const file = files.find(f => f.id === activeFileId);
            if (!file || idx < 0 || idx >= file.history.length) return;
            file.historyIndex = idx;
            codeInput.value = file.history[idx].content;
            file.content = codeInput.value;
            updatePreview();
            renderHistory();
            markUnsaved();
        }

        function undo() {
            const file = files.find(f => f.id === activeFileId);
            if (!file || file.historyIndex <= 0) {
                showToast('Nelze vrátit zpět', 'error');
                return;
            }
            restoreHistory(file.historyIndex - 1);
            showToast('Vráceno zpět', 'success');
        }

        function redo() {
            const file = files.find(f => f.id === activeFileId);
            if (!file || file.historyIndex >= file.history.length - 1) {
                showToast('Nelze opakovat', 'error');
                return;
            }
            restoreHistory(file.historyIndex + 1);
            showToast('Opakováno', 'success');
        }

        // ============================================
        // CONSOLE
        // ============================================
        // Poslední chyba pro AI
        let lastError = null;
        let errorDebounce = null;

        function addConsoleEntry(type, message) {
            const empty = consoleContent.querySelector('.console-empty');
            if (empty) empty.remove();
            const time = new Date().toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            if (type === 'error') { 
                consoleErrors++; 
                updateBadges();
                
                // Uložit chybu pro AI
                lastError = message;
                
                // Debounce - počkej 500ms jestli nepřijdou další chyby
                clearTimeout(errorDebounce);
                errorDebounce = setTimeout(() => {
                    showErrorNotification(message);
                }, 500);
            }
            if (type === 'warn') { consoleWarns++; updateBadges(); }
            const entry = document.createElement('div');
            entry.className = `console-entry ${type}`;
            entry.innerHTML = `<span class="console-message">${escapeHtml(String(message))}</span><span class="console-time">${time}</span>`;
            consoleContent.appendChild(entry);
            consoleContent.scrollTop = consoleContent.scrollHeight;
        }

        function showErrorNotification(errorMsg) {
            // Přidej chybu do AI chatu
            const messagesEl = document.getElementById('aiMessages');
            
            // Odstraň předchozí error notifikace
            const oldErrors = messagesEl.querySelectorAll('.ai-error-notification');
            oldErrors.forEach(el => el.remove());
            
            const errorEl = document.createElement('div');
            errorEl.className = 'ai-message system ai-error-notification';
            errorEl.innerHTML = `
                <div style="color:var(--error);margin-bottom:8px;">❌ Chyba v kódu:</div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:11px;background:var(--bg-primary);padding:8px;border-radius:6px;margin-bottom:10px;">${escapeHtml(errorMsg)}</div>
                <button onclick="fixErrorWithAI()" style="width:100%;padding:10px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:8px;color:white;font-size:13px;font-weight:500;cursor:pointer;">🤖 Opravit pomocí AI</button>
            `;
            messagesEl.appendChild(errorEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
            
            // Zobraz toast s tlačítkem
            showErrorToast(errorMsg);
        }

        function showErrorToast(errorMsg) {
            // Speciální toast pro chyby
            const existingToast = document.getElementById('errorToast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.id = 'errorToast';
            toast.style.cssText = `
                position: fixed;
                bottom: 80px;
                left: 16px;
                right: 16px;
                background: var(--bg-elevated);
                border: 1px solid var(--error);
                border-radius: 12px;
                padding: 12px;
                z-index: 500;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                animation: slideUp 0.3s ease;
            `;
            toast.innerHTML = `
                <div style="display:flex;align-items:flex-start;gap:10px;">
                    <div style="font-size:20px;">❌</div>
                    <div style="flex:1;min-width:0;">
                        <div style="font-size:12px;font-weight:500;color:var(--error);margin-bottom:4px;">Chyba v kódu</div>
                        <div style="font-size:11px;color:var(--text-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${escapeHtml(errorMsg.substring(0, 50))}${errorMsg.length > 50 ? '...' : ''}</div>
                    </div>
                    <button onclick="fixErrorWithAI();this.parentElement.parentElement.remove();" style="padding:8px 16px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:8px;color:white;font-size:12px;font-weight:500;cursor:pointer;white-space:nowrap;">🤖 Opravit</button>
                    <button onclick="this.parentElement.parentElement.remove();" style="padding:8px;background:transparent;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;">✕</button>
                </div>
            `;
            document.body.appendChild(toast);
            
            // Auto-hide po 10s
            setTimeout(() => {
                if (document.getElementById('errorToast')) {
                    toast.remove();
                }
            }, 10000);
        }

        async function fixErrorWithAI() {
            if (!lastError) {
                showToast('Žádná chyba k opravě', 'error');
                return;
            }
            
            if (!aiSettings.apiKey) {
                showToast('Nastav API klíč v nastavení', 'error');
                return;
            }

            // Zavři error toast
            const errorToast = document.getElementById('errorToast');
            if (errorToast) errorToast.remove();

            // Otevři AI chat pokud není
            openAIChat();
            
            // Přidej zprávu
            addAIMessage('user', `Oprav tuto chybu: ${lastError}`);
            showAITyping();
            document.getElementById('aiSendBtn').disabled = true;

            const systemPrompt = `Jsi expert na opravu HTML/CSS/JavaScript chyb.

Aktuální HTML kód:
\`\`\`html
${codeInput.value}
\`\`\`

CHYBA: ${lastError}

INSTRUKCE:
- Najdi a oprav chybu v kódu
- Vysvětli krátce co bylo špatně
- Vrať CELÝ opravený HTML kód
- Odpověz formátem:

PROBLÉM: [co bylo špatně]
ŘEŠENÍ: [co jsi opravil]

\`\`\`html
[opravený kód]
\`\`\``;

            try {
                const response = await callAI(systemPrompt, `Oprav chybu: ${lastError}`);
                hideAITyping();
                
                // Extrahuj HTML z odpovědi
                const htmlMatch = response.match(/```html?\n?([\s\S]*?)```/);
                if (htmlMatch) {
                    const newHtml = htmlMatch[1].trim();
                    codeInput.value = newHtml;
                    updatePreview();
                    markUnsaved();
                    addToHistory('AI oprava chyby');
                    
                    // Extrahuj vysvětlení
                    const problemMatch = response.match(/PROBLÉM:\s*([^\n]+)/);
                    const solutionMatch = response.match(/ŘEŠENÍ:\s*([^\n]+)/);
                    
                    let explanation = '✅ Chyba opravena!';
                    if (problemMatch) explanation += `\n\n**Problém:** ${problemMatch[1]}`;
                    if (solutionMatch) explanation += `\n**Řešení:** ${solutionMatch[1]}`;
                    
                    addAIMessage('assistant', explanation);
                    
                    // Vyčisti chyby
                    lastError = null;
                    clearConsole();
                    showToast('Chyba opravena!', 'success');
                } else {
                    addAIMessage('assistant', response);
                }
            } catch (e) {
                hideAITyping();
                addAIMessage('assistant', '❌ Chyba: ' + e.message);
            }

            document.getElementById('aiSendBtn').disabled = false;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateBadges() {
            errorBadge.textContent = consoleErrors;
            errorBadge.classList.toggle('hidden', consoleErrors === 0);
            warnBadge.textContent = consoleWarns;
            warnBadge.classList.toggle('hidden', consoleWarns === 0);
        }

        function clearConsole() {
            consoleContent.innerHTML = '<div class="console-empty">Konzole je prázdná</div>';
            consoleErrors = 0;
            consoleWarns = 0;
            updateBadges();
        }

        function handleConsoleInput(e) {
            if (e.key === 'Enter') {
                const cmd = consoleInputEl.value.trim();
                if (!cmd) return;
                commandHistory.push(cmd);
                commandHistoryIndex = commandHistory.length;
                addConsoleEntry('command', '> ' + cmd);
                consoleInputEl.value = '';
                try {
                    const result = previewFrame.contentWindow.eval(cmd);
                    if (result !== undefined) addConsoleEntry('result', formatResult(result));
                } catch (err) {
                    addConsoleEntry('error', err.message);
                }
            } else if (e.key === 'ArrowUp' && commandHistoryIndex > 0) {
                commandHistoryIndex--;
                consoleInputEl.value = commandHistory[commandHistoryIndex];
            } else if (e.key === 'ArrowDown' && commandHistoryIndex < commandHistory.length - 1) {
                commandHistoryIndex++;
                consoleInputEl.value = commandHistory[commandHistoryIndex];
            }
        }

        function formatResult(r) {
            if (r === null) return 'null';
            if (r === undefined) return 'undefined';
            if (typeof r === 'object') try { return JSON.stringify(r, null, 2); } catch { return String(r); }
            return String(r);
        }

        function setupConsoleCapture() {
            previewFrame.onload = function() {
                try {
                    const win = previewFrame.contentWindow;
                    const orig = { log: win.console.log, info: win.console.info, warn: win.console.warn, error: win.console.error };
                    win.console.log = (...args) => { addConsoleEntry('log', args.map(formatResult).join(' ')); orig.log.apply(win.console, args); };
                    win.console.info = (...args) => { addConsoleEntry('info', args.map(formatResult).join(' ')); orig.info.apply(win.console, args); };
                    win.console.warn = (...args) => { addConsoleEntry('warn', args.map(formatResult).join(' ')); orig.warn.apply(win.console, args); };
                    win.console.error = (...args) => { addConsoleEntry('error', args.map(formatResult).join(' ')); orig.error.apply(win.console, args); };
                    
                    // Zachycení JavaScript chyb
                    win.onerror = (msg, src, line, col, error) => {
                        let errorMsg = msg;
                        if (line) errorMsg += ` (řádek ${line}`;
                        if (col) errorMsg += `, sloupec ${col}`;
                        if (line) errorMsg += ')';
                        if (error && error.stack) {
                            // Přidej stack trace pro lepší diagnostiku
                            const stack = error.stack.split('\n').slice(0, 3).join(' → ');
                            errorMsg += '\n' + stack;
                        }
                        addConsoleEntry('error', errorMsg);
                        return true; // Potlač výchozí error dialog
                    };
                    
                    // Zachycení unhandled promise rejections
                    win.onunhandledrejection = (event) => {
                        const reason = event.reason;
                        let errorMsg = 'Unhandled Promise Rejection: ';
                        if (reason instanceof Error) {
                            errorMsg += reason.message;
                        } else {
                            errorMsg += String(reason);
                        }
                        addConsoleEntry('error', errorMsg);
                    };
                } catch {}
            };
        }

        // ============================================
        // PROMPTS
        // ============================================
        let prompts = [];
        let editingPromptId = null;

        function loadPrompts() {
            const saved = localStorage.getItem('htmlStudio_prompts');
            if (saved) {
                try {
                    prompts = JSON.parse(saved);
                } catch { prompts = []; }
            }
            renderPrompts();
        }

        function savePromptsToStorage() {
            localStorage.setItem('htmlStudio_prompts', JSON.stringify(prompts));
        }

        function renderPrompts() {
            const list = document.getElementById('promptsList');
            if (!list) return;

            if (prompts.length === 0) {
                list.innerHTML = '<div class="prompts-empty">Žádné prompty</div>';
                return;
            }

            list.innerHTML = prompts.map((p, i) => `
                <div class="prompt-item" onclick="copyPrompt(${i})">
                    <div class="prompt-header">
                        <span class="prompt-name">${escapeHtml(p.name)}</span>
                        <div class="prompt-actions">
                            <button class="prompt-action-btn" onclick="event.stopPropagation(); editPrompt(${i})" title="Upravit">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            </button>
                            <button class="prompt-action-btn delete" onclick="event.stopPropagation(); deletePrompt(${i})" title="Smazat">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="prompt-text">${escapeHtml(p.text)}</div>
                </div>
            `).join('');
        }

        function openAddPromptModal() {
            editingPromptId = null;
            document.getElementById('promptModalTitle').textContent = 'Přidat prompt';
            document.getElementById('promptName').value = '';
            document.getElementById('promptText').value = '';
            document.getElementById('promptModal').classList.add('active');
        }

        function closePromptModal() {
            document.getElementById('promptModal').classList.remove('active');
            editingPromptId = null;
        }

        function savePrompt() {
            const name = document.getElementById('promptName').value.trim();
            const text = document.getElementById('promptText').value.trim();

            if (!name || !text) {
                showToast('Vyplň název i text', 'error');
                return;
            }

            if (editingPromptId !== null) {
                prompts[editingPromptId] = { name, text };
                showToast('Prompt upraven', 'success');
            } else {
                prompts.push({ name, text });
                showToast('Prompt přidán', 'success');
            }

            savePromptsToStorage();
            renderPrompts();
            closePromptModal();
        }

        function editPrompt(index) {
            const p = prompts[index];
            if (!p) return;

            editingPromptId = index;
            document.getElementById('promptModalTitle').textContent = 'Upravit prompt';
            document.getElementById('promptName').value = p.name;
            document.getElementById('promptText').value = p.text;
            document.getElementById('promptModal').classList.add('active');
        }

        function deletePrompt(index) {
            if (confirm('Smazat tento prompt?')) {
                prompts.splice(index, 1);
                savePromptsToStorage();
                renderPrompts();
                showToast('Prompt smazán', 'success');
            }
        }

        function copyPrompt(index) {
            const p = prompts[index];
            if (!p) return;

            navigator.clipboard.writeText(p.text).then(() => {
                showToast('Prompt zkopírován', 'success');
            }).catch(() => {
                // Fallback pro starší prohlížeče
                const textarea = document.createElement('textarea');
                textarea.value = p.text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('Prompt zkopírován', 'success');
            });
        }

        // ============================================
        // SAVE / DOWNLOAD / IMPORT
        // ============================================
        function saveToLocal() {
            const file = files.find(f => f.id === activeFileId);
            if (file) { file.unsaved = false; file.content = codeInput.value; renderTabs(); }
            localStorage.setItem('htmlStudio_files', JSON.stringify(files));
            localStorage.setItem('htmlStudio_activeId', activeFileId);
            showToast('Uloženo', 'success');
        }

        function downloadFile() {
            const file = files.find(f => f.id === activeFileId);
            document.getElementById('fileName').value = file ? file.name : 'index.html';
            document.getElementById('saveModal').classList.add('active');
        }

        function closeSaveModal() {
            document.getElementById('saveModal').classList.remove('active');
        }

        function confirmDownload() {
            const name = document.getElementById('fileName').value || 'index.html';
            const blob = new Blob([codeInput.value], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = name;
            a.click();
            closeSaveModal();
            showToast('Staženo', 'success');
        }

        function openImportModal() {
            document.getElementById('importModal').classList.add('active');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        async function importFromUrl() {
            const url = document.getElementById('importUrl').value.trim();
            if (!url) { showToast('Zadejte URL', 'error'); return; }
            try {
                showToast('Načítám...', 'success');
                const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
                if (!res.ok) throw new Error('Nelze načíst');
                const html = await res.text();
                const name = new URL(url).hostname.replace('www.', '') + '.html';
                const file = createFile(name, html);
                activeFileId = file.id;
                codeInput.value = file.content;
                renderTabs();
                updatePreview();
                addToHistory('Import z URL');
                closeImportModal();
                switchView('code');
                showToast('Importováno', 'success');
            } catch (err) {
                showToast('Chyba: ' + err.message, 'error');
            }
        }

        function openInNewTab() {
            const win = window.open();
            win.document.write(codeInput.value);
            win.document.close();
        }

        // ============================================
        // GITHUB
        // ============================================
        let githubToken = '';
        let githubUser = null;
        let githubCurrentRepo = '';
        let githubCurrentPath = '';
        let githubFileSha = null;

        function loadGithubToken() {
            githubToken = localStorage.getItem('htmlStudio_githubToken') || '';
            if (githubToken) {
                document.getElementById('githubToken').value = '••••••••••••••••';
                checkGithubConnection();
            }
        }

        function saveGithubToken() {
            const tokenInput = document.getElementById('githubToken');
            const token = tokenInput.value.trim();
            if (!token || token === '••••••••••••••••') {
                showToast('Zadej platný token', 'error');
                return;
            }
            githubToken = token;
            localStorage.setItem('htmlStudio_githubToken', token);
            tokenInput.value = '••••••••••••••••';
            checkGithubConnection();
            
            const disconnectItem = document.getElementById('githubDisconnectItem');
            if (disconnectItem) disconnectItem.style.display = 'flex';
            
            showToast('Token uložen', 'success');
        }

        async function checkGithubConnection() {
            if (!githubToken) {
                updateGithubUI(false);
                return;
            }

            try {
                const res = await fetch('https://api.github.com/user', {
                    headers: { 'Authorization': `token ${githubToken}` }
                });
                if (res.ok) {
                    githubUser = await res.json();
                    updateGithubUI(true);
                } else {
                    githubUser = null;
                    updateGithubUI(false);
                    if (res.status === 401) {
                        showToast('Neplatný GitHub token', 'error');
                    }
                }
            } catch (e) {
                updateGithubUI(false);
            }
        }

        function updateGithubUI(connected) {
            const notConnected = document.getElementById('githubNotConnected');
            const connectedEl = document.getElementById('githubConnected');
            const userEl = document.getElementById('githubUser');
            const disconnectItem = document.getElementById('githubDisconnectItem');

            if (connected && githubUser) {
                notConnected.style.display = 'none';
                connectedEl.style.display = 'block';
                userEl.innerHTML = `
                    <img src="${githubUser.avatar_url}" class="github-avatar" alt="">
                    <span class="github-username">${githubUser.login}</span>
                `;
                if (disconnectItem) disconnectItem.style.display = 'flex';
            } else {
                notConnected.style.display = 'block';
                connectedEl.style.display = 'none';
                if (disconnectItem) disconnectItem.style.display = 'none';
            }
        }

        function disconnectGithub() {
            if (confirm('Opravdu odpojit GitHub? Token bude smazán.')) {
                localStorage.removeItem('htmlStudio_githubToken');
                githubToken = '';
                githubUser = null;
                document.getElementById('githubToken').value = '';
                updateGithubUI(false);
                showToast('GitHub odpojen', 'success');
            }
        }

        // Repo Manager
        let repoToDelete = null;

        async function openRepoManager() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }
            document.getElementById('repoManagerModal').classList.add('active');
            loadRepoManager();
        }

        function closeRepoManager() {
            document.getElementById('repoManagerModal').classList.remove('active');
        }

        async function loadRepoManager() {
            const list = document.getElementById('repoManagerList');
            const stats = document.getElementById('repoStats');
            
            list.innerHTML = '<div class="github-loading">Načítám repozitáře...</div>';
            stats.innerHTML = '';

            try {
                const res = await fetch('https://api.github.com/user/repos?sort=updated&per_page=100', {
                    headers: { 'Authorization': `token ${githubToken}` }
                });
                const repos = await res.json();

                // Stats
                const publicCount = repos.filter(r => !r.private).length;
                const privateCount = repos.filter(r => r.private).length;
                const totalSize = repos.reduce((acc, r) => acc + (r.size || 0), 0);

                stats.innerHTML = `
                    <div class="repo-stat">
                        <span class="repo-stat-value">${repos.length}</span>
                        <span class="repo-stat-label">Celkem</span>
                    </div>
                    <div class="repo-stat">
                        <span class="repo-stat-value">${publicCount}</span>
                        <span class="repo-stat-label">Veřejné</span>
                    </div>
                    <div class="repo-stat">
                        <span class="repo-stat-value">${privateCount}</span>
                        <span class="repo-stat-label">Soukromé</span>
                    </div>
                    <div class="repo-stat">
                        <span class="repo-stat-value">${formatFileSize(totalSize * 1024)}</span>
                        <span class="repo-stat-label">Velikost</span>
                    </div>
                `;

                if (repos.length === 0) {
                    list.innerHTML = '<div class="github-empty">Žádné repozitáře. Vytvoř první!</div>';
                    return;
                }

                list.innerHTML = repos.map(repo => {
                    const updated = new Date(repo.updated_at).toLocaleDateString('cs-CZ');
                    const safeDesc = (repo.description || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    return `
                        <div class="repo-card">
                            <div class="repo-card-header">
                                <span class="repo-card-name">${repo.name}</span>
                                <div class="repo-card-badges">
                                    ${repo.private ? '<span class="repo-badge private">🔒 Soukromé</span>' : '<span class="repo-badge">Veřejné</span>'}
                                </div>
                            </div>
                            ${repo.description ? `<div class="repo-card-desc">${escapeHtml(repo.description)}</div>` : ''}
                            <div class="repo-card-meta">
                                <span>📅 ${updated}</span>
                                <span>⭐ ${repo.stargazers_count}</span>
                                <span>📦 ${formatFileSize(repo.size * 1024)}</span>
                            </div>
                            <div class="repo-card-actions">
                                <button class="repo-action-btn" onclick="loadGithubContents('${repo.full_name}', ''); closeRepoManager();">
                                    📁
                                </button>
                                <button class="repo-action-btn" onclick="openRepoSettings('${repo.full_name}', '${repo.name}', '${safeDesc}', ${repo.private})">
                                    ⚙️
                                </button>
                                <button class="repo-action-btn" onclick="window.open('${repo.html_url}', '_blank')">
                                    🔗
                                </button>
                                <button class="repo-action-btn danger" onclick="openDeleteRepoModal('${repo.full_name}', '${repo.name}')">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                list.innerHTML = '<div class="github-empty">Chyba při načítání</div>';
            }
        }

        function openCreateRepoModal() {
            document.getElementById('newRepoName').value = '';
            document.getElementById('newRepoDesc').value = '';
            document.getElementById('newRepoPrivate').checked = false;
            document.getElementById('newRepoReadme').checked = true;
            document.getElementById('createRepoModal').classList.add('active');
        }

        function closeCreateRepoModal() {
            document.getElementById('createRepoModal').classList.remove('active');
        }

        async function createNewRepo() {
            const name = document.getElementById('newRepoName').value.trim();
            const description = document.getElementById('newRepoDesc').value.trim();
            const isPrivate = document.getElementById('newRepoPrivate').checked;
            const autoInit = document.getElementById('newRepoReadme').checked;

            if (!name) {
                showToast('Zadej název repozitáře', 'error');
                return;
            }

            // Validate repo name
            if (!/^[a-zA-Z0-9._-]+$/.test(name)) {
                showToast('Název může obsahovat pouze a-z, 0-9, -, _, .', 'error');
                return;
            }

            try {
                showToast('Vytvářím repozitář...', 'success');

                const res = await fetch('https://api.github.com/user/repos', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        description: description,
                        private: isPrivate,
                        auto_init: autoInit
                    })
                });

                if (res.ok) {
                    const repo = await res.json();
                    closeCreateRepoModal();
                    loadRepoManager();
                    showToast(`Repozitář "${name}" vytvořen!`, 'success');
                } else {
                    const err = await res.json();
                    if (err.errors && err.errors[0]) {
                        showToast('Chyba: ' + err.errors[0].message, 'error');
                    } else {
                        showToast('Chyba: ' + (err.message || 'Nelze vytvořit'), 'error');
                    }
                }
            } catch (e) {
                showToast('Chyba při vytváření', 'error');
            }
        }

        function openDeleteRepoModal(fullName, name) {
            repoToDelete = fullName;
            document.getElementById('deleteRepoName').textContent = fullName;
            // Předvyplnit název bez posledních 2 písmen
            const prefilled = name.length > 2 ? name.slice(0, -2) : '';
            document.getElementById('deleteRepoConfirm').value = prefilled;
            document.getElementById('deleteRepoConfirm').placeholder = name;
            document.getElementById('deleteRepoModal').classList.add('active');
        }

        function closeDeleteRepoModal() {
            document.getElementById('deleteRepoModal').classList.remove('active');
            repoToDelete = null;
        }

        async function confirmDeleteRepo() {
            const confirm = document.getElementById('deleteRepoConfirm').value.trim();
            const repoName = repoToDelete.split('/')[1];

            if (confirm !== repoName) {
                showToast('Název nesouhlasí', 'error');
                return;
            }

            try {
                showToast('Mažu repozitář...', 'success');

                const res = await fetch(`https://api.github.com/repos/${repoToDelete}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `token ${githubToken}`
                    }
                });

                if (res.ok || res.status === 204) {
                    closeDeleteRepoModal();
                    loadRepoManager();
                    showToast('Repozitář smazán', 'success');
                } else {
                    const err = await res.json();
                    showToast('Chyba: ' + (err.message || 'Nelze smazat'), 'error');
                }
            } catch (e) {
                showToast('Chyba při mazání', 'error');
            }
        }

        // ============================================
        // GITHUB PAGES
        // ============================================
        function openGithubPages() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }
            const file = files.find(f => f.id === activeFileId);
            document.getElementById('pagesRepo').value = file?.githubRepo || '';
            document.getElementById('pagesStatus').innerHTML = '<div class="github-empty">Zadej repozitář a klikni Zkontrolovat</div>';
            document.getElementById('githubPagesModal').classList.add('active');
            
            if (file?.githubRepo) {
                checkPagesStatus();
            }
        }

        function closeGithubPages() {
            document.getElementById('githubPagesModal').classList.remove('active');
        }

        async function checkPagesStatus() {
            const repo = document.getElementById('pagesRepo').value.trim();
            if (!repo) {
                showToast('Zadej repozitář', 'error');
                return;
            }

            const statusEl = document.getElementById('pagesStatus');
            statusEl.innerHTML = '<div class="github-loading">Načítám...</div>';

            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/pages`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (res.ok) {
                    const pages = await res.json();
                    const url = pages.html_url || `https://${repo.split('/')[0]}.github.io/${repo.split('/')[1]}/`;
                    statusEl.innerHTML = `
                        <div class="pages-status">
                            <div class="pages-status-header">
                                <div class="pages-status-icon active">✓</div>
                                <div>
                                    <div class="pages-status-title">Pages aktivní</div>
                                    <div class="pages-status-subtitle">Zdroj: ${pages.source?.branch || 'main'} / ${pages.source?.path || '/'}</div>
                                </div>
                            </div>
                            <a href="${url}" target="_blank" class="pages-url">${url}</a>
                            <div class="pages-actions">
                                <button class="pages-btn" onclick="window.open('${url}', '_blank')">Otevřít stránku</button>
                                <button class="pages-btn danger" onclick="disablePages('${repo}')">Vypnout</button>
                            </div>
                        </div>
                    `;
                } else if (res.status === 404) {
                    statusEl.innerHTML = `
                        <div class="pages-status">
                            <div class="pages-status-header">
                                <div class="pages-status-icon inactive">✗</div>
                                <div>
                                    <div class="pages-status-title">Pages neaktivní</div>
                                    <div class="pages-status-subtitle">GitHub Pages není zapnutý</div>
                                </div>
                            </div>
                            <div class="pages-actions">
                                <button class="pages-btn primary" onclick="enablePages('${repo}')">Zapnout Pages</button>
                            </div>
                        </div>
                    `;
                } else {
                    statusEl.innerHTML = '<div class="github-empty">Nelze načíst stav Pages</div>';
                }
            } catch (e) {
                statusEl.innerHTML = '<div class="github-empty">Chyba při načítání</div>';
            }
        }

        async function enablePages(repo) {
            try {
                showToast('Zapínám Pages...', 'success');
                const res = await fetch(`https://api.github.com/repos/${repo}/pages`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        source: { branch: 'main', path: '/' }
                    })
                });

                if (res.ok || res.status === 201) {
                    showToast('Pages zapnuty!', 'success');
                    setTimeout(() => checkPagesStatus(), 1000);
                } else {
                    const err = await res.json();
                    showToast('Chyba: ' + (err.message || 'Nelze zapnout'), 'error');
                }
            } catch (e) {
                showToast('Chyba', 'error');
            }
        }

        async function disablePages(repo) {
            if (!confirm('Opravdu vypnout GitHub Pages?')) return;
            
            try {
                showToast('Vypínám Pages...', 'success');
                const res = await fetch(`https://api.github.com/repos/${repo}/pages`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (res.ok || res.status === 204) {
                    showToast('Pages vypnuty', 'success');
                    checkPagesStatus();
                } else {
                    showToast('Nelze vypnout Pages', 'error');
                }
            } catch (e) {
                showToast('Chyba', 'error');
            }
        }

        // ============================================
        // COMMIT HISTORY
        // ============================================
        function openCommitHistory() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }
            const file = files.find(f => f.id === activeFileId);
            document.getElementById('historyRepo').value = file?.githubRepo || '';
            document.getElementById('commitList').innerHTML = '<div class="github-empty">Zadej repozitář a klikni Načíst</div>';
            document.getElementById('commitHistoryModal').classList.add('active');
            
            if (file?.githubRepo) {
                loadCommitHistory();
            }
        }

        function closeCommitHistory() {
            document.getElementById('commitHistoryModal').classList.remove('active');
        }

        async function loadCommitHistory() {
            const repo = document.getElementById('historyRepo').value.trim();
            if (!repo) {
                showToast('Zadej repozitář', 'error');
                return;
            }

            const listEl = document.getElementById('commitList');
            listEl.innerHTML = '<div class="github-loading">Načítám commity...</div>';

            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/commits?per_page=20`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!res.ok) {
                    listEl.innerHTML = '<div class="github-empty">Nelze načíst historii</div>';
                    return;
                }

                const commits = await res.json();

                if (commits.length === 0) {
                    listEl.innerHTML = '<div class="github-empty">Žádné commity</div>';
                    return;
                }

                listEl.innerHTML = commits.map(commit => {
                    const date = new Date(commit.commit.author.date).toLocaleString('cs-CZ');
                    const sha = commit.sha.substring(0, 7);
                    const message = escapeHtml(commit.commit.message.split('\n')[0]);
                    const author = commit.author?.login || commit.commit.author.name;
                    const avatar = commit.author?.avatar_url || '';

                    return `
                        <div class="commit-item" onclick="loadCommitFiles('${repo}', '${commit.sha}')">
                            <div class="commit-header">
                                <span class="commit-sha">${sha}</span>
                                <span class="commit-date">${date}</span>
                            </div>
                            <div class="commit-message">${message}</div>
                            <div class="commit-author">
                                ${avatar ? `<img src="${avatar}" alt="">` : ''}
                                ${author}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                listEl.innerHTML = '<div class="github-empty">Chyba při načítání</div>';
            }
        }

        async function loadCommitFiles(repo, sha) {
            try {
                showToast('Načítám soubory...', 'success');
                const res = await fetch(`https://api.github.com/repos/${repo}/commits/${sha}`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!res.ok) {
                    showToast('Nelze načíst commit', 'error');
                    return;
                }

                const commit = await res.json();
                const files = commit.files || [];

                if (files.length === 0) {
                    showToast('Žádné soubory', 'error');
                    return;
                }

                // Zobrazit soubory v commit itemu
                const listEl = document.getElementById('commitList');
                const items = listEl.querySelectorAll('.commit-item');
                items.forEach(item => {
                    const existingFiles = item.querySelector('.commit-files');
                    if (existingFiles) existingFiles.remove();
                });

                // Najít správný commit item
                const commitItems = [...listEl.querySelectorAll('.commit-item')];
                const targetItem = commitItems.find(item => item.querySelector('.commit-sha')?.textContent === sha.substring(0, 7));
                
                if (targetItem) {
                    const filesHtml = files.map(f => {
                        const size = formatFileSize(f.changes || 0);
                        const additions = f.additions || 0;
                        const deletions = f.deletions || 0;
                        return `<button class="commit-file-btn" onclick="event.stopPropagation(); loadFileFromCommit('${repo}', '${sha}', '${f.filename}')">
                            📄 ${f.filename.split('/').pop()} 
                            <span style="color:var(--success);">+${additions}</span>
                            <span style="color:var(--error);">-${deletions}</span>
                        </button>`;
                    }).join('');
                    
                    targetItem.insertAdjacentHTML('beforeend', `<div class="commit-files">${filesHtml}</div>`);
                }
            } catch (e) {
                showToast('Chyba', 'error');
            }
        }

        async function loadFileFromCommit(repo, sha, filename) {
            try {
                showToast('Načítám soubor...', 'success');
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}?ref=${sha}`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!res.ok) {
                    showToast('Nelze načíst soubor', 'error');
                    return;
                }

                const fileData = await res.json();
                if (fileData.encoding === 'base64') {
                    const content = atob(fileData.content);
                    const name = filename.split('/').pop() + ` (${sha.substring(0, 7)})`;
                    const file = createFile(name, content);
                    file.githubRepo = repo;
                    activeFileId = file.id;
                    codeInput.value = file.content;
                    renderTabs();
                    updatePreview();
                    addToHistory('GitHub: ' + name);
                    closeCommitHistory();
                    switchView('code');
                    showToast('Soubor načten', 'success');
                }
            } catch (e) {
                showToast('Chyba', 'error');
            }
        }

        // ============================================
        // DIFF VIEW
        // ============================================
        function openDiffView() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }
            
            const file = files.find(f => f.id === activeFileId);
            if (!file || !file.githubRepo || !file.githubPath) {
                document.getElementById('diffInfo').innerHTML = '';
                document.getElementById('diffContainer').innerHTML = '<div class="github-empty">Není co porovnat. Otevři soubor z GitHubu.</div>';
                document.getElementById('diffViewModal').classList.add('active');
                return;
            }

            document.getElementById('diffViewModal').classList.add('active');
            loadDiff(file);
        }

        function closeDiffView() {
            document.getElementById('diffViewModal').classList.remove('active');
        }

        async function loadDiff(file) {
            const infoEl = document.getElementById('diffInfo');
            const containerEl = document.getElementById('diffContainer');

            infoEl.innerHTML = `<div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">
                📁 ${file.githubRepo} / ${file.githubPath}
            </div>`;
            containerEl.innerHTML = '<div class="github-loading">Načítám originál z GitHubu...</div>';

            try {
                const res = await fetch(`https://api.github.com/repos/${file.githubRepo}/contents/${file.githubPath}`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!res.ok) {
                    containerEl.innerHTML = '<div class="github-empty">Nelze načíst originál z GitHubu</div>';
                    return;
                }

                const data = await res.json();
                const originalContent = data.encoding === 'base64' ? atob(data.content) : '';
                const localContent = codeInput.value;

                // Spočítat velikosti
                const originalSize = new Blob([originalContent]).size;
                const localSize = new Blob([localContent]).size;
                const sizeDiff = localSize - originalSize;

                // Vytvořit diff
                const diff = createDiff(originalContent, localContent);

                containerEl.innerHTML = `
                    <div class="diff-stats">
                        <div class="diff-stat added">+ ${diff.additions} přidáno</div>
                        <div class="diff-stat removed">- ${diff.deletions} odebráno</div>
                        <div class="diff-stat size">
                            📦 ${formatFileSize(originalSize)} → ${formatFileSize(localSize)} 
                            (${sizeDiff >= 0 ? '+' : ''}${formatFileSize(Math.abs(sizeDiff))})
                        </div>
                    </div>
                    <div class="diff-content">${diff.html}</div>
                `;
            } catch (e) {
                containerEl.innerHTML = '<div class="github-empty">Chyba při načítání</div>';
            }
        }

        function createDiff(original, modified) {
            const originalLines = original.split('\n');
            const modifiedLines = modified.split('\n');
            
            let html = '';
            let additions = 0;
            let deletions = 0;
            
            // Jednoduchý line-by-line diff
            const maxLines = Math.max(originalLines.length, modifiedLines.length);
            
            let i = 0, j = 0;
            
            while (i < originalLines.length || j < modifiedLines.length) {
                const origLine = originalLines[i] || '';
                const modLine = modifiedLines[j] || '';
                
                if (i >= originalLines.length) {
                    // Přidané řádky na konci
                    html += `<div class="diff-line added"><span class="diff-line-number">+${j + 1}</span>${escapeHtml(modLine)}</div>`;
                    additions++;
                    j++;
                } else if (j >= modifiedLines.length) {
                    // Odebrané řádky na konci
                    html += `<div class="diff-line removed"><span class="diff-line-number">-${i + 1}</span>${escapeHtml(origLine)}</div>`;
                    deletions++;
                    i++;
                } else if (origLine === modLine) {
                    // Stejné řádky
                    html += `<div class="diff-line context"><span class="diff-line-number">${i + 1}</span>${escapeHtml(origLine)}</div>`;
                    i++;
                    j++;
                } else {
                    // Změněné řádky
                    html += `<div class="diff-line removed"><span class="diff-line-number">-${i + 1}</span>${escapeHtml(origLine)}</div>`;
                    html += `<div class="diff-line added"><span class="diff-line-number">+${j + 1}</span>${escapeHtml(modLine)}</div>`;
                    deletions++;
                    additions++;
                    i++;
                    j++;
                }
            }

            if (additions === 0 && deletions === 0) {
                html = '<div class="diff-line context" style="text-align:center;padding:20px;color:var(--text-muted);">Žádné změny</div>';
            }

            return { html, additions, deletions };
        }

        // ============================================
        // GISTS
        // ============================================
        function openGistManager() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }
            document.getElementById('gistManagerModal').classList.add('active');
            loadGists();
        }

        function closeGistManager() {
            document.getElementById('gistManagerModal').classList.remove('active');
        }

        async function loadGists() {
            const listEl = document.getElementById('gistList');
            listEl.innerHTML = '<div class="github-loading">Načítám gists...</div>';

            try {
                const res = await fetch('https://api.github.com/gists?per_page=30', {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!res.ok) {
                    listEl.innerHTML = '<div class="github-empty">Nelze načíst gists</div>';
                    return;
                }

                const gists = await res.json();

                if (gists.length === 0) {
                    listEl.innerHTML = '<div class="github-empty">Žádné gists. Vytvoř první!</div>';
                    return;
                }

                listEl.innerHTML = gists.map(gist => {
                    const files = Object.keys(gist.files);
                    const filename = files[0] || 'untitled';
                    const fileCount = files.length;
                    const date = new Date(gist.created_at).toLocaleDateString('cs-CZ');
                    const isPublic = gist.public;

                    return `
                        <div class="gist-item">
                            <div class="gist-header">
                                <span class="gist-filename">${escapeHtml(filename)}${fileCount > 1 ? ` (+${fileCount - 1})` : ''}</span>
                                <span class="gist-badge ${isPublic ? 'public' : ''}">${isPublic ? 'Veřejný' : 'Soukromý'}</span>
                            </div>
                            ${gist.description ? `<div class="gist-desc">${escapeHtml(gist.description)}</div>` : ''}
                            <div class="gist-meta">📅 ${date}</div>
                            <div class="gist-actions">
                                <button class="gist-action-btn" onclick="loadGistFile('${gist.id}', '${filename}')">
                                    📥 Načíst
                                </button>
                                <button class="gist-action-btn" onclick="copyGistUrl('${gist.html_url}')">
                                    🔗 Kopírovat URL
                                </button>
                                <button class="gist-action-btn" onclick="window.open('${gist.html_url}', '_blank')">
                                    🌐 Otevřít
                                </button>
                                <button class="gist-action-btn danger" onclick="deleteGist('${gist.id}')">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                listEl.innerHTML = '<div class="github-empty">Chyba při načítání</div>';
            }
        }

        function openCreateGistModal() {
            const file = files.find(f => f.id === activeFileId);
            document.getElementById('gistFilename').value = file?.name || 'index.html';
            document.getElementById('gistDescription').value = '';
            document.getElementById('gistPublic').checked = true;
            document.getElementById('createGistModal').classList.add('active');
        }

        function closeCreateGistModal() {
            document.getElementById('createGistModal').classList.remove('active');
        }

        async function createGist() {
            const filename = document.getElementById('gistFilename').value.trim() || 'index.html';
            const description = document.getElementById('gistDescription').value.trim();
            const isPublic = document.getElementById('gistPublic').checked;
            const content = codeInput.value;

            if (!content) {
                showToast('Soubor je prázdný', 'error');
                return;
            }

            try {
                showToast('Vytvářím gist...', 'success');

                const res = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: description,
                        public: isPublic,
                        files: {
                            [filename]: { content: content }
                        }
                    })
                });

                if (res.ok) {
                    const gist = await res.json();
                    closeCreateGistModal();
                    loadGists();
                    
                    // Kopírovat URL do schránky
                    navigator.clipboard.writeText(gist.html_url).then(() => {
                        showToast('Gist vytvořen! URL zkopírována.', 'success');
                    }).catch(() => {
                        showToast('Gist vytvořen!', 'success');
                    });
                } else {
                    const err = await res.json();
                    showToast('Chyba: ' + (err.message || 'Nelze vytvořit'), 'error');
                }
            } catch (e) {
                showToast('Chyba při vytváření', 'error');
            }
        }

        async function loadGistFile(gistId, filename) {
            try {
                showToast('Načítám gist...', 'success');
                const res = await fetch(`https://api.github.com/gists/${gistId}`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!res.ok) {
                    showToast('Nelze načíst gist', 'error');
                    return;
                }

                const gist = await res.json();
                const fileData = gist.files[filename];

                if (fileData && fileData.content) {
                    const file = createFile(filename, fileData.content);
                    file.gistId = gistId;
                    activeFileId = file.id;
                    codeInput.value = file.content;
                    renderTabs();
                    updatePreview();
                    addToHistory('Gist: ' + filename);
                    closeGistManager();
                    switchView('code');
                    showToast('Gist načten', 'success');
                }
            } catch (e) {
                showToast('Chyba', 'error');
            }
        }

        function copyGistUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                showToast('URL zkopírována', 'success');
            }).catch(() => {
                showToast('Nelze kopírovat', 'error');
            });
        }

        async function deleteGist(gistId) {
            if (!confirm('Smazat tento gist?')) return;

            try {
                showToast('Mažu gist...', 'success');
                const res = await fetch(`https://api.github.com/gists/${gistId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (res.ok || res.status === 204) {
                    loadGists();
                    showToast('Gist smazán', 'success');
                } else {
                    showToast('Nelze smazat', 'error');
                }
            } catch (e) {
                showToast('Chyba', 'error');
            }
        }

        // ============================================
        // REPO SETTINGS
        // ============================================
        let currentRepoSettings = null;

        function openRepoSettings(fullName, name, description, isPrivate) {
            currentRepoSettings = fullName;
            document.getElementById('repoSettingsFullName').value = fullName;
            document.getElementById('repoSettingsName').value = name;
            document.getElementById('repoSettingsDesc').value = description.replace(/&quot;/g, '"');
            document.getElementById('repoSettingsPrivate').checked = isPrivate;
            document.getElementById('repoSettingsTopics').value = '';
            document.getElementById('repoSettingsModal').classList.add('active');
            
            // Načíst topics
            loadRepoTopics(fullName);
        }

        function closeRepoSettings() {
            document.getElementById('repoSettingsModal').classList.remove('active');
            currentRepoSettings = null;
        }

        async function loadRepoTopics(fullName) {
            try {
                const res = await fetch(`https://api.github.com/repos/${fullName}/topics`, {
                    headers: { 
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.mercy-preview+json'
                    }
                });
                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('repoSettingsTopics').value = (data.names || []).join(', ');
                }
            } catch (e) {
                // Ignore error
            }
        }

        async function saveRepoSettings() {
            const fullName = document.getElementById('repoSettingsFullName').value;
            const newName = document.getElementById('repoSettingsName').value.trim();
            const description = document.getElementById('repoSettingsDesc').value.trim();
            const isPrivate = document.getElementById('repoSettingsPrivate').checked;
            const topicsStr = document.getElementById('repoSettingsTopics').value.trim();
            const topics = topicsStr ? topicsStr.split(',').map(t => t.trim().toLowerCase()).filter(t => t) : [];

            if (!newName) {
                showToast('Zadej název repozitáře', 'error');
                return;
            }

            try {
                showToast('Ukládám...', 'success');

                // Aktualizace repo
                const res = await fetch(`https://api.github.com/repos/${fullName}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: newName,
                        description: description,
                        private: isPrivate
                    })
                });

                if (!res.ok) {
                    const err = await res.json();
                    showToast('Chyba: ' + (err.message || 'Nelze uložit'), 'error');
                    return;
                }

                // Aktualizace topics
                const owner = fullName.split('/')[0];
                const newFullName = `${owner}/${newName}`;
                
                await fetch(`https://api.github.com/repos/${newFullName}/topics`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.mercy-preview+json'
                    },
                    body: JSON.stringify({ names: topics })
                });

                closeRepoSettings();
                loadRepoManager();
                showToast('Nastavení uloženo!', 'success');
            } catch (e) {
                showToast('Chyba při ukládání', 'error');
            }
        }

        // ============================================
        // FORK
        // ============================================
        function openForkModal() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }
            document.getElementById('forkRepoName').value = '';
            document.getElementById('forkModal').classList.add('active');
        }

        function closeForkModal() {
            document.getElementById('forkModal').classList.remove('active');
        }

        async function forkRepo() {
            const repoName = document.getElementById('forkRepoName').value.trim();
            
            if (!repoName || !repoName.includes('/')) {
                showToast('Zadej repozitář ve formátu owner/repo', 'error');
                return;
            }

            try {
                showToast('Vytvářím fork...', 'success');

                const res = await fetch(`https://api.github.com/repos/${repoName}/forks`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (res.ok || res.status === 202) {
                    const fork = await res.json();
                    closeForkModal();
                    showToast(`Fork vytvořen: ${fork.full_name}`, 'success');
                    
                    // Otevřít fork v prohlížeči po chvíli
                    setTimeout(() => {
                        if (confirm('Fork vytvořen! Otevřít ho teď?')) {
                            loadGithubContents(fork.full_name, '');
                            document.getElementById('githubBrowserModal').classList.add('active');
                        }
                    }, 500);
                } else {
                    const err = await res.json();
                    if (res.status === 404) {
                        showToast('Repozitář nenalezen', 'error');
                    } else {
                        showToast('Chyba: ' + (err.message || 'Nelze forknout'), 'error');
                    }
                }
            } catch (e) {
                showToast('Chyba při vytváření forku', 'error');
            }
        }

        // ============================================
        // CONTEXT MENU
        // ============================================
        const contextMenu = document.getElementById('contextMenu');
        let selectionStart = 0;
        let selectionEnd = 0;

        codeInput.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            
            selectionStart = codeInput.selectionStart;
            selectionEnd = codeInput.selectionEnd;
            
            if (selectionStart === selectionEnd) {
                // Žádný výběr - skryj menu
                contextMenu.classList.remove('active');
                return;
            }

            // Pozice menu
            const rect = codeInput.getBoundingClientRect();
            let x = e.clientX;
            let y = e.clientY;

            // Ujisti se, že menu nepřesáhne obrazovku
            const menuWidth = 170;
            const menuHeight = 280;
            
            if (x + menuWidth > window.innerWidth) {
                x = window.innerWidth - menuWidth - 10;
            }
            if (y + menuHeight > window.innerHeight) {
                y = window.innerHeight - menuHeight - 10;
            }

            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            contextMenu.classList.add('active');
        });

        // Long press pro mobil
        let longPressTimer;
        codeInput.addEventListener('touchstart', function(e) {
            longPressTimer = setTimeout(() => {
                selectionStart = codeInput.selectionStart;
                selectionEnd = codeInput.selectionEnd;
                
                if (selectionStart !== selectionEnd) {
                    const touch = e.touches[0];
                    let x = touch.clientX;
                    let y = touch.clientY;
                    
                    const menuWidth = 170;
                    const menuHeight = 280;
                    
                    if (x + menuWidth > window.innerWidth) {
                        x = window.innerWidth - menuWidth - 10;
                    }
                    if (y + menuHeight > window.innerHeight) {
                        y = window.innerHeight - menuHeight - 10;
                    }

                    contextMenu.style.left = x + 'px';
                    contextMenu.style.top = y + 'px';
                    contextMenu.classList.add('active');
                }
            }, 500);
        });

        codeInput.addEventListener('touchend', function() {
            clearTimeout(longPressTimer);
        });

        codeInput.addEventListener('touchmove', function() {
            clearTimeout(longPressTimer);
        });

        document.addEventListener('click', function(e) {
            if (!contextMenu.contains(e.target)) {
                contextMenu.classList.remove('active');
            }
        });

        document.addEventListener('touchstart', function(e) {
            if (!contextMenu.contains(e.target) && e.target !== codeInput) {
                contextMenu.classList.remove('active');
            }
        });

        function wrapWithTag(tag) {
            const selected = codeInput.value.substring(selectionStart, selectionEnd);
            const wrapped = `<${tag}>${selected}</${tag}>`;
            
            codeInput.value = codeInput.value.substring(0, selectionStart) + wrapped + codeInput.value.substring(selectionEnd);
            codeInput.selectionStart = selectionStart;
            codeInput.selectionEnd = selectionStart + wrapped.length;
            
            updatePreview();
            markUnsaved();
            addToHistory(`Obalit <${tag}>`);
            contextMenu.classList.remove('active');
            codeInput.focus();
        }

        function wrapWithCustomTag() {
            const tag = prompt('Zadej název tagu:', 'div');
            if (tag) {
                wrapWithTag(tag.trim());
            }
        }

        function commentSelection() {
            const selected = codeInput.value.substring(selectionStart, selectionEnd);
            const commented = `<!-- ${selected} -->`;
            
            codeInput.value = codeInput.value.substring(0, selectionStart) + commented + codeInput.value.substring(selectionEnd);
            
            updatePreview();
            markUnsaved();
            addToHistory('Zakomentovat');
            contextMenu.classList.remove('active');
            codeInput.focus();
        }

        function duplicateSelection() {
            const selected = codeInput.value.substring(selectionStart, selectionEnd);
            
            codeInput.value = codeInput.value.substring(0, selectionEnd) + '\n' + selected + codeInput.value.substring(selectionEnd);
            
            updatePreview();
            markUnsaved();
            addToHistory('Duplikovat');
            contextMenu.classList.remove('active');
            codeInput.focus();
        }

        function deleteSelection() {
            codeInput.value = codeInput.value.substring(0, selectionStart) + codeInput.value.substring(selectionEnd);
            codeInput.selectionStart = codeInput.selectionEnd = selectionStart;
            
            updatePreview();
            markUnsaved();
            addToHistory('Smazat');
            contextMenu.classList.remove('active');
            codeInput.focus();
        }

        // ============================================
        // AUTO CLOSE TAGS
        // ============================================
        const selfClosingTags = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wbr'];

        codeInput.addEventListener('keydown', function(e) {
            if (!autoCloseEnabled) return;
            
            // Auto close tag when typing >
            if (e.key === '>') {
                const cursorPos = codeInput.selectionStart;
                const textBefore = codeInput.value.substring(0, cursorPos);
                
                // Najdi poslední otevírací tag
                const tagMatch = textBefore.match(/<([a-zA-Z][a-zA-Z0-9]*)\s*[^>]*$/);
                
                if (tagMatch) {
                    const tagName = tagMatch[1].toLowerCase();
                    
                    // Nekončí / (není self-closing)
                    if (!textBefore.endsWith('/') && !selfClosingTags.includes(tagName)) {
                        e.preventDefault();
                        
                        const closeTag = `></${tagName}>`;
                        const before = codeInput.value.substring(0, cursorPos);
                        const after = codeInput.value.substring(cursorPos);
                        
                        codeInput.value = before + closeTag + after;
                        codeInput.selectionStart = codeInput.selectionEnd = cursorPos + 1; // Po >
                        
                        updatePreview();
                        markUnsaved();
                    }
                }
            }
        });

        // ============================================
        // RESPONSIVE PREVIEW
        // ============================================
        function setPreviewSize(size) {
            const wrapper = document.getElementById('previewWrapper');
            const label = document.getElementById('previewSizeLabel');
            const buttons = document.querySelectorAll('.responsive-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-size="${size}"]`).classList.add('active');
            
            wrapper.classList.remove('tablet', 'mobile');
            
            if (size === 'tablet') {
                wrapper.classList.add('tablet');
                label.textContent = '768px';
            } else if (size === 'mobile') {
                wrapper.classList.add('mobile');
                label.textContent = '375px';
            } else {
                label.textContent = '100%';
            }
        }

        // ============================================
        // HTML VALIDATION
        // ============================================
        function validateHTML() {
            document.getElementById('validationModal').classList.add('active');
            const listEl = document.getElementById('validationList');
            
            const code = codeInput.value;
            const errors = [];
            const warnings = [];
            
            // Kontrola DOCTYPE
            if (!code.trim().toLowerCase().startsWith('<!doctype')) {
                warnings.push({ line: 1, message: 'Chybí <!DOCTYPE html> na začátku dokumentu' });
            }
            
            // Kontrola <html>, <head>, <body>
            if (!/<html[^>]*>/i.test(code)) {
                warnings.push({ line: 1, message: 'Chybí <html> tag' });
            }
            if (!/<head[^>]*>/i.test(code)) {
                warnings.push({ line: 1, message: 'Chybí <head> tag' });
            }
            if (!/<body[^>]*>/i.test(code)) {
                warnings.push({ line: 1, message: 'Chybí <body> tag' });
            }
            
            // Kontrola <title>
            if (!/<title[^>]*>.*<\/title>/i.test(code)) {
                warnings.push({ line: 1, message: 'Chybí <title> tag v hlavičce' });
            }
            
            // Kontrola nezavřených tagů
            const tagStack = [];
            const tagRegex = /<\/?([a-zA-Z][a-zA-Z0-9]*)[^>]*>/g;
            const lines = code.split('\n');
            let lineNum = 1;
            let charPos = 0;
            
            let match;
            while ((match = tagRegex.exec(code)) !== null) {
                // Zjisti číslo řádku
                while (charPos + lines[lineNum - 1].length + 1 <= match.index && lineNum <= lines.length) {
                    charPos += lines[lineNum - 1].length + 1;
                    lineNum++;
                }
                
                const fullTag = match[0];
                const tagName = match[1].toLowerCase();
                
                // Přeskoč self-closing tagy
                if (selfClosingTags.includes(tagName) || fullTag.endsWith('/>')) {
                    continue;
                }
                
                if (fullTag.startsWith('</')) {
                    // Zavírací tag
                    if (tagStack.length === 0) {
                        errors.push({ line: lineNum, message: `Zavírací tag </${tagName}> bez odpovídajícího otevíracího` });
                    } else {
                        const last = tagStack.pop();
                        if (last.name !== tagName) {
                            errors.push({ line: lineNum, message: `Očekáván </${last.name}>, nalezen </${tagName}>` });
                            tagStack.push(last);
                        }
                    }
                } else {
                    // Otevírací tag
                    tagStack.push({ name: tagName, line: lineNum });
                }
            }
            
            // Nezavřené tagy
            tagStack.forEach(tag => {
                errors.push({ line: tag.line, message: `Tag <${tag.name}> není uzavřen` });
            });
            
            // Kontrola prázdných atributů href/src
            const emptyAttrRegex = /(href|src)=["']["']/gi;
            lineNum = 1;
            for (const line of lines) {
                if (emptyAttrRegex.test(line)) {
                    warnings.push({ line: lineNum, message: 'Prázdný atribut href nebo src' });
                }
                lineNum++;
            }
            
            // Kontrola alt u obrázků
            const imgRegex = /<img(?![^>]*alt=)[^>]*>/gi;
            lineNum = 1;
            for (const line of lines) {
                if (imgRegex.test(line)) {
                    warnings.push({ line: lineNum, message: 'Obrázek <img> bez atributu alt' });
                }
                lineNum++;
            }
            
            // Zobrazit výsledky
            if (errors.length === 0 && warnings.length === 0) {
                listEl.innerHTML = `
                    <div class="validation-item success">
                        <div class="validation-message">✓ Žádné problémy nenalezeny!</div>
                    </div>
                `;
            } else {
                listEl.innerHTML = errors.map(e => `
                    <div class="validation-item error">
                        <div class="validation-line">Řádek ${e.line}</div>
                        <div class="validation-message">❌ ${e.message}</div>
                    </div>
                `).join('') + warnings.map(w => `
                    <div class="validation-item warning">
                        <div class="validation-line">Řádek ${w.line}</div>
                        <div class="validation-message">⚠️ ${w.message}</div>
                    </div>
                `).join('');
            }
        }

        function closeValidation() {
            document.getElementById('validationModal').classList.remove('active');
        }

        // ============================================
        // MINIFY
        // ============================================
        function minifyCode() {
            const code = codeInput.value;
            
            // Minifikace HTML
            let minified = code
                // Odstranit komentáře (kromě IE conditional)
                .replace(/<!--(?!\[if)[\s\S]*?-->/g, '')
                // Odstranit přebytečné mezery mezi tagy
                .replace(/>\s+</g, '><')
                // Odstranit mezery na začátku a konci řádků
                .replace(/^\s+|\s+$/gm, '')
                // Spojit řádky
                .replace(/\n/g, '')
                // Více mezer na jednu
                .replace(/\s{2,}/g, ' ')
                // Mezery kolem = v atributech
                .replace(/\s*=\s*/g, '=');
            
            // Minifikace inline CSS
            const styleRegex = /<style[^>]*>([\s\S]*?)<\/style>/gi;
            minified = minified.replace(styleRegex, (match, css) => {
                const minCss = css
                    .replace(/\/\*[\s\S]*?\*\//g, '')
                    .replace(/\s+/g, ' ')
                    .replace(/\s*([{}:;,])\s*/g, '$1')
                    .replace(/;}/g, '}')
                    .trim();
                return '<style>' + minCss + '<' + '/style>';
            });
            
            // Minifikace inline JS
            const scriptRegex = /<script([^>]*)>([\s\S]*?)<\/script>/gi;
            minified = minified.replace(scriptRegex, (match, attrs, js) => {
                if (attrs && attrs.includes('src=')) return match;
                const minJs = js
                    .replace(/\/\/.*$/gm, '')
                    .replace(/\/\*[\s\S]*?\*\//g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
                return '<script' + attrs + '>' + minJs + '<' + '/script>';
            });
            
            const originalSize = new Blob([code]).size;
            const minifiedSize = new Blob([minified]).size;
            const saved = originalSize - minifiedSize;
            const percent = ((saved / originalSize) * 100).toFixed(1);
            
            codeInput.value = minified;
            updatePreview();
            markUnsaved();
            addToHistory('Minifikace');
            
            showToast(`Zmenšeno o ${formatFileSize(saved)} (${percent}%)`, 'success');
        }

        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        function openShortcuts() {
            document.getElementById('shortcutsModal').classList.add('active');
        }

        function closeShortcuts() {
            document.getElementById('shortcutsModal').classList.remove('active');
        }

        function runShortcut(action) {
            closeShortcuts();
            
            setTimeout(() => {
                switch(action) {
                    case 'save':
                        saveToLocal();
                        break;
                    case 'download':
                        downloadFile();
                        break;
                    case 'newFile':
                        addNewTab();
                        break;
                    case 'search':
                        toggleSearch();
                        break;
                    case 'format':
                        formatCode();
                        break;
                    case 'validate':
                        validateHTML();
                        break;
                    case 'minify':
                        minifyCode();
                        break;
                    case 'preview':
                        switchView('preview');
                        break;
                    case 'console':
                        switchView('console');
                        break;
                    case 'undo':
                        undo();
                        break;
                    case 'redo':
                        redo();
                        break;
                    case 'closeTab':
                        if (files.length > 1) {
                            closeTab(activeFileId);
                        }
                        break;
                    case 'colorScheme':
                        openColorSchemes();
                        break;
                    case 'publish':
                        openPublish();
                        break;
                    case 'seo':
                        openSEO();
                        break;
                    case 'devices':
                        openDevices();
                        break;
                    case 'screenshot':
                        openScreenshot();
                        break;
                }
            }, 100);
        }

        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S = Save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveToLocal();
            }
            // Ctrl/Cmd + Shift + S = Download
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                downloadFile();
            }
            // Ctrl/Cmd + F = Search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f' && !e.shiftKey) {
                e.preventDefault();
                toggleSearch();
            }
            // Ctrl/Cmd + H = Replace
            if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
                e.preventDefault();
                toggleSearch();
            }
            // Ctrl/Cmd + N = New file
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                addNewTab();
            }
            // Ctrl/Cmd + W = Close tab
            if ((e.ctrlKey || e.metaKey) && e.key === 'w') {
                e.preventDefault();
                if (files.length > 1) {
                    const idx = files.findIndex(f => f.id === activeFileId);
                    closeTab(activeFileId);
                }
            }
            // Ctrl/Cmd + Shift + F = Format
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'F') {
                e.preventDefault();
                formatCode();
            }
            // Ctrl/Cmd + P = Preview
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                switchView('preview');
            }
            // Ctrl/Cmd + ` = Console
            if ((e.ctrlKey || e.metaKey) && e.key === '`') {
                e.preventDefault();
                switchView('console');
            }
            // Ctrl/Cmd + Shift + V = Validate
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'V') {
                e.preventDefault();
                validateHTML();
            }
            // Ctrl/Cmd + Shift + M = Minify
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'M') {
                e.preventDefault();
                minifyCode();
            }
            // Ctrl/Cmd + / = Shortcuts
            if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                e.preventDefault();
                openShortcuts();
            }
        });

        // ============================================
        // LIVE SERVER
        // ============================================
        let liveServerActive = false;
        let liveServerUrl = '';

        function openLiveServer() {
            document.getElementById('liveServerModal').classList.add('active');
            updateServerStatus();
        }

        function closeLiveServer() {
            document.getElementById('liveServerModal').classList.remove('active');
        }

        function updateServerStatus() {
            const statusEl = document.getElementById('serverStatus');
            const infoEl = document.getElementById('serverInfo');
            const btnEl = document.getElementById('serverToggleBtn');
            
            if (liveServerActive) {
                statusEl.innerHTML = `
                    <div class="server-status-icon online">🟢</div>
                    <div style="font-size:14px;font-weight:500;margin-bottom:4px;">Server běží</div>
                    <div style="font-size:12px;color:var(--text-muted);">Sdílej URL nebo naskenuj QR</div>
                `;
                infoEl.style.display = 'block';
                btnEl.textContent = 'Zastavit server';
                btnEl.style.background = 'var(--error)';
                btnEl.style.borderColor = 'var(--error)';
            } else {
                statusEl.innerHTML = `
                    <div class="server-status-icon offline">📡</div>
                    <div style="font-size:14px;font-weight:500;margin-bottom:4px;">Server vypnutý</div>
                    <div style="font-size:12px;color:var(--text-muted);">Spusť server pro sdílení náhledu</div>
                `;
                infoEl.style.display = 'none';
                btnEl.textContent = 'Spustit server';
                btnEl.style.background = '';
                btnEl.style.borderColor = '';
            }
        }

        async function toggleLiveServer() {
            if (liveServerActive) {
                stopLiveServer();
            } else {
                await startLiveServer();
            }
        }

        async function startLiveServer() {
            try {
                showToast('Spouštím server...', 'success');
                
                // Vytvoř Blob URL
                const html = codeInput.value;
                const blob = new Blob([html], { type: 'text/html' });
                liveServerUrl = URL.createObjectURL(blob);
                
                // Pro skutečné sdílení bychom potřebovali backend
                // Tady simulujeme s lokální URL
                const shareUrl = window.location.href.split('?')[0] + '?preview=' + encodeURIComponent(btoa(html.substring(0, 1000)));
                
                liveServerActive = true;
                document.getElementById('serverUrl').textContent = liveServerUrl;
                document.getElementById('serverUrl').href = liveServerUrl;
                
                // Generuj QR kód
                generateQRCode(liveServerUrl);
                
                updateServerStatus();
                showToast('Server spuštěn!', 'success');
            } catch (e) {
                showToast('Nelze spustit server', 'error');
            }
        }

        function stopLiveServer() {
            if (liveServerUrl) {
                URL.revokeObjectURL(liveServerUrl);
            }
            liveServerActive = false;
            liveServerUrl = '';
            updateServerStatus();
            showToast('Server zastaven', 'success');
        }

        function generateQRCode(url) {
            const qrContainer = document.getElementById('serverQR');
            qrContainer.innerHTML = '';
            
            // Jednoduchý QR generátor pomocí API
            const qrImg = document.createElement('img');
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(url)}`;
            qrImg.alt = 'QR Code';
            qrImg.style.width = '150px';
            qrImg.style.height = '150px';
            qrContainer.appendChild(qrImg);
        }

        // ============================================
        // PWA / OFFLINE
        // ============================================
        
        // Uložit do cache před zavřením
        window.addEventListener('beforeunload', function(e) {
            const hasUnsaved = files.some(f => f.unsaved);
            if (hasUnsaved) {
                e.preventDefault();
                e.returnValue = 'Máš neuložené změny. Opravdu chceš odejít?';
            }
        });

        // Offline detekce
        window.addEventListener('online', () => showToast('Zpět online', 'success'));
        window.addEventListener('offline', () => showToast('Offline režim', 'warning'));

        async function openGithubBrowser() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }
            document.getElementById('githubBrowserModal').classList.add('active');
            githubCurrentRepo = '';
            githubCurrentPath = '';
            loadGithubRepos();
        }

        function closeGithubBrowser() {
            document.getElementById('githubBrowserModal').classList.remove('active');
        }

        async function loadGithubRepos() {
            const browser = document.getElementById('githubBrowser');
            const pathEl = document.getElementById('githubPath');
            
            browser.innerHTML = '<div class="github-loading">Načítám repozitáře...</div>';
            pathEl.innerHTML = '<span class="github-path-item" onclick="loadGithubRepos()">Repozitáře</span>';

            try {
                const res = await fetch('https://api.github.com/user/repos?sort=updated&per_page=50', {
                    headers: { 'Authorization': `token ${githubToken}` }
                });
                const repos = await res.json();

                if (repos.length === 0) {
                    browser.innerHTML = '<div class="github-empty">Žádné repozitáře</div>';
                    return;
                }

                browser.innerHTML = '<div class="github-list">' + repos.map(repo => `
                    <div class="github-item folder" onclick="loadGithubContents('${repo.full_name}', '')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                        <span class="github-item-name">${repo.name}</span>
                        <span class="github-item-size">${repo.private ? '🔒' : ''}</span>
                        <button class="github-folder-btn" onclick="event.stopPropagation();loadGithubFolder('${repo.full_name}', '')">📥 Načíst vše</button>
                    </div>
                `).join('') + '</div>';
            } catch (e) {
                browser.innerHTML = '<div class="github-empty">Chyba při načítání</div>';
            }
        }

        async function loadGithubContents(repo, path) {
            const browser = document.getElementById('githubBrowser');
            const pathEl = document.getElementById('githubPath');
            
            githubCurrentRepo = repo;
            githubCurrentPath = path;

            browser.innerHTML = '<div class="github-loading">Načítám...</div>';

            // Build path breadcrumb
            let pathHtml = `<span class="github-path-item" onclick="loadGithubRepos()">Repozitáře</span> / `;
            pathHtml += `<span class="github-path-item" onclick="loadGithubContents('${repo}', '')">${repo.split('/')[1]}</span>`;
            
            if (path) {
                const parts = path.split('/');
                let currentPath = '';
                parts.forEach((part, i) => {
                    currentPath += (i > 0 ? '/' : '') + part;
                    const p = currentPath;
                    pathHtml += ` / <span class="github-path-item" onclick="loadGithubContents('${repo}', '${p}')">${part}</span>`;
                });
            }
            pathEl.innerHTML = pathHtml;

            try {
                const url = `https://api.github.com/repos/${repo}/contents/${path}`;
                const res = await fetch(url, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });
                const contents = await res.json();

                if (!Array.isArray(contents)) {
                    // It's a file
                    if (contents.encoding === 'base64') {
                        const content = atob(contents.content);
                        githubFileSha = contents.sha;
                        loadGithubFile(repo, path, content, contents.name);
                    }
                    return;
                }

                // Sort: folders first, then files
                contents.sort((a, b) => {
                    if (a.type === b.type) return a.name.localeCompare(b.name);
                    return a.type === 'dir' ? -1 : 1;
                });

                browser.innerHTML = '<div class="github-list">' + contents.map(item => {
                    const isDir = item.type === 'dir';
                    const size = item.size ? formatFileSize(item.size) : '';
                    const folderBtn = isDir ? `<button class="github-folder-btn" onclick="event.stopPropagation();loadGithubFolder('${repo}', '${item.path}')">📥 Načíst</button>` : '';
                    return `
                        <div class="github-item ${isDir ? 'folder' : 'file'}" onclick="loadGithubContents('${repo}', '${item.path}')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                ${isDir 
                                    ? '<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>'
                                    : '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>'}
                            </svg>
                            <span class="github-item-name">${item.name}</span>
                            <span class="github-item-size">${size}</span>
                            ${folderBtn}
                        </div>
                    `;
                }).join('') + '</div>';

                if (contents.length === 0) {
                    browser.innerHTML = '<div class="github-empty">Prázdná složka</div>';
                }
            } catch (e) {
                browser.innerHTML = '<div class="github-empty">Chyba při načítání</div>';
            }
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // Načíst celou složku rekurzivně
        // Loading state
        let loadingCancelled = false;
        let loadingFilesList = [];

        function showLoadingModal(title) {
            loadingCancelled = false;
            document.getElementById('loadingTitle').textContent = title || '📥 Načítám...';
            document.getElementById('loadingBarFill').style.width = '0%';
            document.getElementById('loadingStatus').textContent = 'Připravuji...';
            document.getElementById('loadingDetails').textContent = '';
            document.getElementById('loadingModal').classList.add('active');
        }

        function updateLoadingProgress(percent, status, details) {
            document.getElementById('loadingBarFill').style.width = percent + '%';
            if (status) document.getElementById('loadingStatus').textContent = status;
            if (details !== undefined) document.getElementById('loadingDetails').textContent = details;
        }

        function hideLoadingModal() {
            document.getElementById('loadingModal').classList.remove('active');
        }

        function cancelLoading() {
            loadingCancelled = true;
            hideLoadingModal();
            showToast('Načítání zrušeno', 'warning');
        }

        async function loadGithubFolder(repo, path) {
            showLoadingModal(path ? `📁 ${path}` : `📦 ${repo.split('/')[1]}`);
            updateLoadingProgress(5, 'Procházím strukturu...', 'Hledám soubory');
            
            try {
                loadingFilesList = [];
                const allFiles = await fetchGithubFolderRecursive(repo, path);
                
                if (loadingCancelled) return;
                
                if (allFiles.length === 0) {
                    hideLoadingModal();
                    showToast('Žádné podporované soubory', 'warning');
                    return;
                }

                updateLoadingProgress(20, `Nalezeno ${allFiles.length} souborů`, 'Stahuji obsah...');

                // Načti obsah všech souborů
                let loadedCount = 0;
                for (let i = 0; i < allFiles.length; i++) {
                    if (loadingCancelled) {
                        // Když zrušeno, přidej alespoň co se stihlo
                        break;
                    }
                    
                    const fileInfo = allFiles[i];
                    const percent = 20 + Math.round((i / allFiles.length) * 75);
                    updateLoadingProgress(percent, `Stahuji ${i + 1}/${allFiles.length}`, fileInfo.name);
                    
                    try {
                        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${fileInfo.path}`, {
                            headers: { 'Authorization': `token ${githubToken}` }
                        });
                        const data = await res.json();
                        
                        if (data.encoding === 'base64') {
                            const content = atob(data.content);
                            const file = createFile(fileInfo.name, content);
                            file.githubRepo = repo;
                            file.githubPath = fileInfo.path;
                            file.githubSha = data.sha;
                            file.folderPath = fileInfo.folderPath;
                            loadedCount++;
                        }
                    } catch (e) {
                        console.warn('Nelze načíst:', fileInfo.path);
                    }
                    
                    // Malá pauza aby UI reagovalo
                    if (i % 5 === 0) {
                        await new Promise(r => setTimeout(r, 10));
                    }
                }

                updateLoadingProgress(100, 'Dokončuji...', '');

                if (loadedCount > 0) {
                    // Najdi index.html nebo první HTML soubor
                    const newFiles = files.slice(-loadedCount);
                    let mainFile = newFiles.find(f => f.name.toLowerCase() === 'index.html');
                    if (!mainFile) mainFile = newFiles.find(f => f.name.toLowerCase() === 'index.htm');
                    if (!mainFile) mainFile = newFiles.find(f => f.name.match(/\.(html?|htm)$/i));
                    if (!mainFile) mainFile = newFiles[0];
                    
                    activeFileId = mainFile.id;
                    codeInput.value = mainFile.content;
                    renderTabs();
                    renderFilesList();
                    updatePreview();
                    addToHistory('GitHub: ' + (path || repo.split('/')[1]));
                    
                    // Scroll na aktivní tab
                    setTimeout(() => {
                        const activeTab = document.querySelector('.file-tab.active');
                        if (activeTab) activeTab.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                    }, 100);
                }

                hideLoadingModal();
                closeGithubBrowser();
                showToast(`Načteno ${loadedCount} souborů`, 'success');
            } catch (e) {
                hideLoadingModal();
                showToast('Chyba: ' + e.message, 'error');
            }
        }

        async function fetchGithubFolderRecursive(repo, path, basePath = '') {
            if (loadingCancelled) return [];
            
            const allFiles = [];
            
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });
                const contents = await res.json();

                if (!Array.isArray(contents)) return allFiles;

                // Aktualizuj progress při procházení
                const currentFolder = basePath || path || 'kořen';
                updateLoadingProgress(10, 'Procházím strukturu...', currentFolder);

                for (const item of contents) {
                    if (loadingCancelled) break;
                    
                    if (item.type === 'dir') {
                        // Rekurzivně načti podsložku
                        const subFiles = await fetchGithubFolderRecursive(repo, item.path, (basePath ? basePath + '/' : '') + item.name);
                        allFiles.push(...subFiles);
                    } else if (item.type === 'file') {
                        // Přidej pouze textové soubory (HTML, CSS, JS, atd.)
                        const ext = item.name.split('.').pop().toLowerCase();
                        const textExts = ['html', 'htm', 'css', 'js', 'json', 'xml', 'svg', 'txt', 'md', 'php', 'py', 'jsx', 'ts', 'tsx', 'vue', 'scss', 'sass', 'less'];
                        
                        if (textExts.includes(ext)) {
                            allFiles.push({
                                name: item.name,
                                path: item.path,
                                folderPath: basePath,
                                size: item.size
                            });
                        }
                    }
                }
            } catch (e) {
                console.error('Chyba při načítání složky:', path, e);
            }

            return allFiles;
        }

        function loadGithubFile(repo, path, content, name) {
            const file = createFile(name, content);
            file.githubRepo = repo;
            file.githubPath = path;
            file.githubSha = githubFileSha;
            activeFileId = file.id;
            codeInput.value = file.content;
            renderTabs();
            updatePreview();
            addToHistory('GitHub: ' + name);
            closeGithubBrowser();
            switchView('code');
            showToast('Soubor načten z GitHubu', 'success');
        }

        function saveToGithub() {
            if (!githubToken) {
                showToast('Nejprve nastav GitHub token', 'error');
                return;
            }

            const file = files.find(f => f.id === activeFileId);
            if (!file) return;

            document.getElementById('githubCommitRepo').value = file.githubRepo || '';
            document.getElementById('githubCommitPath').value = file.githubPath || file.name;
            document.getElementById('githubCommitMessage').value = 'Update ' + file.name;
            document.getElementById('githubCommitInfo').textContent = `Soubor: ${file.name}`;
            document.getElementById('githubCommitModal').classList.add('active');
        }

        function closeGithubCommit() {
            document.getElementById('githubCommitModal').classList.remove('active');
        }

        async function commitToGithub() {
            const repo = document.getElementById('githubCommitRepo').value.trim();
            const path = document.getElementById('githubCommitPath').value.trim();
            const message = document.getElementById('githubCommitMessage').value.trim();

            if (!repo || !path || !message) {
                showToast('Vyplň všechna pole', 'error');
                return;
            }

            const file = files.find(f => f.id === activeFileId);
            if (!file) return;

            try {
                showToast('Ukládám...', 'success');

                // Check if file exists to get SHA
                let sha = file.githubSha || null;
                if (!sha && file.githubRepo === repo && file.githubPath === path) {
                    // Try to get existing file SHA
                    try {
                        const checkRes = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                            headers: { 'Authorization': `token ${githubToken}` }
                        });
                        if (checkRes.ok) {
                            const existing = await checkRes.json();
                            sha = existing.sha;
                        }
                    } catch {}
                }

                const body = {
                    message: message,
                    content: btoa(unescape(encodeURIComponent(codeInput.value)))
                };
                if (sha) body.sha = sha;

                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (res.ok) {
                    const result = await res.json();
                    file.githubRepo = repo;
                    file.githubPath = path;
                    file.githubSha = result.content.sha;
                    file.unsaved = false;
                    renderTabs();
                    closeGithubCommit();
                    showToast('Uloženo na GitHub!', 'success');
                } else {
                    const err = await res.json();
                    showToast('Chyba: ' + (err.message || 'Nelze uložit'), 'error');
                }
            } catch (e) {
                showToast('Chyba při ukládání', 'error');
            }
        }

        // ============================================
        // FORMAT CODE
        // ============================================
        function formatCode() {
            const code = codeInput.value;
            const formatted = formatHTML(code);
            codeInput.value = formatted;
            updatePreview();
            markUnsaved();
            addToHistory('Formátování');
            showToast('Kód zformátován', 'success');
        }

        function formatHTML(html) {
            // Odstraň přebytečné mezery a nové řádky
            let result = html.replace(/>\s+</g, '><').trim();
            
            // Definice tagů
            const selfClosingTags = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wbr'];
            const inlineTags = ['a', 'abbr', 'b', 'bdo', 'br', 'button', 'cite', 'code', 'dfn', 'em', 'i', 'img', 'input', 'kbd', 'label', 'map', 'object', 'output', 'q', 'samp', 'script', 'select', 'small', 'span', 'strong', 'sub', 'sup', 'textarea', 'time', 'tt', 'var'];
            const preformattedTags = ['pre', 'code', 'script', 'style', 'textarea'];
            
            let formatted = '';
            let indent = 0;
            const indentStr = '  '; // 2 mezery
            let inPreformatted = false;
            let preformattedContent = '';
            let preformattedTag = '';
            
            // Rozděl na tokeny (tagy a text)
            const tokens = result.match(/<!--[\s\S]*?-->|<[^>]+>|[^<]+/g) || [];
            
            for (let i = 0; i < tokens.length; i++) {
                let token = tokens[i];
                
                // Přeskoč prázdné tokeny
                if (!token.trim()) continue;
                
                // Komentáře
                if (token.startsWith('<!--')) {
                    formatted += indentStr.repeat(indent) + token + '\n';
                    continue;
                }
                
                // Detekce preformatted bloků
                if (!inPreformatted) {
                    for (const tag of preformattedTags) {
                        if (token.toLowerCase().startsWith('<' + tag) && !token.endsWith('/>')) {
                            inPreformatted = true;
                            preformattedTag = tag;
                            preformattedContent = token;
                            break;
                        }
                    }
                    if (inPreformatted) continue;
                }
                
                if (inPreformatted) {
                    preformattedContent += token;
                    if (token.toLowerCase() === '</' + preformattedTag + '>') {
                        formatted += indentStr.repeat(indent) + preformattedContent + '\n';
                        inPreformatted = false;
                        preformattedContent = '';
                        preformattedTag = '';
                    }
                    continue;
                }
                
                // Zavírací tag
                if (token.startsWith('</')) {
                    indent = Math.max(0, indent - 1);
                    formatted += indentStr.repeat(indent) + token + '\n';
                    continue;
                }
                
                // Otevírací tag
                if (token.startsWith('<')) {
                    const tagMatch = token.match(/<([a-zA-Z0-9]+)/);
                    const tagName = tagMatch ? tagMatch[1].toLowerCase() : '';
                    const isSelfClosing = selfClosingTags.includes(tagName) || token.endsWith('/>');
                    const isInline = inlineTags.includes(tagName);
                    
                    // DOCTYPE a jiné speciální tagy
                    if (token.startsWith('<!') || token.startsWith('<?')) {
                        formatted += token + '\n';
                        continue;
                    }
                    
                    formatted += indentStr.repeat(indent) + token;
                    
                    // Podívej se jestli následuje krátký textový obsah a zavírací tag
                    const nextToken = tokens[i + 1];
                    const afterNext = tokens[i + 2];
                    
                    if (nextToken && !nextToken.startsWith('<') && 
                        afterNext && afterNext.toLowerCase() === '</' + tagName + '>' &&
                        nextToken.trim().length < 60) {
                        // Krátký obsah - nech na jednom řádku
                        formatted += nextToken + afterNext + '\n';
                        i += 2;
                        continue;
                    }
                    
                    formatted += '\n';
                    
                    if (!isSelfClosing) {
                        indent++;
                    }
                    continue;
                }
                
                // Text
                const trimmed = token.trim();
                if (trimmed) {
                    formatted += indentStr.repeat(indent) + trimmed + '\n';
                }
            }
            
            // Vyčisti prázdné řádky na konci a dvojité prázdné řádky
            formatted = formatted.replace(/\n{3,}/g, '\n\n').trim();
            
            return formatted;
        }

        // ============================================
        // SETTINGS
        // ============================================
        // More menu
        function toggleMoreMenu() {
            const menu = document.getElementById('moreMenu');
            menu.classList.toggle('active');
        }

        function closeMoreMenu() {
            document.getElementById('moreMenu').classList.remove('active');
        }

        // Zavřít menu při kliknutí mimo
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('moreMenu');
            const btn = document.getElementById('moreBtn');
            if (menu && btn && !menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.remove('active');
            }
        });

        function openSettings() {
            document.getElementById('settingsSheet').classList.add('active');
            loadSettings();
        }

        function closeSettings() {
            document.getElementById('settingsSheet').classList.remove('active');
        }

        function loadSettings() {
            const fontSize = localStorage.getItem('htmlStudio_fontSize') || '14';
            const wordWrap = localStorage.getItem('htmlStudio_wordWrap') === 'true';
            const autoClose = localStorage.getItem('htmlStudio_autoClose') !== 'false';
            
            document.getElementById('fontSizeSelect').value = fontSize;
            document.getElementById('wordWrapToggle').checked = wordWrap;
            document.getElementById('autoCloseToggle').checked = autoClose;
            autoCloseEnabled = autoClose;
            
            // GitHub disconnect button
            const disconnectItem = document.getElementById('githubDisconnectItem');
            if (disconnectItem) {
                disconnectItem.style.display = githubToken ? 'flex' : 'none';
            }
        }

        function changeFontSize(size) {
            codeInput.style.fontSize = size + 'px';
            localStorage.setItem('htmlStudio_fontSize', size);
        }

        function toggleWordWrap(enabled) {
            codeInput.style.whiteSpace = enabled ? 'pre-wrap' : 'pre';
            codeInput.style.wordBreak = enabled ? 'break-all' : 'normal';
            localStorage.setItem('htmlStudio_wordWrap', enabled);
        }

        let autoCloseEnabled = true;

        function toggleAutoClose(enabled) {
            autoCloseEnabled = enabled;
            localStorage.setItem('htmlStudio_autoClose', enabled);
        }

        function exportAllData() {
            const data = {
                files: files,
                prompts: prompts,
                settings: {
                    fontSize: localStorage.getItem('htmlStudio_fontSize'),
                    wordWrap: localStorage.getItem('htmlStudio_wordWrap')
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'html-studio-backup.json';
            a.click();
            showToast('Data exportována', 'success');
            closeSettings();
        }

        function clearAllData() {
            if (confirm('Opravdu smazat všechna data? Toto nelze vrátit!')) {
                localStorage.removeItem('htmlStudio_files');
                localStorage.removeItem('htmlStudio_prompts');
                localStorage.removeItem('htmlStudio_activeId');
                localStorage.removeItem('htmlStudio_fontSize');
                localStorage.removeItem('htmlStudio_wordWrap');
                location.reload();
            }
        }

        function applySettings() {
            const fontSize = localStorage.getItem('htmlStudio_fontSize') || '14';
            const wordWrap = localStorage.getItem('htmlStudio_wordWrap') === 'true';
            const autoClose = localStorage.getItem('htmlStudio_autoClose') !== 'false';
            
            codeInput.style.fontSize = fontSize + 'px';
            codeInput.style.whiteSpace = wordWrap ? 'pre-wrap' : 'pre';
            codeInput.style.wordBreak = wordWrap ? 'break-all' : 'normal';
            autoCloseEnabled = autoClose;
        }

        // ============================================
        // TOAST
        // ============================================
        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast ${type} active`;
            setTimeout(() => toast.classList.remove('active'), 2500);
        }

        // ============================================
        // AI SETTINGS
        // ============================================
        let aiSettings = {
            provider: 'gemini',
            model: ''
        };

        function loadAISettings() {
            const saved = localStorage.getItem('htmlStudio_ai');
            if (saved) {
                try {
                    aiSettings = JSON.parse(saved);
                    document.getElementById('aiProvider').value = aiSettings.provider || 'gemini';
                    
                    // Nastav klíč pokud existuje
                    if (aiSettings.apiKey) {
                        document.getElementById('aiApiKey').value = aiSettings.apiKey;
                        AI.setKey(aiSettings.provider, aiSettings.apiKey);
                    }
                } catch (e) {}
            }
            
            // Naplň modely
            onProviderChange();
            
            // Vyber uložený model
            if (aiSettings.model) {
                document.getElementById('aiModel').value = aiSettings.model;
            }
            
            updateDemoKeyWarning();
        }

        function onProviderChange() {
            const provider = document.getElementById('aiProvider').value;
            const modelSelect = document.getElementById('aiModel');
            const models = AI.getModels(provider);
            
            modelSelect.innerHTML = models.map(m => 
                `<option value="${m.value}">${m.name}</option>`
            ).join('');
            
            aiSettings.provider = provider;
            AI.setDefaultProvider(provider);
            
            updateDemoKeyWarning();
            saveAISettings();
        }

        function updateDemoKeyWarning() {
            const provider = document.getElementById('aiProvider').value;
            const warning = document.getElementById('demoKeyWarning');
            const isDemo = AI.isUsingDemoKey(provider);
            warning.style.display = isDemo ? 'block' : 'none';
        }

        function saveAISettings() {
            const provider = document.getElementById('aiProvider').value;
            const apiKey = document.getElementById('aiApiKey').value;
            const model = document.getElementById('aiModel').value;
            
            aiSettings.provider = provider;
            aiSettings.apiKey = apiKey;
            aiSettings.model = model;
            
            // Nastav do AI modulu
            if (apiKey) {
                AI.setKey(provider, apiKey);
            }
            AI.setDefaultProvider(provider);
            if (model) {
                AI.setModel(provider, model);
            }
            
            localStorage.setItem('htmlStudio_ai', JSON.stringify(aiSettings));
            updateDemoKeyWarning();
        }

        // ============================================
        // AI CHAT
        // ============================================
        let aiConversation = [];

        function openAIChat() {
            document.getElementById('aiPanel').classList.add('active');
            document.getElementById('aiOverlay').classList.add('active');
            document.getElementById('aiInput').focus();
        }

        function closeAIChat() {
            document.getElementById('aiPanel').classList.remove('active');
            document.getElementById('aiOverlay').classList.remove('active');
        }

        function aiQuickAction(prompt) {
            document.getElementById('aiInput').value = prompt;
            sendAIMessage();
        }

        function addAIMessage(role, content) {
            const messagesEl = document.getElementById('aiMessages');
            const msgEl = document.createElement('div');
            msgEl.className = `ai-message ${role}`;
            
            // Formátování kódu
            let formatted = content;
            if (role === 'assistant') {
                formatted = content.replace(/```html?\n?([\s\S]*?)```/g, '<pre>$1</pre>');
                formatted = formatted.replace(/`([^`]+)`/g, '<code>$1</code>');
                formatted = formatted.replace(/\n/g, '<br>');
            }
            
            msgEl.innerHTML = formatted;
            messagesEl.appendChild(msgEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function showAITyping() {
            const messagesEl = document.getElementById('aiMessages');
            const typingEl = document.createElement('div');
            typingEl.className = 'ai-message assistant';
            typingEl.id = 'aiTyping';
            typingEl.innerHTML = '<div class="ai-typing"><span></span><span></span><span></span></div>';
            messagesEl.appendChild(typingEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function hideAITyping() {
            const typingEl = document.getElementById('aiTyping');
            if (typingEl) typingEl.remove();
        }

        async function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            
            if (!message) return;

            input.value = '';
            addAIMessage('user', message);
            showAITyping();
            document.getElementById('aiSendBtn').disabled = true;

            const currentCode = codeInput.value;
            const systemPrompt = `Jsi AI asistent pro tvorbu HTML stránek. Uživatel pracuje s HTML editorem.
Vždy odpovídej ČESKY. Generuj české texty v HTML.
            
Aktuální HTML kód:
\`\`\`html
${currentCode}
\`\`\`

DŮLEŽITÉ INSTRUKCE:
- Pokud uživatel chce vytvořit novou stránku, vrať kompletní HTML včetně <!DOCTYPE html>, <html>, <head>, <body>
- Pokud uživatel chce upravit existující stránku, vrať POUZE nový kompletní HTML kód
- Vždy odpovídej POUZE kódem - žádný další text před nebo za kódem
- Kód musí být v jednom bloku \`\`\`html ... \`\`\`
- Design by měl být moderní, responzivní, s inline CSS
- Používej české texty pokud uživatel nepíše anglicky`;

            try {
                const response = await callAI(systemPrompt, message);
                hideAITyping();
                
                // Extrahuj HTML z odpovědi
                const htmlMatch = response.match(/```html?\n?([\s\S]*?)```/);
                if (htmlMatch) {
                    const newHtml = htmlMatch[1].trim();
                    codeInput.value = newHtml;
                    updatePreview();
                    markUnsaved();
                    addToHistory('AI: ' + message.substring(0, 30));
                    addAIMessage('assistant', '✅ Kód byl aplikován!\n\n```html\n' + newHtml.substring(0, 500) + (newHtml.length > 500 ? '...' : '') + '\n```');
                } else {
                    addAIMessage('assistant', response);
                }
            } catch (e) {
                hideAITyping();
                addAIMessage('assistant', '❌ Chyba: ' + e.message);
            }

            document.getElementById('aiSendBtn').disabled = false;
        }

        async function callAI(systemPrompt, userMessage) {
            const provider = aiSettings.provider || AI.config.defaultProvider;
            const model = aiSettings.model || AI.config.models[provider];
            
            // Použij AI modul
            return await AI.ask(systemPrompt + '\n\nUživatel: ' + userMessage, {
                provider: provider,
                model: model,
                system: systemPrompt,
                maxTokens: 8192,
                temperature: 0.7
            });
        }

        // ============================================
        // COMPONENTS
        // ============================================
        function openComponentsPanel() {
            document.getElementById('componentsModal').classList.add('active');
        }

        function closeComponentsPanel() {
            document.getElementById('componentsModal').classList.remove('active');
        }

        async function insertComponent(type) {
            closeComponentsPanel();
            showToast('Generuji komponentu...', 'success');

            const componentPrompts = {
                header: 'Vytvoř responzivní header/navigaci s logem vlevo a menu vpravo. Mobilní hamburger menu.',
                hero: 'Vytvoř hero sekci s velkým nadpisem, podnadpisem, CTA tlačítkem a obrázkem na pozadí.',
                features: 'Vytvoř sekci s 3 sloupci features/výhod s ikonami, nadpisy a popisky.',
                cards: 'Vytvoř grid 3 produktových karet s obrázkem, názvem, popisem a cenou.',
                gallery: 'Vytvoř responzivní galerii obrázků v mřížce 3x2.',
                testimonials: 'Vytvoř sekci s 3 referencemi/recenzemi zákazníků s avatarem, jménem a textem.',
                pricing: 'Vytvoř ceníkovou tabulku se 3 tarify (Basic, Pro, Enterprise).',
                contact: 'Vytvoř kontaktní formulář s poli jméno, email, zpráva a tlačítko odeslat.',
                cta: 'Vytvoř CTA sekci s výrazným nadpisem a dvěma tlačítky.',
                footer: 'Vytvoř footer s 4 sloupci (O nás, Služby, Kontakt, Sociální sítě) a copyrightem.',
                faq: 'Vytvoř FAQ sekci s 5 rozbalovacími otázkami a odpověďmi.',
                stats: 'Vytvoř sekci se 4 statistikami/čísly (zákazníci, projekty, roky, ocenění).'
            };

            const prompt = componentPrompts[type] || `Vytvoř ${type} komponentu.`;
            const currentCode = codeInput.value;

            const systemPrompt = `Jsi expert na HTML/CSS. Uživatel chce přidat komponentu do své stránky.

Aktuální HTML:
\`\`\`html
${currentCode}
\`\`\`

INSTRUKCE:
- Pokud stránka nemá základní strukturu, vytvoř kompletní HTML s novou komponentou
- Pokud stránka má strukturu, přidej komponentu na vhodné místo (např. před </body>)
- Vrať CELÝ HTML kód včetně nové komponenty
- Design musí být moderní, responzivní, inline CSS
- Použij podobný styl jako zbytek stránky
- České texty
- Odpověz POUZE kódem v \`\`\`html ... \`\`\``;

            try {
                const response = await callAI(systemPrompt, prompt);
                const htmlMatch = response.match(/```html?\n?([\s\S]*?)```/);
                
                if (htmlMatch) {
                    codeInput.value = htmlMatch[1].trim();
                    updatePreview();
                    markUnsaved();
                    addToHistory('Komponenta: ' + type);
                    showToast('Komponenta přidána!', 'success');
                } else {
                    showToast('Nepodařilo se vygenerovat', 'error');
                }
            } catch (e) {
                showToast('Chyba: ' + e.message, 'error');
            }
        }

        // ============================================
        // TEMPLATES
        // ============================================
        function openTemplates() {
            document.getElementById('templatesModal').classList.add('active');
        }

        function closeTemplates() {
            document.getElementById('templatesModal').classList.remove('active');
        }

        async function loadTemplate(type) {
            if (!aiSettings.apiKey) {
                showToast('Pro šablony nastav API klíč', 'error');
                return;
            }

            closeTemplates();
            showToast('Generuji šablonu...', 'success');

            const templatePrompts = {
                landing: 'Vytvoř kompletní landing page pro produkt/službu. Obsahuje: hero sekci s nadpisem a CTA, sekci features (3 výhody), sekci "jak to funguje", testimonials, pricing a footer.',
                portfolio: 'Vytvoř osobní portfolio stránku. Obsahuje: hero s jménem a profesí, sekci "o mně", galerii projektů (6 karet), skills, kontaktní formulář a footer.',
                restaurant: 'Vytvoř stránku pro restauraci. Obsahuje: hero s názvem a fotkou jídla, sekci "o nás", menu/jídelní lístek (předkrmy, hlavní chody, dezerty), galerii interiéru, otevírací dobu, rezervační formulář a footer s mapou.',
                business: 'Vytvoř firemní webovou stránku. Obsahuje: hero s logem a sloganem, sekci služeb, o společnosti, tým (3 lidé), reference klientů, kontakt a footer.',
                blog: 'Vytvoř blogovou stránku. Obsahuje: header s navigací, featured článek velký, grid 6 článků (obrázek, datum, nadpis, perex), sidebar s kategoriemi, newsletter signup a footer.',
                eshop: 'Vytvoř e-shop stránku. Obsahuje: header s logem a košíkem, hero banner s akcí, grid 8 produktů (obrázek, název, cena, tlačítko koupit), kategorie, newsletter a footer.',
                event: 'Vytvoř stránku pro událost/svatbu. Obsahuje: hero s datem a místem, příběh páru/o akci, program, galerii, RSVP formulář, countdown timer a footer.',
                app: 'Vytvoř prezentační stránku pro mobilní aplikaci. Obsahuje: hero s mockupem telefonu, features (4-6), screenshots, download tlačítka (App Store, Google Play), testimonials a footer.'
            };

            const prompt = templatePrompts[type] || 'Vytvoř moderní responzivní stránku.';

            const systemPrompt = `Jsi expert na tvorbu webových stránek. Vytvoř kompletní, profesionální HTML stránku.

POŽADAVKY:
- Kompletní HTML dokument (<!DOCTYPE html>, <html>, <head>, <body>)
- Moderní, profesionální design
- Plně responzivní (mobile-first)
- Inline CSS v <style> tagu
- České texty a placeholder obsah
- Realistické obrázky z picsum.photos nebo placehold.co
- Smooth scroll, hover efekty
- Odpověz POUZE kódem v \`\`\`html ... \`\`\``;

            try {
                const response = await callAI(systemPrompt, prompt);
                const htmlMatch = response.match(/```html?\n?([\s\S]*?)```/);
                
                if (htmlMatch) {
                    const file = createFile(type + '.html', htmlMatch[1].trim());
                    activeFileId = file.id;
                    codeInput.value = file.content;
                    renderTabs();
                    updatePreview();
                    addToHistory('Šablona: ' + type);
                    switchView('preview');
                    showToast('Šablona vytvořena!', 'success');
                } else {
                    showToast('Nepodařilo se vygenerovat', 'error');
                }
            } catch (e) {
                showToast('Chyba: ' + e.message, 'error');
            }
        }

        // ============================================
        // UNSPLASH
        // ============================================
        function openUnsplash() {
            document.getElementById('unsplashModal').classList.add('active');
        }

        function closeUnsplash() {
            document.getElementById('unsplashModal').classList.remove('active');
        }

        async function searchUnsplash() {
            const query = document.getElementById('unsplashQuery').value.trim();
            if (!query) {
                showToast('Zadej hledaný výraz', 'error');
                return;
            }

            const grid = document.getElementById('unsplashGrid');
            grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:20px;"><div class="github-loading">Hledám...</div></div>';

            // Používáme Unsplash Source API (nevyžaduje API klíč)
            const images = [];
            for (let i = 0; i < 12; i++) {
                images.push(`https://source.unsplash.com/400x300/?${encodeURIComponent(query)}&sig=${Date.now() + i}`);
            }

            grid.innerHTML = images.map((url, i) => `
                <img src="${url}" class="unsplash-img" onclick="insertImage('${url}')" loading="lazy" alt="Image ${i+1}">
            `).join('');
        }

        function insertImage(url) {
            const largeUrl = url.replace('400x300', '1200x800');
            const imgTag = `<img src="${largeUrl}" alt="Image" style="max-width: 100%; height: auto;">`;
            
            // Vložit na pozici kurzoru nebo na konec body
            const code = codeInput.value;
            if (code.includes('</body>')) {
                codeInput.value = code.replace('</body>', imgTag + '\n</body>');
            } else {
                codeInput.value = code + '\n' + imgTag;
            }
            
            updatePreview();
            markUnsaved();
            addToHistory('Vložen obrázek');
            closeUnsplash();
            showToast('Obrázek vložen!', 'success');
        }

        // ============================================
        // COLOR SCHEMES
        // ============================================
        function openColorSchemes() {
            document.getElementById('colorSchemesModal').classList.add('active');
        }

        function closeColorSchemes() {
            document.getElementById('colorSchemesModal').classList.remove('active');
        }

        async function applyColorScheme(scheme) {
            if (!aiSettings.apiKey) {
                showToast('Pro změnu barev nastav API klíč', 'error');
                return;
            }

            closeColorSchemes();
            showToast('Měním barevné schéma...', 'success');

            const schemes = {
                dark: 'Tmavé schéma: pozadí #0f0f23, akcent #00d4aa (tyrkysová), text bílý',
                light: 'Světlé schéma: pozadí #ffffff, akcent #2196f3 (modrá), text #333333',
                purple: 'Fialové schéma: gradient pozadí #667eea → #764ba2, text bílý',
                green: 'Zelené schéma: gradient pozadí #11998e → #38ef7d, text bílý',
                orange: 'Oranžové/růžové schéma: gradient pozadí #ee0979 → #ff6a00, text bílý',
                blue: 'Modré schéma: gradient pozadí #2193b0 → #6dd5ed, text bílý/tmavý'
            };

            const systemPrompt = `Změň barevné schéma této HTML stránky:

\`\`\`html
${codeInput.value}
\`\`\`

POŽADOVANÉ SCHÉMA: ${schemes[scheme]}

INSTRUKCE:
- Zachovej strukturu a obsah stránky
- Změň pouze barvy (pozadí, text, tlačítka, odkazy)
- Přidej gradientní pozadí kde je to vhodné
- Zajisti dobrý kontrast a čitelnost
- Vrať kompletní upravený HTML kód
- Odpověz POUZE kódem v \`\`\`html ... \`\`\``;

            try {
                const response = await callAI(systemPrompt, 'Aplikuj barevné schéma');
                const htmlMatch = response.match(/```html?\n?([\s\S]*?)```/);
                
                if (htmlMatch) {
                    codeInput.value = htmlMatch[1].trim();
                    updatePreview();
                    markUnsaved();
                    addToHistory('Barevné schéma: ' + scheme);
                    showToast('Barvy změněny!', 'success');
                } else {
                    showToast('Nepodařilo se změnit', 'error');
                }
            } catch (e) {
                showToast('Chyba: ' + e.message, 'error');
            }
        }

        // ============================================
        // SEO CHECK
        // ============================================
        function openSEO() {
            document.getElementById('seoModal').classList.add('active');
            checkSEO();
        }

        function closeSEO() {
            document.getElementById('seoModal').classList.remove('active');
        }

        function checkSEO() {
            const code = codeInput.value;
            const results = [];

            // Title
            const titleMatch = code.match(/<title[^>]*>([^<]*)<\/title>/i);
            const titleLength = titleMatch ? titleMatch[1].length : 0;
            results.push({
                icon: '📌',
                label: 'Title tag',
                value: titleMatch ? `"${titleMatch[1].substring(0, 30)}${titleMatch[1].length > 30 ? '...' : ''}" (${titleLength} znaků)` : 'Chybí!',
                status: titleMatch ? (titleLength >= 30 && titleLength <= 60 ? 'good' : 'warn') : 'bad'
            });

            // Meta description
            const descMatch = code.match(/<meta[^>]*name=["']description["'][^>]*content=["']([^"']*)["']/i);
            const descLength = descMatch ? descMatch[1].length : 0;
            results.push({
                icon: '📝',
                label: 'Meta description',
                value: descMatch ? `${descLength} znaků` : 'Chybí!',
                status: descMatch ? (descLength >= 120 && descLength <= 160 ? 'good' : 'warn') : 'bad'
            });

            // H1
            const h1Match = code.match(/<h1[^>]*>([^<]*)<\/h1>/i);
            results.push({
                icon: '🔤',
                label: 'H1 nadpis',
                value: h1Match ? `"${h1Match[1].substring(0, 40)}..."` : 'Chybí!',
                status: h1Match ? 'good' : 'bad'
            });

            // Viewport
            const viewportMatch = code.match(/<meta[^>]*name=["']viewport["']/i);
            results.push({
                icon: '📱',
                label: 'Viewport meta',
                value: viewportMatch ? 'Přítomen' : 'Chybí!',
                status: viewportMatch ? 'good' : 'bad'
            });

            // Charset
            const charsetMatch = code.match(/<meta[^>]*charset/i);
            results.push({
                icon: '🔣',
                label: 'Charset',
                value: charsetMatch ? 'Přítomen' : 'Chybí!',
                status: charsetMatch ? 'good' : 'warn'
            });

            // Images with alt
            const imgCount = (code.match(/<img/gi) || []).length;
            const imgAltCount = (code.match(/<img[^>]*alt=["'][^"']+["']/gi) || []).length;
            results.push({
                icon: '🖼️',
                label: 'Obrázky s alt',
                value: `${imgAltCount}/${imgCount} má alt text`,
                status: imgCount === 0 ? 'good' : (imgAltCount === imgCount ? 'good' : (imgAltCount > 0 ? 'warn' : 'bad'))
            });

            // Links
            const linkCount = (code.match(/<a[^>]*href/gi) || []).length;
            results.push({
                icon: '🔗',
                label: 'Odkazy',
                value: `${linkCount} odkazů`,
                status: linkCount > 0 ? 'good' : 'warn'
            });

            // Open Graph
            const ogMatch = code.match(/<meta[^>]*property=["']og:/i);
            results.push({
                icon: '📢',
                label: 'Open Graph',
                value: ogMatch ? 'Přítomen' : 'Chybí (pro sociální sítě)',
                status: ogMatch ? 'good' : 'warn'
            });

            const resultsEl = document.getElementById('seoResults');
            const goodCount = results.filter(r => r.status === 'good').length;
            const score = Math.round((goodCount / results.length) * 100);

            resultsEl.innerHTML = `
                <div style="text-align:center;margin-bottom:16px;">
                    <div style="font-size:36px;font-weight:bold;color:${score >= 80 ? 'var(--success)' : score >= 50 ? 'var(--warning)' : 'var(--error)'};">${score}%</div>
                    <div style="font-size:12px;color:var(--text-muted);">SEO skóre</div>
                </div>
                ${results.map(r => `
                    <div class="seo-item">
                        <div class="seo-icon">${r.icon}</div>
                        <div class="seo-info">
                            <div class="seo-label">${r.label}</div>
                            <div class="seo-value">${r.value}</div>
                        </div>
                        <div class="seo-status ${r.status}">${r.status === 'good' ? '✓' : r.status === 'warn' ? '!' : '✗'}</div>
                    </div>
                `).join('')}
            `;
        }

        async function fixSEOWithAI() {
            if (!aiSettings.apiKey) {
                showToast('Nastav API klíč', 'error');
                return;
            }

            closeSEO();
            showToast('AI opravuje SEO...', 'success');

            const systemPrompt = `Vylepši SEO této HTML stránky:

\`\`\`html
${codeInput.value}
\`\`\`

PŘIDEJ/OPRAV:
- <title> tag (30-60 znaků, výstižný)
- <meta name="description"> (120-160 znaků)
- <meta name="viewport">
- <meta charset="UTF-8">
- <h1> nadpis (pokud chybí)
- alt texty u obrázků
- Open Graph meta tagy (og:title, og:description, og:image)
- Sémantické HTML tagy (header, nav, main, footer, article, section)

Zachovej obsah a design, jen vylepši SEO.
Odpověz POUZE kódem v \`\`\`html ... \`\`\``;

            try {
                const response = await callAI(systemPrompt, 'Oprav SEO');
                const htmlMatch = response.match(/```html?\n?([\s\S]*?)```/);
                
                if (htmlMatch) {
                    codeInput.value = htmlMatch[1].trim();
                    updatePreview();
                    markUnsaved();
                    addToHistory('SEO oprava');
                    showToast('SEO vylepšeno!', 'success');
                }
            } catch (e) {
                showToast('Chyba: ' + e.message, 'error');
            }
        }

        // ============================================
        // DEVICE PREVIEW
        // ============================================
        function openDevices() {
            document.getElementById('devicesModal').classList.add('active');
            setDevice('iphone14', 390, 844);
        }

        function closeDevices() {
            document.getElementById('devicesModal').classList.remove('active');
        }

        function setDevice(name, width, height) {
            const buttons = document.querySelectorAll('.device-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const frame = document.getElementById('deviceFrame');
            const preview = document.getElementById('devicePreview');

            frame.style.width = (width + 20) + 'px';
            preview.style.width = width + 'px';
            preview.style.height = Math.min(height, 500) + 'px';

            // Aktualizovat iframe
            const doc = preview.contentDocument;
            doc.open();
            doc.write(codeInput.value);
            doc.close();
        }

        // ============================================
        // PUBLISH
        // ============================================
        function openPublish() {
            if (!githubToken) {
                showToast('Nastav GitHub token v nastavení', 'error');
                return;
            }
            document.getElementById('publishModal').classList.add('active');
            document.getElementById('publishResult').style.display = 'none';
            
            const file = files.find(f => f.id === activeFileId);
            document.getElementById('publishRepoName').value = (file?.name || 'moje-stranka').replace(/\.html?$/, '').replace(/[^a-z0-9-]/gi, '-');
        }

        function closePublish() {
            document.getElementById('publishModal').classList.remove('active');
        }

        async function publishToGitHub() {
            const repoName = document.getElementById('publishRepoName').value.trim().toLowerCase().replace(/[^a-z0-9-]/g, '-');
            
            if (!repoName) {
                showToast('Zadej název repozitáře', 'error');
                return;
            }

            showToast('Publikuji...', 'success');

            try {
                // 1. Vytvoř repo
                let repoRes = await fetch('https://api.github.com/user/repos', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: repoName,
                        auto_init: true,
                        private: false
                    })
                });

                let repo;
                if (repoRes.status === 422) {
                    // Repo už existuje - načti ho
                    const userRes = await fetch('https://api.github.com/user', {
                        headers: { 'Authorization': `token ${githubToken}` }
                    });
                    const user = await userRes.json();
                    repo = { full_name: `${user.login}/${repoName}`, owner: { login: user.login } };
                } else if (repoRes.ok) {
                    repo = await repoRes.json();
                    await new Promise(r => setTimeout(r, 1000)); // Počkej na vytvoření
                } else {
                    throw new Error('Nelze vytvořit repozitář');
                }

                // 2. Nahraj index.html
                const content = btoa(unescape(encodeURIComponent(codeInput.value)));
                
                // Zkus získat SHA existujícího souboru
                let sha = null;
                try {
                    const fileRes = await fetch(`https://api.github.com/repos/${repo.full_name}/contents/index.html`, {
                        headers: { 'Authorization': `token ${githubToken}` }
                    });
                    if (fileRes.ok) {
                        const fileData = await fileRes.json();
                        sha = fileData.sha;
                    }
                } catch (e) {}

                const uploadRes = await fetch(`https://api.github.com/repos/${repo.full_name}/contents/index.html`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update from HTML Studio',
                        content: content,
                        sha: sha
                    })
                });

                if (!uploadRes.ok) throw new Error('Nelze nahrát soubor');

                // 3. Zapni GitHub Pages
                await fetch(`https://api.github.com/repos/${repo.full_name}/pages`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        source: { branch: 'main', path: '/' }
                    })
                });

                const owner = repo.owner?.login || repo.full_name.split('/')[0];
                const pagesUrl = `https://${owner}.github.io/${repoName}/`;

                document.getElementById('publishResult').style.display = 'block';
                document.getElementById('publishResult').innerHTML = `
                    <div style="text-align:center;padding:16px;background:rgba(81, 207, 102, 0.1);border-radius:12px;">
                        <div style="font-size:24px;margin-bottom:8px;">🎉</div>
                        <div style="font-size:14px;font-weight:500;margin-bottom:8px;">Publikováno!</div>
                        <a href="${pagesUrl}" target="_blank" class="publish-url">${pagesUrl}</a>
                        <div style="font-size:11px;color:var(--text-muted);">Může trvat 1-2 minuty než bude stránka aktivní</div>
                    </div>
                `;

                showToast('Stránka publikována!', 'success');
            } catch (e) {
                showToast('Chyba: ' + e.message, 'error');
            }
        }

        // ============================================
        // SCREENSHOT TO HTML
        // ============================================
        let screenshotData = null;

        function openScreenshot() {
            document.getElementById('screenshotModal').classList.add('active');
            document.getElementById('screenshotPreview').style.display = 'none';
            document.getElementById('generateFromScreenshot').style.display = 'none';
            document.getElementById('screenshotInput').value = '';
            screenshotData = null;
        }

        function closeScreenshot() {
            document.getElementById('screenshotModal').classList.remove('active');
        }

        function handleScreenshot(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    screenshotData = e.target.result;
                    document.getElementById('screenshotPreview').src = screenshotData;
                    document.getElementById('screenshotPreview').style.display = 'block';
                    document.getElementById('generateFromScreenshot').style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function generateFromScreenshot() {
            if (!screenshotData) {
                showToast('Nahraj obrázek', 'error');
                return;
            }

            if (!aiSettings.apiKey) {
                showToast('Nastav API klíč', 'error');
                return;
            }

            // Pouze Gemini a Claude podporují obrázky
            if (aiSettings.provider !== 'gemini' && aiSettings.provider !== 'claude') {
                showToast('Pro obrázky použij Gemini nebo Claude', 'error');
                return;
            }

            closeScreenshot();
            showToast('AI analyzuje obrázek...', 'success');

            try {
                let response;
                
                if (aiSettings.provider === 'gemini') {
                    const base64 = screenshotData.split(',')[1];
                    const model = aiSettings.model || 'gemini-2.0-flash';
                    
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${aiSettings.apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: 'Analyzuj tento screenshot webové stránky a vytvoř podobnou HTML stránku. Snaž se co nejvíce přiblížit designu, rozložení a barvám. Vytvoř kompletní responzivní HTML s inline CSS. Odpověz POUZE kódem v ```html ... ```' },
                                    { inline_data: { mime_type: 'image/jpeg', data: base64 } }
                                ]
                            }],
                            generationConfig: { temperature: 0.7, maxOutputTokens: 8192 }
                        })
                    });

                    const data = await res.json();
                    response = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                } else if (aiSettings.provider === 'claude') {
                    const base64 = screenshotData.split(',')[1];
                    const mediaType = screenshotData.split(';')[0].split(':')[1];
                    
                    const res = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': aiSettings.apiKey,
                            'anthropic-version': '2023-06-01',
                            'anthropic-dangerous-direct-browser-access': 'true'
                        },
                        body: JSON.stringify({
                            model: aiSettings.model || 'claude-sonnet-4-20250514',
                            max_tokens: 8192,
                            messages: [{
                                role: 'user',
                                content: [
                                    { type: 'image', source: { type: 'base64', media_type: mediaType, data: base64 } },
                                    { type: 'text', text: 'Analyzuj tento screenshot webové stránky a vytvoř podobnou HTML stránku. Snaž se co nejvíce přiblížit designu, rozložení a barvám. Vytvoř kompletní responzivní HTML s inline CSS. Odpověz POUZE kódem v ```html ... ```' }
                                ]
                            }]
                        })
                    });

                    const data = await res.json();
                    response = data.content?.[0]?.text || '';
                }

                const htmlMatch = response.match(/```html?\n?([\s\S]*?)```/);
                
                if (htmlMatch) {
                    const file = createFile('from-screenshot.html', htmlMatch[1].trim());
                    activeFileId = file.id;
                    codeInput.value = file.content;
                    renderTabs();
                    updatePreview();
                    addToHistory('Z obrázku');
                    switchView('preview');
                    showToast('Stránka vygenerována!', 'success');
                } else {
                    showToast('Nepodařilo se vygenerovat', 'error');
                }
            } catch (e) {
                showToast('Chyba: ' + e.message, 'error');
            }
        }

        // ============================================
        // INIT
        // ============================================
        function init() {
            const saved = localStorage.getItem('htmlStudio_files');
            const savedId = localStorage.getItem('htmlStudio_activeId');
            if (saved) {
                try {
                    files = JSON.parse(saved);
                    activeFileId = parseInt(savedId) || files[0]?.id;
                    fileIdCounter = Math.max(...files.map(f => f.id));
                    files.forEach(f => { if (!f.history) { f.history = []; f.historyIndex = -1; } });
                } catch { files = []; }
            }
            if (files.length === 0) {
                const f = createFile();
                activeFileId = f.id;
            }
            codeInput.value = files.find(f => f.id === activeFileId)?.content || '';
            renderTabs();
            updatePreview();
            renderHistory();
            loadPrompts();
            loadGithubToken();
            loadAISettings();
            applySettings();
            addToHistory('Start');
        }

        let inputTimeout;
        codeInput.addEventListener('input', () => {
            updatePreview();
            markUnsaved();
            clearTimeout(inputTimeout);
            inputTimeout = setTimeout(() => addToHistory('Úprava'), 1500);
        });

        init();
    </script>
</body>
</html>
